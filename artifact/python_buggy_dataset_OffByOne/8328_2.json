{
  "instruction": "This code compares CheckM estimates. To use it, run the script with three arguments: the path to a file indicating genomes that failed QC, the path to a file with alternative CheckM estimates, and the path to an output file. The script will read in the two input files, compare the estimates, and output the results to the specified output file.",
  "buggy_code": "__prog_name__ = 'checkm_compare.py'\n__prog_desc__ = 'compare CheckM estimates'\n__author__ = 'Donovan Parks'\n__copyright__ = 'Copyright 2018'\n__credits__ = ['Donovan Parks']\n__license__ = 'GPL3'\n__version__ = '0.0.1'\n__maintainer__ = 'Donovan Parks'\n__email__ = 'donovan.parks@gmail.com'\n__status__ = 'Development'\nimport os\nimport sys\nimport argparse\nimport tempfile\nimport ntpath\nimport shutil\n\nclass Compare(object):\n    \"\"\"Compare CheckM estimates.\"\"\"\n\n    def __init__(self):\n        \"\"\"Initialization.\"\"\"\n        pass\n\n    def run(self, qc_failed_file, checkm_qa_files, output_file):\n        \"\"\"compare CheckM estimates.\"\"\"\n        orig_estimates = {}\n        with open(qc_failed_file) as f:\n            header = f.readline().strip().split('\\t')\n            acc_index = header.index('Accession')\n            comp_index = header.index('Completeness (%)')\n            cont_index = header.index('Contamination (%)')\n            for line in f:\n                line_split = line.strip().split('\\t')\n                gid = line_split[acc_index]\n                comp = float(line_split[comp_index])\n                cont = float(line_split[cont_index])\n                orig_estimates[gid] = (comp, cont)\n        new_estimates = {}\n        with open(checkm_qa_files) as f:\n            header = f.readline().strip().split('\\t')\n            comp_index = header.index('Completeness')\n            cont_index = header.index('Contamination')\n            for line in f:\n                line_split = line.strip().split('\\t')\n                gid = line_split[1].replace('_ncbi_proteins', '')\n                comp = float(line_split[comp_index])\n                cont = float(line_split[cont_index])\n                new_estimates[gid] = (comp, cont)\n        fout = open(output_file, 'w')\n        fout.write('Accession\\tOriginal completeness\\tNew completeness\\tOriginal contamination\\tNew contamination\\n')\n        for gid in new_estimates:\n            orig_comp, orig_cont = orig_estimates[gid]\n            new_comp, new_cont = new_estimates[gid]\n            orig_quality = orig_comp - 5 * orig_cont\n            if orig_quality >= 50:\n                continue\n            new_quality = new_comp - 5 * new_cont\n            if new_quality < 50:\n                continue\n            if new_comp - orig_comp > 5 or new_cont - orig_cont < -1:\n                print(gid, orig_comp, new_comp, orig_cont, new_cont)\n                fout.write('%s\\t%.2f\\t%.2f\\t%.2f\\t%.2f\\n' % (gid, orig_comp, new_comp, orig_cont, new_cont))\n        fout.close()\nif __name__ == '__main__':\n    print(__prog_name__ + ' v' + __version__ + ': ' + __prog_desc__)\n    print('  by ' + __author__ + ' (' + __email__ + ')' + '\\n')\n    parser = argparse.ArgumentParser(formatter_class=argparse.ArgumentDefaultsHelpFormatter)\n    parser.add_argument('qc_failed_file', help='file indicating genomes that failed QC')\n    parser.add_argument('checkm_qa_files', help='file with alternative CheckM estimates')\n    parser.add_argument('output_file', help='output directory')\n    args = parser.parse_args()\n    try:\n        p = Compare()\n        p.run(args.qc_failed_file, args.checkm_qa_files, args.output_file)\n    except SystemExit:\n        print('\\nControlled exit resulting from an unrecoverable error or warning.')\n    except:\n        print('\\nUnexpected error:', sys.exc_info()[0])\n        raise",
  "line_no": 58,
  "line_no_percent": "72%"
}