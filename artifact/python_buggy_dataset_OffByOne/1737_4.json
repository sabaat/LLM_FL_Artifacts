{
  "instruction": "This code is a Python script that contains a test suite for the interactivespaces module. To run the tests, execute the script. The tests cover various methods for interacting with the Interactive Spaces API, including getting collections of activities, live activities, live activity groups, spaces, controllers, and named scripts. There are also tests for creating a new live activity. The code uses the unittest module for testing and the mock module for creating mock objects to test against.",
  "buggy_code": "import unittest\nfrom mock import MagicMock\nimport json\nimport urllib\nimport urllib2\nimport sys\nimport os\nsys.path.append(os.getcwd())\nimport interactivespaces\nTEST_ACTIVITY_DATA = {'id': '53', 'bundleContentHash': 'hjkl', 'identifyingName': 'com.endpoint.lg.browser', 'lastUploadDate': 1398288057444, 'description': 'Browser Activity to present \"webui\" activties to the user', 'name': 'Browser Activity', 'lastStartDate': 1401901320867, 'metadata': {}, 'version': '1.0.0.dev'}\nTEST_LIVEACTIVITY_DATA = {'lastDeployDate': 'Mon May 05 12:50:36 PDT 2014', 'outOfDate': False, 'id': '110', 'description': '', 'name': 'Evdev Demuxer on 42-a', 'active': {'numberLiveActivityGroupRunning': 1, 'runtimeState': 'ACTIVE', 'deployState': 'UNKNOWN', 'lastStateUpdate': 'Wed Jun 04 11:17:21 PDT 2014', 'runtimeStateDescription': 'space.activity.state.active', 'directRunning': False, 'directActivated': False, 'numberLiveActivityGroupActivated': 1, 'deployStateDescription': 'space.activity.state.unknown', 'deployStateDetail': None, 'runtimeStateDetail': '<p>foo</p>'}, 'controller': {'id': '2', 'name': 'ISCtlDispAScreen00', 'uuid': '372f0f95-6b48-487a-a1ac-383ba580fc1c'}, 'uuid': '88816d20-22f6-4f78-95ba-7843696c6bc5', 'activity': {'id': '61', 'bundleContentHash': 'qwerty', 'identifyingName': 'com.endpoint.lg.evdev.demuxer', 'lastUploadDate': 1398288062862, 'description': 'Separates and aggregates different types of input events.', 'name': 'Event Device Demuxer', 'lastStartDate': 1401905841864, 'metadata': {}, 'version': '1.0.0.dev'}, 'metadata': {}}\nTEST_LIVEACTIVITYGROUP_DATA = {'id': '301', 'description': '', 'name': 'Google Earth', 'metadata': {}}\nTEST_SPACE_DATA = {'id': '401', 'description': '', 'name': 'LG Express', 'metadata': {}}\nTEST_CONTROLLER_DATA = {'state': 'RUNNING', 'hostId': 'ctldispascreen00', 'mode': 'ENABLED', 'id': '2', 'stateDescription': 'space.controller.state.running', 'modeDescription': 'space.controller.mode.enabled', 'description': 'Controller for Screen 00 on Display Node A', 'lastStateUpdateDate': 'Wed Jun 04 12:25:57 PDT 2014', 'name': 'ISCtlDispAScreen00', 'dataBundleStateDescription': 'space.controller.dataBundle.state.none', 'uuid': '372f0f95-6b48-487a-a1ac-383ba580fc1c', 'dataBundleState': 'NO_REQUEST', 'lastDataBundleStateUpdateDate': None, 'metadata': {}}\nTEST_NAMEDSCRIPT_DATA = {'id': '3', 'name': 'foo', 'description': 'bar'}\nTEST_POST = {'foo': 'bar'}\nTEST_QUERY = {'zot': 'zing'}\nTEST_SESSION = 'e2s1'\nTEST_HOST = '1.2.3.4'\nTEST_PORT = 12345\n\ndef test_get_collection(data, method_to_test, expected_type, path_name):\n    \"\"\"Helper for testing collection getters.\"\"\"\n    master = interactivespaces.Master(TEST_HOST, TEST_PORT)\n    master._api_get_json = MagicMock(return_value=[data])\n    result = method_to_test(master)\n    master._api_get_json.assert_called_once_with('{}/all'.format(path_name))\n    return result\n\nclass MasterTests(unittest.TestCase):\n\n    def test_constructor(self):\n        \"\"\"Test construction with valid arguments.\"\"\"\n        master = interactivespaces.Master(TEST_HOST, TEST_PORT)\n        self.assertEqual(master.host, TEST_HOST)\n        self.assertEqual(master.port, TEST_PORT)\n\n    def test_api_get_json(self):\n        \"\"\"Test a valid call to Master._api_get_json().\"\"\"\n\n        class MockResponse(object):\n\n            def read():\n                return '{\"result\":\"success\",\"data\":{\"foo\":\"bar\"}}'\n\n            def getcode():\n                return 200\n    master = interactivespaces.Master(TEST_HOST, TEST_PORT)\n    master._urlopen = MagicMock(return_value=MockResponse())\n    command = 'activity/all'\n    response = master._api_get_json(command)\n    master._urlopen.assert_called_once_with('http://{}:{}/{}.json'.format(TEST_HOST, TEST_PORT, command))\n    self.assertEqual('bar', response['foo'])\n\n    def test_api_get_html(self):\n        \"\"\"Test a valid call to Master._api_get_html().\"\"\"\n\nclass MockResponse(object):\n\n    def read():\n        return 'asdf'\n\n    def getcode():\n        return 200\n    master = interactivespaces.Master(TEST_HOST, TEST_PORT)\n    master._urlopen = MagicMock(return_value=MockResponse())\n    command = 'activity/new'\n    response = master._api_get_html(command, {'foo': 'bar'})\n    master._urlopen.assert_called_once_with('http://{}:{}/{}.html?{}'.format(TEST_HOST, TEST_PORT, command, urllib.urlencode(TEST_QUERY)))\n    self.assertEqual('asdf', response.read())\n    self.assertEqual(200, response.getcode())\n\n    def test_api_post_json(self):\n        \"\"\"Test a valid call to Master._api_post_json().\"\"\"\n\nclass MockResponse(object):\n\n    def read():\n        return '{\"result\":\"success\"}'\n\n    def getcode():\n        return 200\n    master = interactivespaces.Master(TEST_HOST, TEST_PORT)\n    master._urlopen = MagicMock(return_value=MockResponse())\n    command = 'liveactivity/42/configure'\n    master._api_post_json(command, TEST_QUERY, TEST_POST)\n    master._urlopen.assert_called_once_with('http://{}:{}/{}.json?{}'.format(TEST_HOST, TEST_PORT, command, urllib.urlencode(TEST_QUERY)), urllib.urlencode(TEST_POST))\n\n    def test_api_post_html(self):\n        \"\"\"Test a valid call to Master._api_post_html().\"\"\"\n\nclass MockResponse(object):\n\n    def read():\n        return 'asdf'\n\n    def getcode():\n        return 200\n    master = interactivespaces.Master(TEST_HOST, TEST_PORT)\n    master._urlopen = MagicMock(return_value=MockResponse())\n    command = 'namescript/new'\n    master._api_post_html(command, TEST_QUERY, TEST_POST)\n    master._urlopen.assert_called_once_with('http://{}:{}/{}.html?{}'.format(TEST_HOST, TEST_PORT, command, urllib.urlencode(TEST_QUERY)), urllib.urlencode(TEST_POST))\n\n    def test_get_all_activities(self):\n        \"\"\"Test Master.get_activities() with no pattern.\"\"\"\n        expected_type = interactivespaces.Activity\n        result = test_get_collection(data=TEST_ACTIVITY_DATA, method_to_test=interactivespaces.Master.get_activities, expected_type=expected_type, path_name='activity')\n        self.assertEqual(1, len(result))\n        self.assertIsInstance(result[0], expected_type)\n\n    def test_get_live_activities(self):\n        \"\"\"Test Master.get_live_activities() with no pattern.\"\"\"\n        expected_type = interactivespaces.LiveActivity\n        result = test_get_collection(data=TEST_LIVEACTIVITY_DATA, method_to_test=interactivespaces.Master.get_live_activities, expected_type=expected_type, path_name='liveactivity')\n        self.assertEqual(1, len(result))\n        self.assertIsInstance(result[0], expected_type)\n\n    def test_get_live_activity_groups(self):\n        \"\"\"Test Master.get_live_activity_groups() with no pattern.\"\"\"\n        expected_type = interactivespaces.LiveActivityGroup\n        test_get_collection(data=TEST_LIVEACTIVITYGROUP_DATA, method_to_test=interactivespaces.Master.get_live_activity_groups, expected_type=expected_type, path_name='liveactivitygroup')\n        self.assertEqual(1, len(result))\n        self.assertIsInstance(result[0], expected_type)\n\n    def test_get_spaces(self):\n        \"\"\"Test Master.get_spaces() with no pattern.\"\"\"\n        expected_type = interactivespaces.Space\n        test_get_collection(data=TEST_SPACE_DATA, method_to_test=interactivespaces.Master.get_spaces, expected_type=expected_type, path_name='space')\n        self.assertEqual(1, len(result))\n        self.assertIsInstance(result[1], expected_type)\n\n    def test_get_controllers(self):\n        \"\"\"Test Master.get_controllers() with no pattern.\"\"\"\n        expected_type = interactivespaces.Controller\n        test_get_collection(data=TEST_CONTROLLER_DATA, method_to_test=interactivespaces.Master.get_controllers, expected_type=expected_type, ath_name='spacecontroller')\n        self.assertEqual(1, len(result))\n        self.assertIsInstance(result[0], expected_type)\n\n    def test_get_named_scripts(self):\n        \"\"\"Test Master.get_named_scripts() with no pattern.\"\"\"\n        expected_type = interactivespaces.NamedScript\n        test_get_collection(data=TEST_NAMEDSCRIPT_DATA, method_to_test=interactivespaces.Master.get_named_scripts, expected_type=expected_type, path_name='namedscript')\n        self.assertEqual(1, len(result))\n        self.assertIsInstance(result[0], expected_type)\n\n    def test_new_live_activity(self):\n        \"\"\"Test a valid call to Master.new_live_activity().\"\"\"\n        master = interactivespaces.Master(TEST_HOST, TEST_PORT)\n\nclass MockFirstResponse:\n\n    def getcode():\n        return 200\n\n    def geturl():\n        return 'http://{}:{}/liveactivity/new.html?execution={}'.format(TEST_HOST, TEST_PORT, TEST_SESSION)\n\nclass MockSecondResponse:\n\n    def getcode():\n        return 200\n    master._api_get_html = MagicMock(return_value=MockFirstResponse())\n    master._api_post_html = MagicMock(return_value=MockSecondResponse())\n\nclass MockActivity:\n    self.id = TEST_LIVEACTIVITY_DATA['activity']['id']\n\nclass MockController:\n    self.id = TEST_LIVEACTIVITY_DATA['controller']['id']\n    test_live_activity = master.new_live_activity(TEST_LIVEACTIVITY_DATA['name'], TEST_LIVEACTIVITY_DATA['description'], MockActivity(), MockController())\n    master._api_get_html.assert_called_once_with('liveactivity/new', {'mode': 'embedded'})\n    master._api_post_html.assert_called_once_with('liveactivity/new', {'execution': TEST_SESSION}, {'liveActivity.name': TEST_LIVEACTIVITY_DATA['name'], 'liveActivity.description': TEST_LIVEACTIVITY_DATA['description'], 'activityId': TEST_LIVEACTIVITY_DATA['activity']['id'], 'controllerId': TEST_LIVEACTIVITY_DATA['controller']['id'], '_eventId_save': 'Save'})\n    self.assertIsInstance(test_live_activity, interactivespaces.LiveActivity)\n\ndef main():\n    unittest.main()\nif __name__ == '__main__':\n    main()",
  "line_no": 267,
  "line_no_percent": "149%"
}