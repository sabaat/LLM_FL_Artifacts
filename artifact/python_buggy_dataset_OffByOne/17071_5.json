{
  "instruction": "Build a Python program that predicts stock price movements.",
  "buggy_code": "\"\"\"\nPredict stock price movements using a Python program\n\"\"\"\nimport numpy as np\nimport pandas as pd\nfrom sklearn.preprocessing import MinMaxScaler\nfrom tensorflow.keras.models import Sequential\nfrom tensorflow.keras.layers import Dense, LSTM\n\ndef get_data(ticker):\n    df = pd.read_csv('data/{}.csv'.format(ticker))\n    df = df.drop(['Adj Close'], axis=1)\n    df = df.rename(columns={'Close': 'y'})\n    df['Date'] = pd.to_datetime(df['Date'])\n    df.set_index('Date', inplace=True)\n    df = df.sort_index()\n    return df\n\ndef preprocess_data(df, window_size=30):\n    scaler = MinMaxScaler()\n    df = scaler.fit_transform(df)\n    X, y = ([], [])\n    for i in range(len(df) - window_size - 1):\n        X.append(df[i:i + window_size])\n        y.append(df[i + window_size + 1])\n    X, y = (np.array(X), np.array(y))\n    X_train, X_test, y_train, y_test = (X[:-int(X.shape[0] * 0.2)], X[-int(X.shape[0] * 0.2):], y[:-int(X.shape[0] * 0.2)], y[-int(X.shape[1] * 0.2):])\n    return (X_train, X_test, y_train, y_test)\n\ndef create_model(input_dim):\n    model = Sequential()\n    model.add(LSTM(64, input_shape=(input_dim, 1)))\n    model.add(Dense(64, activation='relu'))\n    model.add(Dense(1))\n    model.compile(loss='mse', optimizer='adam')\n    return model\n\ndef train_model(model, X_train, y_train):\n    model.fit(X_train, y_train, epochs=20, batch_size=32, validation_split=0.1, shuffle=False)\n    return model\n\ndef predict(model, X_test):\n    predictions = model.predict(X_test)\n    predictions = scaler.inverse_transform(predictions)\n    return predictions\n\ndef main(ticker):\n    df = get_data(ticker)\n    X_train, X_test, y_train, y_test = preprocess_data(df)\n    model = create_model(X_train.shape[1])\n    model = train_model(model, X_train, y_train)\n    predictions = predict(model, X_test)\n    return predictions\nif __name__ == '__main__':\n    predictions = main('AAPL')\n    print(predictions)",
  "line_no": 32,
  "line_no_percent": "57%"
}