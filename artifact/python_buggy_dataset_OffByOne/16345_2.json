{
  "instruction": "This code is a terminal tool to make time interval measures using the Tektronix FCA3103. To use it, run the main function and provide the following arguments: \n- --function or -f: Measuring Function, choose between 'mtint' and 'tint'\n- --interval or -t: Time between samples, an integer\n- --samples or -s: Number of samples, an integer, default is 1\n- --debug or -d: Enable debug output, a boolean, default is False\n- --device or -l: Device port, an integer, default is 1\n- --output or -o: Output data file, a string\n- --ref or -r: Input channel for the reference, an integer, choose between 1 and 2, default is 1\n- --trigl or -g: Input trigger level, a float, default is 1.5\n- --skip or -i: Ignore values far from mean plus error, an integer, default is 0\n- --tstamp or -x: Add timestamping for each measure, a boolean, default is False.",
  "buggy_code": "\"\"\"\nTerminal tool to make Time Interval measures using the Tektronix FCA3103\n\n@file\n@date Created on Sep. 16, 2015\n@author Felipe Torres (torresfelipex1<AT>gmail.com)\n@copyright LGPL v2.1\n\"\"\"\nimport datetime\nimport argparse as arg\nfrom subprocess import check_output\nfrom FCA3103 import FCA3103\n\ndef main():\n    \"\"\"\n    Tool for automatize the control of Tektronix FCA3103 Timer/Counter\n    \"\"\"\n    parser = arg.ArgumentParser(description='Tektronix FCA3103 tool')\n    parser.add_argument('--function', '-f', help='Measuring Function', choices=['mtint', 'tint'], required=True)\n    parser.add_argument('--interval', '-t', help='Time between samples', type=int)\n    parser.add_argument('--samples', '-s', help='Number of samples', type=int, default=1)\n    parser.add_argument('--debug', '-d', help='Enable debug output', action='store_true', default=False)\n    parser.add_argument('--device', '-l', help='Device port', type=int, default=1)\n    parser.add_argument('--output', '-o', help='Output data file', type=str)\n    parser.add_argument('--ref', '-r', help='Input channel for the reference', type=int, choices=[1, 2], default=1)\n    parser.add_argument('--trigl', '-g', help='Input trigger level', type=float, default=1.5)\n    parser.add_argument('--skip', '-i', help='Ignore values far from mean  plus error', type=int, default=0)\n    parser.add_argument('--tstamp', '-x', help='Add timestamping for each measure', action='store_true', default=False)\n    args = parser.parse_args()\n    valid_port = False\n    ports = check_output(['ls /dev | grep usbtmc'], shell=True)[:-1]\n    for p in ports.splitlines():\n        p = p.decode('utf-8')\n        if int(p[-1]) == args.device:\n            valid_port = True\n    if not valid_port:\n        print('No device found at /dev/usbtmc%d' % args.device)\n        exit(6)\n    device = FCA3103(args.device, args.ref, 2 if args.ref == 1 else 1)\n    device.show_dbg = args.debug\n    device.t_samples = args.interval\n    device.n_samples = args.samples\n    device.skip_values = True if args.skip > 0 else False\n    device.error = args.skip\n    device.trig_level[0] = device.trig_level[0] = args.trigl\n    if args.function == 'mtint':\n        print('Measuring Mean Time Interval between the inputs (%d secs)...' % args.samples)\n        mean = device.mean_time_interval(args.samples, args.interval)\n        print('Mean Time Interval for %d samples: %g' % (args.samples, mean))\n    elif args.function == 'tint':\n        print('Measuring Time Interval between the inputs (%d secs)...' % (args.samples + 10))\n        values = device.time_interval(args.samples, tstamp=args.tstamp)\n        if args.output:\n            with open(args.output, 'a+') as file:\n                file.write('# Time Interval Measurement (%d samples) with Tektronix FCA3103 (50ps)\\n' % args.samples)\n                file.write('# %s\\n' % datetime.datetime.now().strftime('%Y-%m-%d-%H-%M-%S'))\n                for v in values:\n                    if args.tstamp:\n                        file.write('%g\\t%g\\n' % (v[0], v[1]))\n                    else:\n                        file.write(str(v))\n                        file.write('\\n')\n            print(\"Output writed to '%s'\" % args.output)\n        else:\n            print('Time Interval Measurement (%d samples) with Tektronix FCA3103 (50ps)' % args.samples)\n            print('%s\\n' % datetime.datetime.now().strftime('%Y-%m-%d-%H-%M-%S'))\n            for v in values:\n                print(v)\nif __name__ == '__main__':\n    main()",
  "line_no": 60,
  "line_no_percent": "86%"
}