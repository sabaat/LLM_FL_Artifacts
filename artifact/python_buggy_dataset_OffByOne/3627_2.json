{
  "instruction": "This code converts bedtools cluster output of merged breakdancer calls into a feature table. To use it, you need to provide a bed file containing clustered deletion calls as an argument. You can also use the optional flag \"--bd\" or \"-b\" to indicate whether the input file has BreakDancer formatted IDs or 10X formatted IDs. The output feature table will have columns for each sample indicating the presence of each deletion. To run the code, execute the script and provide the required arguments.",
  "buggy_code": "import argparse\nimport fileinput\nimport re\nparser = argparse.ArgumentParser(description=\"Transform bedtools cluster output for deletion calls into a feature table of 'genotypes'.\")\nparser.add_argument('tenx', metavar='T', type=str, help='Bed file containing clustered deletion calls')\nparser.add_argument('--bd', '-b', action='store_true', help='Expect BreakDancer formatted IDs. Otherwise expect 10X formatted IDs.')\nargs = parser.parse_args()\nif args.bd:\n\n    def getSample(x):\n        \"\"\"Extract sample from BreakDancer formatted ID tags\"\"\"\n        return re.split('[_.]', x)[-2]\nelse:\n\n    def getSample(x):\n        \"\"\"Extract sample from 10X formatted ID tags\"\"\"\n        return x.split('.')[0]\ndels = []\nsamples = set()\nwith fileinput.input(args.tenx) as bed:\n    for li in bed:\n        t = li.strip().split()\n        s = getSample(t[2])\n        n = int(t[4])\n        samples.add(s)\n        if len(dels) < n:\n            dels.append(set([s]))\n        else:\n            dels[n - 1].add(s)\nsamples = sorted(list(samples))\nprint('Deletion', *samples, sep='\\t')\nfor n, delSamples in enumerate(dels):\n    feats = [1 if i in delSamples else 0 for i in samples]\n    print('_'.join(['del', str(n + 1)]), *feats, sep='\\t')",
  "line_no": 25,
  "line_no_percent": "74%"
}