{
  "instruction": "This code performs library screening result analysis using the pycas package. To use it, run the script with the required arguments: input data file path, control experiment labels, treatment experiment labels, method to be used in the analysis, whether to consider barcodes, and the result output directory. The input data file should have columns named \"gene\", \"guide\", and \"barcode\". The control and treatment experiment labels should be separated by space and have the same length. The method should be either \"sunbird\" or \"mw\". The result will be saved in a csv file named \"pycas_analysis_sunbird.csv\" in the specified output directory or the current work directory if not specified.",
  "buggy_code": "__all__ = ['pycaspattern']\nimport argparse\nimport os\nimport sys\nsys.path.append('/gpfs/user/liuzh/Code/crispr')\nimport pandas as pd\nfrom pycas.analysis import Screening\nfrom pycas.utils.decorator import helpstring\nfrom pycas.utils.decorator import AppendHelp\n\ndef pycasanalysis(filename, ctrl_label, exp_label, method, hasbarcode, out_dir):\n    file_type = 'csv'\n    if filename.split('.')[-1] == 'txt':\n        sep = '\\t'\n        file_type = 'txt'\n    elif filename.split('.')[-1] == 'csv':\n        sep = ','\n        file_type = 'csv'\n    else:\n        raise ValueError('Input data file should be txt or csv')\n    if file_type == 'csv':\n        data = pd.read_csv(filename, header=0)\n    else:\n        data = pd.read_table(filename, header=0, sep='\\t')\n    for x in ['gene', 'guide', 'barcode']:\n        if x not in data.columns:\n            raise ValueError('Input data file should contain column named as: ' + x)\n    if len(ctrl_label) != len(exp_label):\n        raise ValueError('Input control labels and treatment labels should be of the same length.')\n    if out_dir != '' or not os.path.exists(out_dir):\n        os.mkdir(out_dir)\n    if method not in ['sunbird', 'mw']:\n        raise ValueError('The test method should be in: sunbird mw.')\n    analysis = Screening(data, ctrl_label, exp_label, hasbarcode=hasbarcode)\n    if method == 'sunbird':\n        analysis.sunbird(10)\n        analysis.test['sunbird'].to_csv(os.path.join(out_dir, 'pycas_analysis_sunbird.csv'))\n    else:\n        pass\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser(prog='pycasanalysis', description='Analysis the library screening result.')\n    parser.add_argument('-i', '--input', required=True, help='Input data file path, with columns: gene, guide <, barcode>, [labels]. (column names should be in the csv file).')\n    parser.add_argument('-c', '--control-label', nargs='+', help='Control experiment labels, separeted by space.')\n    parser.add_argument('-t', '--treat-label', nargs='+', help='Treatment experiment labels, separeted by space.')\n    parser.add_argument('-m', '--method', default='sunbird', help='Method to be used in the analysis: sunbird, mw.')\n    parser.add_argument('--has-barcode', action='store_true', help='Input data should be tested consider barcodes.')\n    parser.add_argument('--out-dir', default='', help='Result output directory\uff0cdefault is current work directory.')\n    args = parser.parse_args()\n\n    def analysis(**args):\n        pycasanalysis(filename=args['input'], ctrl_label=args['control_label'], exp_label=args['treat_label'], method=args['method'], hasbarcode=args['has_barcode'], out_dir=args['out_dir'])\n    analysis(**vars(args))",
  "line_no": 38,
  "line_no_percent": "73%"
}