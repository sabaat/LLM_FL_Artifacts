{
  "instruction": "Generate a RESTful API in Python which allows users to register, log in/out, and update user profiles.",
  "buggy_code": "import os\nimport uuid\nimport datetime\nfrom flask import Flask, jsonify, request\nfrom flask_sqlalchemy import SQLAlchemy\nimport jwt\nfrom werkzeug.security import generate_password_hash, check_password_hash\napp = Flask(__name__)\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:////tmp/test.db'\napp.config['SECRET_KEY'] = 'secret-key'\napp.config['JWT_SECRET_KEY'] = 'jwt-secret-key'\ndb = SQLAlchemy(app)\napp.config['JWT_ACCESS_TOKEN_EXPIRES'] = datetime.timedelta(days=1)\napp.config['JWT_REFRESH_TOKEN_EXPIRES'] = datetime.timedelta(days=30)\n\nclass User(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    public_id = db.Column(db.String(50), unique=True)\n    username = db.Column(db.String(100), unique=True)\n    password = db.Column(db.String(255))\n    first_name = db.Column(db.String(100))\n    last_name = db.Column(db.String(100))\n\n@app.route('/register', methods=['POST'])\ndef register():\n    data = request.get_json()\nuser = User.query.filter_by(username=data['username']).first()\nif user:\n    return (jsonify({'message': 'User already exists!'}), 400)\npublic_id = str(uuid.uuid4())\nhashed_password = generate_password_hash(data['password'], method='sha256')\nuser = User(public_id=public_id, username=data['username'], password=hashed_password, first_name=data['first_name'], last_name=data['last_name'])\ndb.session.add(user)\ndb.session.commit()\nreturn (jsonify({'public_id': public_id}), 201)\n\n@app.route('/login', methods=['POST'])\ndef login():\n    data = request.get_json()\n    user = User.query.filter_by(username=data['username']).first()\nif not user and (not check_password_hash(user.password, data['password'])):\n    return (jsonify({'message': 'Invalid credentials!'}), 400)\naccess_token = jwt.encode({'public_id': user.public_id, 'exp': datetime.datetime.utcnow() + datetime.timedelta(minutes=30)}, app.config['JWT_SECRET_KEY'])\nrefresh_token = jwt.encode({'public_id': user.public_id, 'exp': datetime.datetime.utcnow() + datetime.timedelta(days=30)}, app.config['JWT_SECRET_KEY'])\nreturn (jsonify({'access_token': access_token.decode('UTF-8'), 'refresh_token': refresh_token.decode('UTF-8')}), 200)\n\n@app.route('/update_profile', methods=['POST'])\ndef update_profile():\n    data = request.get_json()\npublic_id = jwt.decode(data['access_token'], app.config['JWT_SECRET_KEY'])['public_id']\nuser = User.query.filter_by(public_id=public_id).first()\nuser.first_name = data['first_name']\nuser.last_name = data['last_name']\ndb.session.commit()\nreturn jsonify({'message': 'Profile updated'})\nif __name__ == '__main__':\n    db.create_all()\n    port = int(os.environ.get('PORT', 5000))\n    app.run(host='0.0.0.0', port=port)",
  "line_no": 51,
  "line_no_percent": "86%"
}