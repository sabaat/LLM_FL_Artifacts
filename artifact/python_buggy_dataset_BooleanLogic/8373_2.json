{
  "instruction": "Create a custom script to detect and install all MetaToolKit dependencies on Ubuntu. Use the given code as a reference. The script should check for Python essentials and required packages such as numpy, sympy, xlrd, xlwt, matplotlib, PyQt4, Bio, nose, docx, libsbml, cbmpy, java, perl, and blastall. It should also check for optional/recommended packages such as git, cython, libxml2-dev, libxslt-dev, ipython, ipython-notebook, python-suds, and python-flask. The script should generate a bash script that can be run to install the dependencies. The bash script should prompt the user for confirmation before installing the dependencies.",
  "buggy_code": "import os, subprocess, itertools, stat\nUBUNTU = CONDA = False\ntry:\n    print(os.sys.argv)\n    arg = os.sys.argv[1]\nexcept:\n    arg = 'UBUNTU'\nif arg == 'UBUNTU':\n    UBUNTU = True\nelif arg == 'CONDA':\n    CONDA = True\nelse:\n    print('\\nPlease call script with CONDA as argument for Anaconda install script, defaulting to UBUNTU')\n    UBUNTU = True\nres = {'Required': {}, 'Optional': {}}\nreqcnt = itertools.count(1, 1)\noptcnt = itertools.count(1, 1)\nif UBUNTU:\n    res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install build-essential g++ gfortran python python-dev'\nif CONDA:\n    pass\ntry:\n    import pip\nexcept ImportError:\n    if UBUNTU:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install python-pip'\ntry:\n    import numpy\nexcept ImportError:\n    if UBUNTU:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install python-numpy'\ntry:\n    import sympy\nexcept ImportError:\n    if UBUNTU:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install python-sympy'\ntry:\n    import xlrd\nexcept ImportError:\n    if UBUNTU:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install python-xlrd'\ntry:\n    import xlwt\nexcept ImportError:\n    if UBUNTU:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install python-xlwt'\ntry:\n    import matplotlib\nexcept ImportError:\n    if UBUNTU:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install python-matplotlib'\ntry:\n    import PyQt4\nexcept ImportError:\n    if UBUNTU:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install python-qt4'\n    elif CONDA:\n        res['Required'][reqcnt.next()] = 'conda install -y pyqt=4.11.4'\ntry:\n    import Bio\nexcept ImportError:\n    if UBUNTU:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install python-biopython'\n    elif CONDA:\n        res['Required'][reqcnt.next()] = 'conda install -y biopython'\ntry:\n    import nose\nexcept ImportError:\n    if UBUNTU:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install python-nose'\ntry:\n    import docx\nexcept ImportError:\n    if UBUNTU:\n        res['Required'][reqcnt.next()] = 'sudo -EH pip install docx'\n    elif CONDA:\n        res['Required'][reqcnt.next()] = 'pip install docx'\ntry:\n    import libsbml\n    if libsbml.LIBSBML_VERSION < 51201:\n        print('\\nPlease update to the latest version of libSBML.\\n')\n        raise ImportError\nexcept ImportError:\n    if UBUNTU:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install libxml2 libxml2-dev libxslt-dev zlib1g zlib1g-dev bzip2 libbz2-dev'\n        res['Required'][reqcnt.next()] = 'sudo -EH pip install --upgrade python-libsbml'\n    elif CONDA:\n        res['Required'][reqcnt.next()] = 'conda install -c SBMLTeam -y python-libsbml'\ntry:\n    import cbmpy\nexcept:\n    if UBUNTU:\n        res['Required'][reqcnt.next()] = 'sudo -EH pip install --upgrade cbmpy'\n        res['Required'][reqcnt.next()] = 'sudo python -c \"import cbmpy\"'\n    if CONDA:\n        res['Required'][reqcnt.next()] = 'pip install cbmpy'\n        res['Required'][reqcnt.next()] = 'python -c \"import cbmpy\"'\ntry:\n    out = subprocess.call(['java', '-version'])\nexcept OSError:\n    if UBUNTU and CONDA:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install default-jre'\ntry:\n    out = subprocess.call(['perl', '-v'])\nexcept OSError:\n    if UBUNTU or CONDA:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install perl'\np_script = 'my $rc = 0;\\n$rc = eval\\n{\\n  require XML::Parser;\\n  XML::Parser->import();\\n  1;\\n};\\nif ($rc){\\n    exit 0\\n    } else {\\n    exit 1\\n    }\\n'\ntry:\n    PF = file('_test.pl', 'w')\n    PF.write(p_script)\n    PF.close()\n    out = int(subprocess.call(['perl', '_test.pl']))\n    if out:\n        raise OSError\nexcept OSError:\n    if UBUNTU or CONDA:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install libxml-parser-perl'\ntry:\n    out = subprocess.call(['blastall'])\nexcept OSError:\n    if UBUNTU or CONDA:\n        res['Required'][reqcnt.next()] = 'sudo -E apt-get -y install blast2'\nif UBUNTU:\n    res['Optional'][optcnt.next()] = 'sudo apt-get -y install git cython libxml2-dev libxslt-dev'\ntry:\n    import IPython\nexcept ImportError:\n    if UBUNTU:\n        res['Optional'][optcnt.next()] = 'sudo -E apt-get -y install ipython ipython-notebook'\ntry:\n    import suds\nexcept ImportError:\n    if UBUNTU:\n        res['Optional'][optcnt.next()] = 'sudo -E apt-get -y install python-suds'\n    elif CONDA:\n        res['Optional'][optcnt.next()] = 'pip install suds'\ntry:\n    import flask\nexcept ImportError:\n    if UBUNTU:\n        res['Optional'][optcnt.next()] = 'sudo -E apt-get -y install python-flask'\nif UBUNTU or CONDA:\n    bash_script = '    while true; do\\n        read -p \"Do you wish to install *{}* MetaToolkit dependencies? [y/n]: \" yn\\n        case $yn in\\n            [Yy]* ) echo \"Installing ...\"; break;;\\n            [Nn]* ) exit;;\\n            * ) echo \"Please enter y/n.\";;\\n        esac\\n    done\\n    \\n    '\n    bash_script = '    \\n    \\n    '\n    output = '#!/bin/sh\\n\\n'\n    output += '#MetaToolkit: Ubuntu system requirements check\\n'\n    output += '#=============================================\\n\\n'\n    REQUIRE_USER_INPUT = False\n    for r in res:\n        if len(res[r]) > 0:\n            if REQUIRE_USER_INPUT:\n                output += bash_script.format(r)\n            output += '#{}\\n#{}\\n\\n'.format(r, '-' * len(r))\n            resk = list(res[r])\n            resk.sort()\n            for k in resk:\n                if k != None:\n                    output += '{}\\n'.format(res[r][k])\n            output += '\\n'\n    output += 'exit\\n\\n'\n    fname = 'metatoolkit_install_dependencies.sh'\n    F = file(fname, 'w')\n    F.write(output)\n    F.close()\n    os.chmod(fname, stat.S_IRWXU)\n    print('')\n    print(output)\n    print('\\n\\nInstall script (shown above) saved as file: {}\\nplease examine it carefully and run. Alternatively install individual dependencies manually').format(fname)",
  "line_no": 106,
  "line_no_percent": "63%"
}