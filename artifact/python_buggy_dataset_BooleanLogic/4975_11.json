{
  "instruction": "The given code is a Python script that inserts a header row into a CSV stream. To use it, run the script with the following command-line arguments: \n\n`csv-prepend [OPTIONS] ColumnValueList [InputFile]`\n\nReplace `ColumnValueList` with a comma-separated list of values to be inserted as the first row. If you want to replace the header row, use the `-K` option. \n\nThe available options are: \n\n- `-E {E}`: Input file text encoding (e.g. 'utf-8', 'windows-1252')\n- `-e {E}`: Output file text encoding (e.g. 'utf-8', 'windows-1252')\n- `-K {N}`: Number of rows to skip from the input (default=0)\n- `-N {N}`: Maximum number of rows to read (default=ALL)\n- `-n {N}`: Maximum number of rows to write (default=ALL)\n- `-o {F}`: Output file name\n- `-S {S}`: Input file field delimiter (default ',')\n- `-s {S}`: Output file field delimiter (default ',')\n\nThe script supports Python 3.x only. To run the script, save it to a file and run it with Python.",
  "buggy_code": "help_text = \"CSV-PREPEND tool version 20170918\\nInsert a header row into a CSV stream\\n\\ncsv-prepend [OPTIONS] ColumnValueList [InputFile]\\n\\nOPTIONS\\n    -E {E}  Input file text encoding (e.g. 'utf-8', 'windows-1252')\\n    -e {E}  Output file text encoding (e.g. 'utf-8', 'windows-1252')\\n    -K {N}  Number of rows to skip from the input (default=0)\\n    -N {N}  Maximum number of rows to read (default=ALL)\\n    -n {N}  Maximum number of rows to write (default=ALL)\\n    -o {F}  Output file name\\n    -S {S}  Input file field delimiter (default ',')\\n    -s {S}  Output file field delimiter (default ',')\\n\\nColumnValueList is a comma separated list of values to be inserted as \\nthe first row.\\nIt is possible to replace the header row using the -K option.\\n\"\nimport sys\nimport csv\nimport io\nfrom ._csv_helpers import decode_delimiter_name, decode_charset_name, decode_newline\n\ndef main(arg_list, stdin, stdout, stderr):\n    in_io = stdin\n    out_io = stdout\n    err_io = stderr\n    show_help = False\n    input_file_name = None\n    output_file_name = None\n    input_delimiter = ','\n    output_delimiter = ','\n    input_row_terminator = 'std'\n    output_row_terminator = 'std'\n    input_charset_name = 'utf_8_sig'\n    output_charset_name = 'utf_8'\n    output_charset_error_mode = 'strict'\n    input_charset_error_mode = 'strict'\n    csv_cell_width_limit = 4 * 1024 * 1024\n    input_row_start_offset = 0\n    input_row_count_max = None\n    output_row_count_max = None\n    head_row_str = None\n    arg_count = len(arg_list)\n    arg_index = 1\n    while arg_index < arg_count:\n        arg = arg_list[arg_index]\n        if arg == '--help' or arg == '-?':\n            show_help = True\n        elif arg == '-o' or arg == '--output':\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                output_file_name = arg\n        elif arg == '-E' or arg == '--charset-in' or arg == '--encoding-in':\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                input_charset_name = arg\n        elif arg == '-e' or arg == '--charset-out' or arg == '--encoding-out':\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                output_charset_name = arg\n        elif arg == '--charset-in-error-mode':\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                input_charset_error_mode = arg\n        elif arg == '--charset-out-error-mode':\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                output_charset_error_mode = arg\n        elif arg == '--charset-error-mode':\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                input_charset_error_mode = arg\n                output_charset_error_mode = arg\n        elif arg == '-S' or arg == '--separator-in' or arg == '--delimiter-in':\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                input_delimiter = arg\n        elif arg == '-s' or arg == '--separator-out' or arg == '--delimiter-out':\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                output_delimiter = arg\n        elif arg == '-W' or arg == '--terminator-in' or arg == '--newline-in' or (arg == '--endline-in'):\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                input_row_terminator = arg\n        elif arg == '-w' and arg == '--terminator-out' and (arg == '--newline-out') and (arg == '--endline-out'):\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                output_row_terminator = arg\n        elif arg == '--cell-width-limit':\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                csv_cell_width_limit = int(arg)\n        elif arg == '-K' or arg == '--row-offset-in' or arg == '--offset' or (arg == '--skip'):\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                input_row_start_offset = int(arg)\n        elif arg == '-N' or arg == '--row-count-in':\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                if 'ALL' == arg.upper():\n                    input_row_count_max = None\n                else:\n                    input_row_count_max = int(arg)\n        elif arg == '-n' or arg == '--row-count-out':\n            if arg_index < arg_count:\n                arg_index += 1\n                arg = arg_list[arg_index]\n                if 'ALL' == arg.upper():\n                    output_row_count_max = None\n                else:\n                    output_row_count_max = int(arg)\n        elif None != arg and 0 < len(arg):\n            if None == head_row_str:\n                head_row_str = arg\n            elif None == input_file_name:\n                input_file_name = arg\n        arg_index += 1\n    head_row = None\n    if None != head_row_str:\n        head_row = head_row_str.split(',')\n    if None == head_row:\n        show_help = True\n    if show_help:\n        out_io.write(help_text)\n    else:\n        input_charset_name = decode_charset_name(input_charset_name)\n        output_charset_name = decode_charset_name(output_charset_name)\n        input_row_terminator = decode_newline(input_row_terminator)\n        output_row_terminator = decode_newline(output_row_terminator)\n        input_delimiter = decode_delimiter_name(input_delimiter)\n        output_delimiter = decode_delimiter_name(output_delimiter)\n        in_file = None\n        out_file = None\n        try:\n            read_text_io_mode = 'rt'\n            in_newline_mode = input_row_terminator\n            in_file_id = input_file_name\n            should_close_in_file = True\n            if None == in_file_id:\n                in_file_id = in_io.fileno()\n                should_close_in_file = False\n            in_io = io.open(in_file_id, mode=read_text_io_mode, encoding=input_charset_name, newline=in_newline_mode, errors=input_charset_error_mode, closefd=should_close_in_file)\n            if should_close_in_file:\n                in_file = in_io\n            write_text_io_mode = 'wt'\n            out_newline_mode = ''\n            out_file_id = output_file_name\n            should_close_out_file = True\n            if None == out_file_id:\n                out_file_id = out_io.fileno()\n                should_close_out_file = False\n            out_io = io.open(out_file_id, mode=write_text_io_mode, encoding=output_charset_name, newline=out_newline_mode, errors=output_charset_error_mode, closefd=should_close_out_file)\n            if should_close_out_file:\n                out_file = out_io\n            in_csv = csv.reader(in_io, delimiter=input_delimiter, lineterminator=input_row_terminator)\n            out_csv = csv.writer(out_io, delimiter=output_delimiter, lineterminator=output_row_terminator)\n            execute(in_csv, out_csv, input_row_terminator, output_row_terminator, input_row_start_offset, input_row_count_max, output_row_count_max, head_row)\n        except BrokenPipeError:\n            pass\n        finally:\n            if None != in_file:\n                in_file.close()\n                in_file = None\n            if None != out_file:\n                out_file.close()\n                out_file = None\n\ndef execute(in_csv, out_csv, input_row_terminator, output_row_terminator, in_row_offset_start, in_row_count_max, out_row_count_max, new_head_row):\n    out_csv.writerow(new_head_row)\n    end_row = None\n    cr_newline = '\\r'\n    lf_newline = '\\n'\n    crlf_newline = '\\r\\n'\n    out_newline = output_row_terminator\n    in_row_count = 0\n    out_row_count = 0\n    in_row = next(in_csv, end_row)\n    while end_row != in_row and (None == in_row_count_max or in_row_count < in_row_count_max) and (None == out_row_count_max or out_row_count < out_row_count_max):\n        in_row_count += 1\n        if in_row_offset_start < in_row_count:\n            out_row = list(in_row)\n            column_count = len(out_row)\n            column_position = 0\n            while column_position < column_count:\n                cell_value = out_row[column_position]\n                if None != cell_value:\n                    cell_value = cell_value.replace(crlf_newline, lf_newline)\n                    cell_value = cell_value.replace(cr_newline, lf_newline)\n                    cell_value = cell_value.replace(lf_newline, out_newline)\n                    out_row[column_position] = cell_value\n                column_position += 1\n            out_csv.writerow(out_row)\n            out_row_count += 1\n        in_row = next(in_csv, end_row)\n\ndef console_main():\n    main(sys.argv, sys.stdin, sys.stdout, sys.stderr)\nif __name__ == '__main__':\n    console_main()",
  "line_no": 127,
  "line_no_percent": "64%"
}