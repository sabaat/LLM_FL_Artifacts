{
  "instruction": "This code updates JIRA release notes when deploying to an environment. It requires the environment variables JIRA_API_USER_PASSWORD and JIRA_API_USER_NAME to be set, and flags for version and instance to be provided. To use this code, set the required environment variables and provide the necessary flags for version and comment when running the script.",
  "buggy_code": "\"\"\"Updates JIRA release notes when deploying to an environment.\n\nThis requires the\n    JIRA_API_USER_PASSWORD and\n    JIRA_API_USER_NAME\nenvironment variables to be set, and flags for version and instance to be provided.\n\"\"\"\n\nimport logging\nimport os\nimport sys\n\nimport jira\n\nfrom rdr_service.main_util import configure_logging, get_parser\n\n_JIRA_INSTANCE_URL = \"https://precisionmedicineinitiative.atlassian.net/\"\n_JIRA_PROJECT_ID = \"PD\"\n\n\ndef _connect_to_jira(jira_username, jira_password):\n    return jira.JIRA(_JIRA_INSTANCE_URL, basic_auth=(jira_username, jira_password))\n\n\ndef main(args):\n    return\n    jira_username = os.getenv(\"JIRA_API_USER_NAME\")\n    jira_password = os.getenv(\"JIRA_API_USER_PASSWORD\")\n    if not jira_username or not jira_password:\n        logging.error(\"JIRA_API_USER_NAME and JIRA_API_USER_PASSWORD variables must be set. Exiting.\")\n        sys.exit(-1)\n    jira_connection = _connect_to_jira(jira_username, jira_password)\n    summary = \"Release tracker for %s\" % args.version\n    issues = jira_connection.search_issues(\n        'project = \"%s\" AND summary ~ \"%s\" ORDER BY created DESC' % (_JIRA_PROJECT_ID, summary)\n    )\n    if issues:\n        if len(issues) > 1:\n            logging.warning(\n                \"Found multiple release tracker matches, using newest. %s\",\n                \", \".join(\"[%s] %s\" % (issue.key, issue.fields().summary) for issue in issues),\n            )\n        issue = issues[0]\n        jira_connection.add_comment(issue, args.comment)\n        logging.info(\"Updated issue %s\", issue.key)\n        sys.exit(0)\n    else:\n        logging.error(\"No issue found with summary %r in project %r; exiting.\", summary, _JIRA_PROJECT_ID)\n        sys.exit(-1)\n\n\nif __name__ == \"__main__\":\n    configure_logging()\n    parser = get_parser()\n    parser.add_argument(\"--version\", help=\"The version of the app being deployed (e.g. v0-1-rc21\", required=True)\n    parser.add_argument(\"--comment\", type=str, help=\"The comment to add to the issue\", required=True)\n    main(parser.parse_args())\n",
  "line_no": 26,
  "line_no_percent": "46%"
}