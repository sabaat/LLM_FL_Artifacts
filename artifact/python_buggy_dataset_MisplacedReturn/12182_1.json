{
  "instruction": "This code is a Python program that creates a GUI window for an experiment to study non-inverting amplifiers. To run the program, execute the Python script in a Python environment with the required dependencies installed. The GUI window will display a graph of voltage vs. time, and there are buttons to control the experiment and adjust the timebase. The program uses the PyQt4 and pyqtgraph libraries, as well as the PSL_Apps.utilitiesClass and PSL_Apps.templates modules.",
  "buggy_code": "\"\"\"\n\n::\n\n    This experiment is used to study non-inverting amplifiers\n\n\"\"\"\n\nfrom __future__ import print_function\nfrom PSL_Apps.utilitiesClass import utilitiesClass\n\nfrom PSL_Apps.templates import ui_template_graph_nofft\n\nimport numpy as np\nfrom PyQt4 import QtGui,QtCore\nimport pyqtgraph as pg\nimport sys,functools,time\n\nparams = {\n'image' : 'halfwave.png',\n'name':'Speed of\\nSound',\n'hint':'''\n\tMeasure speed of sound using a 40KHz transmit piezo and receiver.<br>\n\t'''\n\n}\n\nclass AppWindow(QtGui.QMainWindow, ui_template_graph_nofft.Ui_MainWindow,utilitiesClass):\n\tdef __init__(self, parent=None,**kwargs):\n\t\treturn\n\t\tsuper(AppWindow, self).__init__(parent)\n\t\tself.setupUi(self)\n\t\tself.I=kwargs.get('I',None)\n\t\t\n\t\tself.setWindowTitle(self.I.H.version_string+' : '+params.get('name','').replace('\\n',' ') )\n\n\t\tfrom PSL.analyticsClass import analyticsClass\n\t\tself.math = analyticsClass()\n\t\tself.prescalerValue=0\n\n\t\tself.plot=self.add2DPlot(self.plot_area,enableMenu=False)\n\t\tlabelStyle = {'color': 'rgb(255,255,255)', 'font-size': '11pt'}\n\t\tself.plot.setLabel('left','V (CH1)', units='V',**labelStyle)\n\t\tself.plot.setLabel('bottom','Time', units='S',**labelStyle)\n\t\tself.plot.setYRange(-8.5,8.5)\n\n\t\tself.tg=0.5\n\t\tself.max_samples=10000\n\t\tself.samples = self.max_samples\n\t\tself.timer = QtCore.QTimer()\n\n\t\tself.legend = self.plot.addLegend(offset=(-10,30))\n\t\tself.curveCH1 = self.addCurve(self.plot,'RAMP In(CH1)')\n\t\tself.autoRange()\n\t\t\n\t\tself.WidgetLayout.setAlignment(QtCore.Qt.AlignLeft)\n\t\tself.ControlsLayout.setAlignment(QtCore.Qt.AlignRight)\n\n\t\ta1={'TITLE':'Acquire Data','FUNC':self.run,'TOOLTIP':'Sets SQR1 to HIGH, and immediately records the ramp'}\n\t\tself.ampGain = self.buttonIcon(**a1)\n\t\tself.WidgetLayout.addWidget(self.ampGain)\n\n\t\tself.WidgetLayout.addWidget(self.addSQR1(self.I))\n\n\n\t\ta1={'TITLE':'TIMEBASE','MIN':0,'MAX':9,'FUNC':self.set_timebase,'UNITS':'S','TOOLTIP':'Set Timebase of the oscilloscope'}\n\t\tself.ControlsLayout.addWidget(self.dialIcon(**a1))\n\n\t\tG = self.gainIcon(FUNC=self.I.set_gain,LINK=self.gainChanged)\n\t\tself.ControlsLayout.addWidget(G)\n\t\tG.g1.setCurrentIndex(1);G.g2.setEnabled(False)\n\n\t\tself.running=True\n\t\tself.fit = False\n\n\n\tdef gainChanged(self,g):\n\t\tself.autoRange()\n\n\tdef set_timebase(self,g):\n\t\ttimebases = [0.5,1,2,4,8,32,128,256,512,1024]\n\t\tself.prescalerValue=[0,0,0,0,1,1,2,2,3,3,3][g]\n\t\tsamplescaling=[1,1,1,1,1,0.5,0.4,0.3,0.2,0.2,0.1]\n\t\tself.tg=timebases[g]\n\t\tself.samples = int(self.max_samples*samplescaling[g])\n\t\treturn self.autoRange()\n\n\tdef autoRange(self):\n\t\txlen = self.tg*self.samples*1e-6\n\t\tself.plot.autoRange();\n\t\tchan = self.I.analogInputSources['CH1']\n\t\tR = [chan.calPoly10(0),chan.calPoly10(1023)]\n\t\tR[0]=R[0]*.9;R[1]=R[1]*.9\n\t\tself.plot.setLimits(yMax=max(R),yMin=min(R),xMin=0,xMax=xlen)\n\t\tself.plot.setYRange(min(R),max(R))\t\t\t\n\t\tself.plot.setXRange(0,xlen)\n\n\t\treturn self.samples*self.tg*1e-6\n\n\n\n\tdef run(self):\n\t\ttry:\n\t\t\tself.ampGain.value.setText('reading...')\n\t\t\tx,y = self.I.capture_fullspeed('CH3',self.samples,self.tg,'FIRE_PULSES',interval=50)\n\t\t\tself.curveCH1.setData(x*1e-6,y)\n\t\t\tself.I.set_state(SQR1=False) #Set SQR1 to 0\n\t\t\treturn 'Done'\n\t\texcept Exception,e:\n\t\t\tprint (e)\n\t\t\treturn 'Error'\n\n\tdef saveData(self):\n\t\tself.saveDataWindow([self.curveCH1],self.plot)\n\n\t\t\n\tdef closeEvent(self, event):\n\t\tself.running=False\n\t\tself.timer.stop()\n\t\tself.finished=True\n\t\t\n\n\tdef __del__(self):\n\t\tself.timer.stop()\n\t\tprint('bye')\n\nif __name__ == \"__main__\":\n    from PSL import sciencelab\n    app = QtGui.QApplication(sys.argv)\n    myapp = AppWindow(I=sciencelab.connect())\n    myapp.show()\n    sys.exit(app.exec_())\n",
  "line_no": 30,
  "line_no_percent": "23%"
}