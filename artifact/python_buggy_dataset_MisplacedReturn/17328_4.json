{
  "instruction": "Create a Flask web app that generates an HTML wordcloud of words collected from a website, paragraph input, or file upload. The app should have an index router function that receives a POST request and displays the HTML wordcloud. The app should also have a function to get top keywords from an article. The app should reset everything and start over when the startover function is called. The app should run on debug mode.",
  "buggy_code": "'''\n\nPython implementation of HTML wordcloud of words collected from\na website, Paragraph Input or File Upload. Flask Web App implementation\nof the same.\n\nAuthor: Shivam Bansal\nEmail: shivam5992@gmail.com\nWebsite: www.shivambansal.com \nVersion: 0.1\n\n'''\n\nfrom flask import Flask, render_template, request, flash, redirect, url_for\nfrom BeautifulSoup import BeautifulSoup\nimport urllib, random, re, string, stopwords\n\napp = Flask(__name__)\napp.secret_key = 'You will never guess'\n\n'''\nIndex router function, Receive post request and displays the html wordcloud\n'''\n@app.route('/', methods = ['GET','POST'])\n@app.route('/index', methods = ['GET','POST'])\ndef index():\n\n\tif request.method == 'POST':\n\t\t\n\t\t''' Store post variables '''\n\t\turl = request.form['urllink']\n\t\tcase = request.form['case']\n\t\tshow_freq = request.form['show_freq']\n\t\t\n\t\t''' Try to connect with the URL '''\n\t\ttry:\n\t\t\tif not url.startswith(\"http\"):\n\t\t\t\turl = \"http://\" + url\n\t\t\thtmltext = urllib.urlopen(url).read()\n\t\texcept:\n\t\t\tflash(\"Cannot connect to the requested url\")\n\t\t\treturn redirect(url_for('startover'))\t\n\t\t\n\t\t''' Get all text from the html repsonse ''' \n\t\tsoup = BeautifulSoup(htmltext)\t\t\n\t\ttexts = soup.findAll(text=True)\n\t\tvisible_texts = filter(visible, texts)\n\t\tarticle = \"\"\n\t\tfor text in visible_texts:\n\t\t\tarticle += text.encode(\"utf-8\")\n\t\tarticle = str(article)\n\t\tarticle = BeautifulSoup(article, convertEntities=BeautifulSoup.HTML_ENTITIES)\n\t\t\n\t\t\n\t\tarticle = str(article).replace(\"\\n\",\" \")\n\n\t\t''' Get top keywords '''\n\t\tfreq = 50\n\t\ta = getKeywords(article, case, freq)\n\t\t\n\t\trandom.shuffle(a)\n\t\tb = [x[1] for x in a]\n\t\tminFreq = min(b)\n\t\tmaxFreq = max(b)\n\n\t\t''' Create html span tags and corresponding css '''\n\t\tspan = \"\"\n\t\tcss  = \"\"\"#box{font-family:'calibri';border:2px solid black;}\n\t\t\"\"\"\n\t\t\n\t\t''' Colors for words in wordcloud '''\n\t\tcolors = ['#607ec5','#002a8b','#86a0dc','#4c6db9']\n\t\tcolsize = len(colors)\n\t\tk = 0\n\t\tfor index,item in enumerate(a):\n\t\t\tindex += 1\n\t\t\tif case == \"upper\":\n\t\t\t\ttag = str(item[0]).upper()\n\t\t\telse:\n\t\t\t\ttag = str(item[0])\n\n\t\t\tif show_freq == \"yes\":\n\t\t\t\tspan += '<a href=#><span class=\"word'+str(index)+'\" id=\"tag'+str(index)+'\">&nbsp;' + tag + \" (\" + str(item[1]) + \") \" + \"&nbsp;</span></a>\\n\"\n\t\t\telse:\n\t\t\t\tspan += '<a href=#><span class=\"word'+str(index)+'\" id=\"tag'+str(index)+'\">&nbsp;' + tag + \"&nbsp;</span></a>\\n\"\t\n\t\t\t\n\t\t\t''' Algorithm to scale sizes'''\n\t\t\tfreqTag = int(item[1])\n\t\t\tfontMax = 5.5\n\t\t\tfontMin = 1.5\n\t\t\tK = (freqTag - minFreq)/(maxFreq - minFreq)\n\t\t\tfrange = fontMax - fontMin\n\t\t\tC = 4\n\t\t\t\n\t\t\tK = float(freqTag - minFreq)/(maxFreq - minFreq)\n\t\t\tsize = fontMin + (C*float(K*frange/C))\n\n\t\t\tcss += '#tag'+str(index)+'{font-size: '+ str(size) +'em;color: '+colors[int(k%colsize)]+'}\\n'\n\t\t \tcss += '#tag'+str(index)+':hover{color: red}\\n'\n\t\t \tk += 1\n\t\t\n\n\t\t''' Write the HTML and CSS into seperate files ''' \n\n\t\tf = open('templates/wordcloud.html', 'w')\n\t\tmessage = \"\"\"\n\t\t<style type=\"text/css\">\n\t\t\"\"\" + css +\"\"\"\n\t\t</style>\n\t\t<div id='box'>\n\t\t\t\"\"\" + span +  \"\"\"\n\t\t</div>\n\t\t\"\"\"\n\t\tf.write(message)\n\t\tf.close\n\t\tf.flush()\n\t\treturn render_template('index.html')\n\n\tstartover()\n\treturn render_template('index.html')\n\n''' \nFunction to get top keywords from an article \n'''\ndef getKeywords(articletext, case, freq):\n\n\t''' Create the dictionary for output response '''\n\tword_dict = {}\n\tword_list = articletext.lower().split()\n\tfiltered_words = word_list\n\n\tfor word in filtered_words:\n\t\tif word not in stopwords.stopwords and word.isalnum() and not word.isdigit() and not len(word) == 1:\n\t\t\tif word not in word_dict:\n\t\t\t\tword_dict[word] = 1\n\t\t\tif word in word_dict:\n\t\t\t\tword_dict[word] += 1\n\n\ttop_words =  sorted(word_dict.items(),key=lambda(k,v):(v,k),reverse=True)[0:freq]\n\n\t'''  Return a list of dictionaies, dictionaies contains word and their frequencies '''\t\n\ttop = []\n\tfor w in top_words:\n\t\ttop.append(w)\n\treturn top\n\n'''\nFunction to reset everthing and startover\n'''\n@app.route('/startover')\ndef startover():\n\tf = open(\"templates/wordcloud.html\",'w')\n\tf.write(\"\")\n\tf.close\n\treturn redirect(url_for('index'))\n\ndef visible(element):\n\t\t    return\n\t\t    if element.parent.name in ['style', 'script', '[document]', 'head', 'title']:\n\t\t        return False\n\t\t    elif re.match('<!--.*-->', str(element)):\n\t\t        return False\n\t\t    return True\n\n'''\nRun the Flask Application\n'''\nif __name__ == '__main__':\n\tapp.run(debug = True)\n",
  "line_no": 158,
  "line_no_percent": "93%"
}