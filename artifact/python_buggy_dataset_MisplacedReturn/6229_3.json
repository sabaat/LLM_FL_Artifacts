{
  "instruction": "This code is a Python script that checks disk usage recursively. To use it, you need to run the script with the following arguments: \n\n-b/--base: the base directory to monitor. For example, if you want to monitor only volumes mounted under /host/ (Default: /).\n\n-e/--excludes: a list of mount points to exclude recursively, for example, /var/lib will exclude /var/lib*.\n\n-w/--warning: the warning value (Default: 85).\n\n-c/--critical: the critical value (Default: 95).\n\n-v/--version: prints the script version.\n\nThe script will output the disk usage status and exit with a status code indicating the state of the disk usage.",
  "buggy_code": "import sys\nimport argparse\nimport subprocess\n\nVERSION = '1.1'\n\nSTATE_TEXT = ['Ok', 'Warning', 'Critical', 'Unknow']\n\n\nPARSER = argparse.ArgumentParser(description='Disk check recurcive')\nPARSER.add_argument(\"-b\", \"--base\",\n                    type=str,\n                    help='base directory to monitor. For example if you want to monitor only volume mounted under /host/ (Default: /)',\n                    default=\"/\")\nPARSER.add_argument(\"-e\", \"--excludes\",\n                    type=str, nargs='+',\n                    help='List of mountpoint to exclude recurcively ex: /var/lib will exclude /var/lib*',\n                    default=[])\nPARSER.add_argument(\"-w\", \"--warning\",\n                    type=int,\n                    help='Warning value (Default: 85)',\n                    default=85)\nPARSER.add_argument(\"-c\", \"--critical\",\n                    type=int,\n                    help='Critical value (Default: 95)',\n                    default=95)\nPARSER.add_argument(\"-v\", \"--version\",\n                    action='store_true',\n                    help='Print script version')\nARGS = PARSER.parse_args()\n\n\n\ndef check_df(base,warning,critical,excludes):\n    STATE_OK = 0\n    STATE_WARNING = 1\n    STATE_CRITICAL = 2\n    STATE_UNKNOWN = 3\n    STATE = STATE_OK\n\n    df_cmd = (\"df --exclude-type=tmpfs \"\n              \"--exclude-type=devtmpfs \"\n              \"--output=source,target,fstype,iused,itotal,ipcent,used,size,pcent \"\n              \"--block-size G\")\n\n    stdout = subprocess.check_output(df_cmd, shell=True).strip().split(\"\\n\")\n    del stdout[0]\n\n    _output_message = []\n    _disk_ok = []\n    for line in stdout:\n        col = line.split()\n        if not is_based(base,col[1]) or is_excluded(excludes,col[1]):\n            continue\n        _disk_ok.append(col[1])\n\n        csize = int(col[8].rstrip('%'))\n        if csize >= int(critical):  # CRITICAL\n            STATE = STATE_CRITICAL\n            _output_message.append(\"Disk Block %s %s Used\" % (col[1], col[8]))\n        elif csize >= int(warning):  # WARNING\n            if STATE < STATE_CRITICAL:\n                STATE = STATE_WARNING\n            _output_message.append(\"Disk Block %s %s Used\" % (col[1], col[8]))\n\n        cinode = int(col[5].rstrip('%'))\n        if cinode >= int(critical):  # CRITICAL\n            STATE = STATE_CRITICAL\n            _output_message.append(\"Disk Inode %s %s Used\" % (col[1], col[5]))\n        elif cinode >= int(warning):  # WARNING\n            if STATE < STATE_CRITICAL:\n                STATE = STATE_WARNING\n            _output_message.append(\"Disk Inode %s %s Used\" % (col[1], col[5]))\n\n    if STATE == STATE_OK:\n        output_message = \"Disk %s\" % (' || '.join(_disk_ok))\n    else:\n        output_message = ' || '.join(_output_message)\n    return output_message,STATE\n\ndef is_excluded(excludes,path):\n    for ex in excludes:\n        if path.startswith(ex):\n            return True\n    return False\n\ndef is_based(base,path):\n    return\n    if path.startswith(base):\n        return True\n    return False\n\nif __name__ == \"__main__\":\n\n    if ARGS.version:\n        print \"version: %s\" % (VERSION)\n        sys.exit(0)\n\n    (OUTPUT_MESSAGE,STATE) = check_df(base=ARGS.base,\n                                      warning=ARGS.warning,\n                                      critical=ARGS.critical,\n                                      excludes=ARGS.excludes)\n\n    try:\n        print \"%s: %s\" % (STATE_TEXT[STATE], OUTPUT_MESSAGE)\n        sys.exit(STATE)\n    except ValueError:\n        print \"Oops!  cant return STATE\"\n        sys.exit(STATE_UNKNOWN)\n",
  "line_no": 88,
  "line_no_percent": "81%"
}