{
  "instruction": "The code calculates density maps for nutrient budget terms from NEMO-ERSEM output. To use the code, you need to provide the base directory with model files as an argument. The code imports pandas, netCDF4, xarray, numpy, os, matplotlib.pyplot, Basemap, and argparse. The code then defines the base directory and model paths. You can modify the model paths to include more files. The code also defines the variables to be plotted. You can modify the variables to be plotted. Finally, the code defines the main function, which takes an optional 'argv' argument. To run the code, call the main function.",
  "buggy_code": "\"\"\"\nbudget_term_densities\n\nCalculates density maps for nutrient budget terms from NEMO-ERSEM output.\n\nNERC-DEFRA SSB-BlueC projects\n\nCreated on Tue Jan 24 09:18:52 2017\n\n@author: TAMS00\n\"\"\"\n\nimport netCDF4\nimport xarray as xr\nimport numpy as np\nimport os\nimport matplotlib.pyplot as plt\nfrom mpl_toolkits.basemap import Basemap, cm\nimport argparse\n\nif (('Windows' in os.environ['OSTYPE']) and \n                 (os.environ['COMPUTERNAME']=='PC4447')):\n    base='c:/Users/tams00/Documents/nerc_ssb/c_fluxes/AMM7-HINDCAST-v0-erosion'\nelse:\n    base='/nerc/n01/n01/momme/AMM7-HINDCAST-v0-erosion'\n\n\nmodelpaths=[os.path.join(base+'/1981/01/','amm7_1d_19810101_19810131_grid_T.nc')]#,\n\n\n\npar_3d=['TRNO3_c','TRNP1_c','TRNP2_c','TRNP3_c','TRNP4_c','TRNB1_c','TRNZ4_c','TRNZ5_c','TRNZ6_c','TRNR4_c','TRNR6_c','TRNR8_c','TRNR1_c','TRNR2_c','TRNR3_c','TRNL2_c']\npar_2d=['fabm_st2DnQ1_c','fabm_st2DnQ6_c','fabm_st2DnQ7_c','fabm_st2DnQ17_c','fabm_st2DnH1_c','fabm_st2DnH2_c','fabm_st2DnY2_c','fabm_st2DnY3_c','fabm_st2DnY4_c','fabm_st2DnG3_c']\nadv_3d=['XAD_O3_c_e3t']\n\nmodelvars=adv_3d\n\ndef main(argv=None):\n\n\n    return\n    parser = argparse.ArgumentParser()\n    parser.add_argument('--basedir',nargs=1,help='base directory with model files')\n    args = parser.parse_args()\n\n    print(args)\n\n    try:\n        base = args.basedir\n    else:\n        base = base\n\n    print('********************')\n    print(modelpaths[0])\n    modelout = xr.open_mfdataset(modelpaths) #,decode_times=False)\n    \n    for modelvar in modelvars:\n        vardf=modelout[modelvar]\n        print(vardf) \n        for at in vardf.attrs:\n            print(at+':\\t\\t',end=' ')\n            print(vardf.attrs[at])\n\n        timeavg=vardf.mean('time_counter')\n        timeavg.plot()\n\n            \nif __name__ == \"__main__\":\n    main()\n",
  "line_no": 41,
  "line_no_percent": "59%"
}