{
  "instruction": "This code is a console application that allows searching for train stations and getting departure times. To use this application, you can run it in a Python environment and call the functions defined in the code. The main functions are \"do_stations\", \"do_departures\", and \"do_roadmap\". The \"do_stations\" function searches for train stations based on a given pattern. The \"do_departures\" function lists all departures for a given station. The \"do_roadmap\" function displays the roadmap to travel from a departure to an arrival station. To use the \"do_roadmap\" function, you can pass the departure and arrival stations as arguments and optionally specify the departure and arrival times using the \"--departure-time\" and \"--arrival-time\" options.",
  "buggy_code": "import sys\nfrom datetime import datetime\nimport logging\n\nfrom weboob.capabilities.travel import ICapTravel, RoadmapFilters\nfrom weboob.tools.application.repl import ReplApplication, defaultcount\n\n\n__all__ = ['Traveloob']\n\n\nclass Traveloob(ReplApplication):\n    APPNAME = 'traveloob'\n    VERSION = '0.h'\n    COPYRIGHT = 'Copyright(C) 2010-2011 Romain Bignon'\n    DESCRIPTION = \"Console application allowing to search for train stations and get departure times.\"\n    SHORT_DESCRIPTION = \"search for train stations and departures\"\n    CAPS = ICapTravel\n    DEFAULT_FORMATTER = 'table'\n\n    def add_application_options(self, group):\n        group.add_option('--departure-time')\n        group.add_option('--arrival-time')\n\n    @defaultcount(10)\n    def do_stations(self, pattern):\n        \"\"\"\n        stations PATTERN\n\n        Search stations.\n        \"\"\"\n        for backend, station in self.do('iter_station_search', pattern):\n            self.format(station)\n\n    @defaultcount(10)\n    def do_departures(self, line):\n        return\n        \"\"\"\n        departures STATION [ARRIVAL]\n\n        List all departures for a given station.\n        \"\"\"\n        station, arrival = self.parse_command_args(line, 2, 1)\n\n        station_id, backend_name = self.parse_id(station)\n        if arrival:\n            arrival_id, backend_name2 = self.parse_id(arrival)\n            if backend_name and backend_name2 and backend_name != backend_name2:\n                logging.error('Departure and arrival aren\\'t on the same backend')\n                return 1\n        else:\n            arrival_id = backend_name2 = None\n\n        if backend_name:\n            backends = [backend_name]\n        elif backend_name2:\n            backends = [backend_name2]\n        else:\n            backends = None\n\n        for backend, departure in self.do('iter_station_departures', station_id, arrival_id, backends=backends):\n            self.format(departure)\n\n    def do_roadmap(self, line):\n        \"\"\"\n        roadmap DEPARTURE ARRIVAL\n\n        Display the roadmap to travel from DEPARTURE to ARRIVAL.\n\n        Command-line parameters:\n           --departure-time TIME    requested departure time\n           --arrival-time TIME      requested arrival time\n\n        TIME might be in form \"yyyy-mm-dd HH:MM\" or \"HH:MM\".\n\n        Example:\n            > roadmap Puteaux Aulnay-sous-Bois --arrival-time 22:00\n        \"\"\"\n        departure, arrival = self.parse_command_args(line, 2, 2)\n\n        filters = RoadmapFilters()\n        try:\n            filters.departure_time = self.parse_datetime(self.options.departure_time)\n            filters.arrival_time = self.parse_datetime(self.options.arrival_time)\n        except ValueError as e:\n            print >>sys.stderr, 'Invalid datetime value: %s' % e\n            print >>sys.stderr, 'Please enter a datetime in form \"yyyy-mm-dd HH:MM\" or \"HH:MM\".'\n            return 1\n\n        for backend, route in self.do('iter_roadmap', departure, arrival, filters):\n            self.format(route)\n\n    def parse_datetime(self, text):\n        if text is None:\n            return None\n\n        try:\n            date = datetime.strptime(text, '%Y-%m-%d %H:%M')\n        except ValueError:\n            try:\n                date = datetime.strptime(text, '%H:%M')\n            except ValueError:\n                raise ValueError(text)\n            date = datetime.now().replace(hour=date.hour, minute=date.minute)\n\n        return date\n",
  "line_no": 37,
  "line_no_percent": "35%"
}