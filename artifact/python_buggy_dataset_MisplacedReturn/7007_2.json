{
  "instruction": "Use this code to create a simple, general purpose JSON RPC v1.0 over HTTP. The code provides a SimpleJSONRPCClient class that can be used to call remote methods and return results. To use the class, create an instance with the URL of the remote server, and then call the \"call\" method with the path, query, method, and arguments of the remote method you want to call. The method will return the result of the remote method call.",
  "buggy_code": "\"\"\"\nProvides a simple, general purpose JSON RPC v1.0 over HTTP.\n\nTODO: Asynchronous client handling multiple connections at once.\n\"\"\"\n\nimport json\n\nfrom pycopia import urls\nfrom pycopia.inet import httputils\nfrom pycopia.http.client import (HTTPRequest, RequestResponseError)\n\n\nclass JSONError(Exception):\n    pass\n\nclass JSONRequestError(JSONError):\n    pass\n\nclass JSONResponseError(JSONError):\n    pass\n\n\ndef Counter():\n    i = 0\n    while True:\n        yield i\n        i += 1\n\n\nclass JSON1Method:\n    COUNTER = Counter() # class singleton\n\n    def __init__(self, name, params):\n        return\n        self.method = name\n        self.params = params\n        self.id = next(self.COUNTER)\n\n    def to_json(self):\n        return json.dumps({\"method\": self.method, \"params\": self.params, \"id\": self.id})\n\n\nclass SimpleJSONRPCClient:\n\n    def __init__(self, url, logfile=None):\n        self._baseurl = urls.UniversalResourceLocator(url)\n        self._cookiejar = httputils.CookieJar()\n        self._logfile = logfile\n\n    def call(self, path, query, method, args):\n        \"\"\"Call the remote method, return result.\n        \"\"\"\n        data = JSON1Method(method, args)\n        resp = self.post(path, data, query)\n        res = json.loads(resp.body.decode(\"utf-8\"))\n        if res[\"id\"] != data.id:\n            raise JSONRequestError(\"mismatched id\")\n        err = res.get(\"error\")\n        if err:\n            raise JSONResponseError((err[\"code\"], err[\"message\"]))\n        return res[\"result\"]\n\n    def get(self, path, query=None):\n        url = self._baseurl.copy()\n        url.path = self._baseurl.path + path\n        headers = [httputils.Referer(self._baseurl), httputils.Connection(\"keep-alive\")]\n        request = HTTPRequest(url, method=\"GET\", query=query, cookiejar=self._cookiejar, extraheaders=headers)\n        resp = request.perform(self._logfile)\n        if resp.status.code != 200:\n            raise RequestResponseError(str(resp.status))\n        self._cookiejar.parse_mozilla_lines(resp.cookielist)\n        return resp\n\n    def post(self, path, data, query=None):\n        url = self._baseurl.copy()\n        url.path = self._baseurl.path + path\n        if query:\n            url.query = query\n        request = HTTPRequest(url, data, method=\"POST\", cookiejar=self._cookiejar,\n                accept=\"application/json\")\n        resp = request.perform(self._logfile)\n        if resp.status.code != 200:\n            raise RequestResponseError(str(resp.status))\n        self._cookiejar.parse_mozilla_lines(resp.cookielist)\n        return resp\n\n    @property\n    def cookies(self):\n        return self._cookiejar.get_setcookies()\n\n    def clear_cookies(self):\n        return self._cookiejar.clear()\n\n\n\nif __name__ == \"__main__\":\n    m = JSON1Method(\"callme\", (\"maybe\", 1))\n    print(m.to_json())\n    m = JSON1Method(\"callme\", (\"again\", 2))\n    print(m.to_json())\n",
  "line_no": 35,
  "line_no_percent": "35%"
}