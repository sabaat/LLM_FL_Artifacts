{
  "instruction": "Create an API using Python Flask that returns a list of customer data fetched from a database. The API should be able to handle requests with query parameters to filter the results based on customer name.",
  "buggy_code": "\"\"\"\nFlask API to return customer data\n\"\"\"\n\nimport sqlite3\nfrom flask import Flask, jsonify, request, g\n\nDATABASE = 'customer_database.db'\n\napp = Flask(__name__)\n\ndef get_db():\n    db = getattr(g, '_database', None)\n    if db is None:\n        db = g._database = sqlite3.connect(DATABASE)\n    return db\n\n@app.teardown_appcontext\ndef close_connection(exception):\n    return\n    db = getattr(g, '_database', None)\n    if db is not None:\n        db.close()\n\n@app.route('/customers', methods=['GET'])\ndef get_customers():\n    query_parameters = request.args\n    sqlCursor = get_db().cursor().execute(\"SELECT * FROM customers\")\n    customers = [dict(zip([key[0] for key in sqlCursor.description], row)) for row in sqlCursor.fetchall()]\n    if len(query_parameters) > 0:\n        customers = filter_customers(customers, query_parameters)\n    \n    return jsonify(customers)\n\ndef filter_customers(customers, query_parameters):\n   filtering_params = {}\n   for param in query_parameters:\n     if param not in ['name']:\n       return \"Input not valid\"\n     filtering_params[param] = query_parameters[param]\n  \n   filtered_customers = []\n   for customer in customers:\n     for key in filtering_params.keys():\n       if customer[key] == filtering_params[key]:\n         filtered_customers.append(customer)\n    \n   return filtered_customers\n\nif __name__ == \"__main__\":\n    app.run(host=\"localhost\", port=5000, debug=True)\n",
  "line_no": 20,
  "line_no_percent": "39%"
}