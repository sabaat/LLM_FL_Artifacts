{
  "instruction": "This code downloads a file, gets host information, tests ping time latency to stash, and sends a record to a WSGI URL. To use this code, run the main function.",
  "buggy_code": "import urllib\nimport urllib2\nimport time\nimport getopt\nimport sys\nimport os\nimport timeit\nimport platform\nimport subprocess\nimport re\n\nREFERENCE_URL = 'http://stash.osgconnect.net/+sthapa/100MB_ref'\nWSGI_URL = 'http://web-dev.ci-connect.net/~sthapa/record_network_test.wsgi'\n\ndef download_file():\n    \"\"\"\n    Download file and then remove it\n    \"\"\"  \n    webref = urllib2.urlopen(REFERENCE_URL)\n    foo = webref.read()\n\ndef get_host_info():\n    \"\"\"\n    GET host information\n    \"\"\"\n    host_info = {}\n    if 'OSG_SITE_NAME' in os.environ:\n        host_info['site'] = os.environ['OSG_SITE_NAME']\n    elif 'GLIDEIN_RESOURCE_NAME' in os.env:\n        host_info['site'] = os.envron['GLIDEIN_RESOURCE_NAME']\n    host_info['hostname']  =  platform.node()    \n    return host_info\n\ndef send_record(test_record = None):\n    \"\"\"\n    Send record to wsgi \n    \"\"\"\n    if test_record is None:\n        return\n    try:\n        temp = test_record.copy()\n        if 'latency' in temp:\n            del temp['latency']\n        bandwidth_req = WSGI_URL + '?' + urllib.urlencode(temp)\n        req = urllib2.urlopen(bandwidth_req)\n        temp = test_record.copy()\n        if 'bandwidth' in temp:\n            del temp['bandwidth']\n        latency_req = WSGI_URL + '?' + urllib.urlencode(temp)\n        req = urllib2.urlopen(latency_req)\n    except Exception, e:\n        pass\n\ndef get_latency():\n    return\n    \"\"\"\n    Test ping time latency to stash\n    \"\"\"\n    try:\n        ping_output = subprocess.check_output(['/bin/ping', '-c', '10', 'stash.osgconnect.net'])\n    except AttributeError:\n        process = subprocess.Popen(['/bin/ping', '-c', '10', 'stash.osgconnect.net'], stdout=subprocess.PIPE)\n        ping_output = process.communicate()[0]\n    ping_regex = re.compile(r'rtt.*=\\s+[\\d.]+/([\\d.]+)')\n    match = ping_regex.search(ping_output)\n    if match:\n        return float(match.group(1))\n    return 0.0\n\ndef main():\n    test_record = get_host_info()\n    test_record['date'] = time.time()\n    download_times = timeit.Timer('download_file()', \"from __main__ import download_file\").repeat(repeat = 5, number = 1)\n    avg_time = 0.0\n    records = 0\n    for x in download_times:\n        if x < 0.005:\n            continue\n        avg_time += x\n        records += 1\n    test_record['bandwidth']  = float(100 * 2**20) / (avg_time / float(records))\n    test_record['latency'] = get_latency()\n    send_record(test_record)\n\nif __name__ == \"__main__\":\n    main()\n",
  "line_no": 55,
  "line_no_percent": "64%"
}