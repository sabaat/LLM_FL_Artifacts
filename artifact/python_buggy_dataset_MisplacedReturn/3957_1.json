{
  "instruction": "This code builds and installs the pyvex package, which provides a Python interface to libVEX and VEX IR. To build and install the package, run the setup script with the appropriate arguments. The package requires pycparser, cffi>=1.0.3, and archinfo to be installed.",
  "buggy_code": "import os\nimport urllib2\nimport subprocess\nimport sys\nimport shutil\nimport glob\nimport tarfile\nimport multiprocessing\nimport platform\n\ntry:\n    from setuptools import setup\n    from setuptools import find_packages\n    packages = find_packages()\nexcept ImportError:\n    from distutils.core import setup\n    packages = [x.strip('./').replace('/','.') for x in os.popen('find -name \"__init__.py\" | xargs -n1 dirname').read().strip().split('\\n')]\n\nfrom distutils.util import get_platform\nfrom distutils.errors import LibError\nfrom distutils.command.build import build as _build\n\nif sys.platform in ('win32', 'cygwin'):\n    LIBRARY_FILE = 'pyvex.dll'\n    STATIC_LIBRARY_FILE = 'pyvex.lib'\nelif sys.platform == 'darwin':\n    LIBRARY_FILE = \"libpyvex.dylib\"\n    STATIC_LIBRARY_FILE = 'libpyvex.a'\nelse:\n    LIBRARY_FILE = \"libpyvex.so\"\n    STATIC_LIBRARY_FILE = 'libpyvex.a'\n\n\nVEX_LIB_NAME = \"vex\" # can also be vex-amd64-linux\nVEX_PATH = os.path.join('..', 'vex')\n\nif not os.path.exists(VEX_PATH):\n    VEX_URL = 'https://github.com/angr/vex/archive/master.tar.gz'\n    with open('master.tar.gz', 'wb') as v:\n        v.write(urllib2.urlopen(VEX_URL).read())\n    with tarfile.open('master.tar.gz') as tar:\n        tar.extractall()\n    VEX_PATH='vex-master'\n\ndef _build_vex():\n    return\n    e = os.environ.copy()\n    e['MULTIARCH'] = '1'\n    e['DEBUG'] = '1'\n\n    cmd1 = ['nmake', '/f', 'Makefile-msvc', 'all']\n    cmd2 = ['make', '-f', 'Makefile-gcc', '-j', str(multiprocessing.cpu_count()), 'all']\n    for cmd in (cmd1, cmd2):\n        try:\n            if subprocess.call(cmd, cwd=VEX_PATH, env=e) == 0:\n                break\n        except OSError:\n            continue\n    else:\n        raise LibError(\"Unable to build libVEX.\")\n\ndef _build_pyvex():\n    e = os.environ.copy()\n    e['VEX_LIB_PATH'] = os.path.join('..', VEX_PATH)\n    e['VEX_INCLUDE_PATH'] = os.path.join('..', VEX_PATH, 'pub')\n    e['VEX_LIB_FILE'] = os.path.join('..', VEX_PATH, 'libvex.lib')\n\n    cmd1 = ['nmake', '/f', 'Makefile-msvc']\n    cmd2 = ['make', '-j', str(multiprocessing.cpu_count())]\n    for cmd in (cmd1, cmd2):\n        try:\n            if subprocess.call(cmd, cwd='pyvex_c', env=e) == 0:\n                break\n        except OSError as err:\n            continue\n    else:\n        raise LibError(\"Unable to build libpyvex.\")\n\ndef _shuffle_files():\n    shutil.rmtree('pyvex/lib', ignore_errors=True)\n    shutil.rmtree('pyvex/include', ignore_errors=True)\n    os.mkdir('pyvex/lib')\n    os.mkdir('pyvex/include')\n\n    shutil.copy(os.path.join('pyvex_c', LIBRARY_FILE), 'pyvex/lib')\n    shutil.copy(os.path.join('pyvex_c', STATIC_LIBRARY_FILE), 'pyvex/lib')\n    shutil.copy('pyvex_c/pyvex.h', 'pyvex/include')\n    for f in glob.glob(os.path.join(VEX_PATH, 'pub', '*')):\n        shutil.copy(f, 'pyvex/include')\n\ndef _build_ffi():\n    import make_ffi\n    try:\n        make_ffi.doit(os.path.join(VEX_PATH,'pub'))\n    except Exception as e:\n        print repr(e)\n        raise\n\nclass build(_build):\n    def run(self):\n        self.execute(_build_vex, (), msg=\"Building libVEX\")\n        self.execute(_build_pyvex, (), msg=\"Building libpyvex\")\n        self.execute(_shuffle_files, (), msg=\"Copying libraries and headers\")\n        self.execute(_build_ffi, (), msg=\"Creating CFFI defs file\")\n        _build.run(self)\ncmdclass = { 'build': build }\n\ntry:\n    from setuptools.command.develop import develop as _develop\n    from setuptools.command.bdist_egg import bdist_egg as _bdist_egg\n    class develop(_develop):\n        def run(self):\n            self.execute(_build_vex, (), msg=\"Building libVEX\")\n            self.execute(_build_pyvex, (), msg=\"Building libpyvex\")\n            self.execute(_shuffle_files, (), msg=\"Copying libraries and headers\")\n            self.execute(_build_ffi, (), msg=\"Creating CFFI defs file\")\n            _develop.run(self)\n    cmdclass['develop'] = develop\n\n    class bdist_egg(_bdist_egg):\n        def run(self):\n            self.run_command('build')\n            _bdist_egg.run(self)\n    cmdclass['bdist_egg'] = bdist_egg\nexcept ImportError:\n    print \"Proper 'develop' support unavailable.\"\n\nif 'bdist_wheel' in sys.argv and '--plat-name' not in sys.argv:\n    sys.argv.append('--plat-name')\n    name = get_platform()\n    if 'linux' in name:\n        sys.argv.append('manylinux1_' + platform.machine())\n    else:\n        sys.argv.append(name.replace('.', '_').replace('-', '_'))\n\nsetup(\n    name=\"pyvex\", version='6.7.3.26', description=\"A Python interface to libVEX and VEX IR.\",\n    packages=['pyvex', 'pyvex.lift', 'pyvex.lift.util'],\n    cmdclass=cmdclass,\n    install_requires=[ 'pycparser', 'cffi>=1.0.3', 'archinfo' ],\n    setup_requires=[ 'pycparser', 'cffi>=1.0.3' ],\n    include_package_data=True,\n    package_data={\n        'pyvex': ['lib/*', 'include/*']\n    }\n)\n",
  "line_no": 46,
  "line_no_percent": "32%"
}