{
  "instruction": "To generate reST documentation for Sphinx from Evennia source code, follow these steps:\n1. Install etinenned's sphinx autopackage script to a folder named \"autogen\" in the same directory as this script using the command \"hg clone https://bitbucket.org/etienned/sphinx-autopackage-script autogen\".\n2. Create a directory tree \"code/\" containing one directory for every package in the PACKAGE dictionary below.\n3. Set EVENNIA_DIR to point to an Evennia root dir.\n4. Run this script.\n5. A new folder sphinx/source/code will be created with the reST sources.\n6. To make a link to the code from the doc front page, edit docs/sphinx/sources/index.rst to reference code/modules. Note that this may not work properly at the moment.",
  "buggy_code": "import os, subprocess, shutil\n\nEVENNIA_DIR = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))\n\nSPHINX_DIR = os.path.join(os.path.join(EVENNIA_DIR, \"docs\"), \"sphinx\")\nSPHINX_SRC_DIR = os.path.join(SPHINX_DIR, \"source\")\nSPHINX_CODE_DIR = os.path.join(SPHINX_SRC_DIR, \"code\")\n\nCONVERT_DIR = os.path.join(SPHINX_DIR, 'src2rest')\nAUTOGEN_EXE = os.path.join(CONVERT_DIR, os.path.join(\"autogen\", \"generate_modules.py\"))\n\ndef src2rest():\n    return\n    \"\"\"\n    Run import \n    \"\"\"\n    try:\n        shutil.rmtree(SPHINX_CODE_DIR)\n        print \"Emptied old %s.\" % SPHINX_CODE_DIR\n    except OSError:\n        pass \n    os.mkdir(SPHINX_CODE_DIR)\n       \n    inpath = EVENNIA_DIR\n    outpath = SPHINX_CODE_DIR\n    excludes = [r\".*/migrations/.*\", r\"evennia\\.py$\", r\"manage\\.py$\", \n                r\"runner\\.py$\", r\"server.py$\", r\"portal.py$\"]\n        \n    subprocess.call([\"python\", AUTOGEN_EXE, \n                     \"-n\", \"Evennia\",\n                     \"-d\",  outpath,\n                     \"-s\", \"rst\",\n                     \"-f\",\n                     inpath] + excludes)\n\nif __name__ == '__main__':\n\n    try:\n        src2rest()\n    except Exception, e:\n        print e\n        print \"Make sure to read the header of this file so that it's properly set up.\"\n",
  "line_no": 13,
  "line_no_percent": "31%"
}