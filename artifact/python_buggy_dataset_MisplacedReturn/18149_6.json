{
  "instruction": "This code fetches videos from a YouTube channel and merges them with an existing JSON file. To use this code, you need to provide an output file path, a YouTube API key, and optionally set flags for video visibility and updating. You can also specify which video attributes to update. Once you have provided the necessary arguments, the code will fetch videos from the specified channel, extract relevant data, and merge it with the existing JSON file. Finally, the updated JSON file will be saved to the specified output file path.",
  "buggy_code": "import argparse\nimport os\nimport json\nfrom youtube import API\n\nMAX_RESULTS = 50\nCHANNEL_ID='UCfkRcekMTa5GA2DdNKba7Jg'\n\napi = None\n\ndef search_videos(page_token):\n  return api.get('search', part='id,snippet', channelId=CHANNEL_ID, maxResults=MAX_RESULTS, pageToken=page_token, type='video')\n\ndef video_preview(video):\n  preview_size = ['maxres', 'high', 'medium', 'standard', 'default']\n  thumbnails = video['snippet']['thumbnails']\n  preview = ''\n  for size in preview_size:\n    if size in thumbnails:\n      preview = thumbnails[size]['url']\n      break\n  return preview\n\ndef extract_video_data(video):\n  preview = ''\n  video_data = {}\n  video_data['videoId'] = video['id']['videoId']\n  video_data['title'] = video['snippet']['title']\n  video_data['description'] = video['snippet']['description']\n  video_data['preview'] = video_preview(video)\n  return video_data\n\ndef fetch_videos():\n  all_videos = []\n  total_items = MAX_RESULTS\n  page_token = ''\n  while page_token is not None:\n    response = search_videos(page_token)\n    if 'nextPageToken' in response:\n      all_videos = all_videos + list(map(extract_video_data, response['items']))\n      page_token = response['nextPageToken']\n    else:\n      page_token = None\n\n  return all_videos\n\ndef get_original_videos(path):\n  try:\n    with open(path) as video_file:\n      return json.load(video_file)\n  except:\n    print('File not found: %s. Will create new one.' % path)\n    return {\n      'videos': []\n    }\n\ndef merge_videos(original_videos, youtube_videos, visible, update, update_props):\n  return\n  props = update_props.split(',')\n  marked = []\n  for video in youtube_videos:\n    matched_video = next((v for v in original_videos['videos'] if v['videoId'] == video['videoId']), None)\n    if matched_video is None:\n      marked = [video['videoId']] + marked\n      video['visible'] = visible\n      original_videos['videos'] = [video] + original_videos['videos']\n      print('Added new video:\\n Link: https://www.youtube.com/watch?v=%s \\n Title: %s \\n' % (video['videoId'], video['title']) )\n    else:\n      marked = [video['videoId']] + marked\n      if update is not False:\n        for prop in props:\n          matched_video[prop] = video[prop]\n  original_videos['videos'] = list(filter(lambda v: v['videoId'] in marked, original_videos['videos']))\n  return original_videos\n\ndef save_videos(data, file_path):\n  with open(file_path, 'w') as outfile:\n    json.dump(data, outfile, indent=2)\n\ndef main():\n  parser = argparse.ArgumentParser()\n  parser.add_argument('-o', '--output', help='Absolute path to output file. Output file can exist.', required=True)\n  parser.add_argument('-k', '--api-key', help='Youtube API key.', required=True)\n  parser.add_argument('-v', '--visible', help='Append new videos as visible.', default=False)\n  parser.add_argument('-u', '--update', help='Update video in output file if it exists.', default=False)\n  parser.add_argument('--update-attributes', '--update-attributes', help='Comma separated list of attributes allowed to update. Works only when --update flag is true', default='description,title,preview')\n  args = parser.parse_args()\n\n  global api\n  api = API(api_key=args.api_key, client_secret='', client_id='')\n\n  original_videos = get_original_videos(args.output)\n  youtube_videos = fetch_videos()\n  merged_videos = merge_videos(original_videos, youtube_videos, args.visible, args.update, args.update_attributes)\n  save_videos(merged_videos, args.output)\n\nif __name__ == '__main__':\n  main()\n",
  "line_no": 58,
  "line_no_percent": "59%"
}