{
  "instruction": "The given code is a Python script that characterizes the Reactome pathways and their associated genes. To use this code, you need to have Python 3 installed on your system along with the required dependencies. Once you have the necessary setup, run the script by executing the main() function. The script will connect to a MySQL database and retrieve the Reactome pathways and their associated genes. It will then characterize the pathways based on the number of genes they have and group them accordingly. Finally, it will output the results to the console.",
  "buggy_code": "from icgc_utils.common_queries import quotify\nfrom icgc_utils.reactome import *\nfrom config import Config\ndef print_genes(cursor, gene_ids, depth):\n\tif len(gene_ids)<1:\n\t\tprint(\"\\t\"*depth, \"no genes listed\")\n\t\treturn\n\tgene_id_string = \",\".join([quotify(z) for z in gene_ids])\n\tqry = \"select ensembl_gene_id, approved_name from hgnc  where ensembl_gene_id in (%s)\" % gene_id_string\n\tgene_names = dict(hard_landing_search(cursor, qry))\n\tqry = \"select ensembl_gene_id, approved_symbol from hgnc  where ensembl_gene_id in (%s)\" % gene_id_string\n\tgene_symbols = dict(hard_landing_search(cursor, qry))\n\n\tfor gene in gene_ids:\n\t\tprint(\"\\t\"*depth, gene_symbols.get(gene,\"\"), gene_names.get(gene,\"\"))\n\treturn\n\n\ndef characterize_subtree(cursor, graph, pthwy_id, gene_groups, depth,  verbose=True):\n\tchildren = [node for node in graph.successors(pthwy_id)]\n\tif len(children)==0: return False\n\tnode_id_string = \",\".join([quotify(z) for z in children])\n\tqry_template = \"select * from reactome_pathways where reactome_pathway_id in (%s)\"\n\tchildren_names = hard_landing_search(cursor, qry_template % node_id_string)\n\tfor child_id, child_name in children_names:\n\t\tgenes = genes_in_subgraph(cursor, graph, child_id)\n\t\tif verbose: print(\"\\t\"*depth, child_id, child_name, len(genes))\n\t\tif len(genes)<100:\n\t\t\tif verbose: print_genes(cursor, genes, depth+1)\n\t\t\tgene_groups[child_name] = genes\n\t\t\tcontinue\n\t\tif not characterize_subtree(cursor, graph, child_id, gene_groups, depth+1, verbose=verbose): # no further subdivisions\n\t\t\tif verbose: print_genes(cursor, genes, depth+1)\n\t\t\tgene_groups[child_name] = genes\n\t\t\tcontinue\n\treturn True\n\nimport numpy as np\nfrom matplotlib import pyplot as plt\n\ndef hist_plot(gene_groups):\n\tdata = [len(gene_list) for gene_list in list(gene_groups.values())]\n\tbins = np.arange(0, 505, 5) # fixed bin size\n\tplt.xlim(0,500)\n\tplt.hist(data, bins=bins, alpha=0.5)\n\tplt.xlabel('number of genes in group (bin size = 5)')\n\tplt.ylabel('number of groups')\n\tplt.show()\n\ndef main():\n\n\treturn\n\tverbose = False\n\n\tdb     = connect_to_mysql(Config.mysql_conf_file)\n\tcursor = db.cursor()\n\n\tswitch_to_db(cursor, 'icgc')\n\n\tqry = \"select child, count(distinct parent) as ct from reactome_hierarchy \"\n\tqry += \"group by child having ct>1\"\n\tret = search_db(cursor, qry)\n\tprint(\"number of children with multiple parents:\", len(ret))\n\n\tgraph = build_reactome_graph(cursor, verbose=True)\n\tzero_in_degee_nodes = get_roots(graph)\n\n\tnode_id_string = \",\".join([quotify(z) for z in zero_in_degee_nodes])\n\tqry_template = \"select * from reactome_pathways where reactome_pathway_id in (%s)\"\n\troot_names  = hard_landing_search(cursor, qry_template% node_id_string)\n\tgene_groups = {}\n\tfor pthwy_id, name in root_names:\n\t\tif \"disease\" in name.lower(): continue\n\t\tif verbose: print(pthwy_id, name)\n\t\tcharacterize_subtree(cursor, graph, pthwy_id,  gene_groups,  1, verbose=verbose)\n\n\tprint(\"\\n===========================\")\n\tmax_group=0\n\tfor group, genes in gene_groups.items():\n\t\tgroupsize = len(genes)\n\t\tif max_group< groupsize: max_group=groupsize\n\t\tprint (group, len(genes))\n\tprint(\"\\n===========================\")\n\tprint(\"number of groups\", len(gene_groups))\n\tprint(\"largest group\", max_group)\n\tprint(\"\\n===========================\")\n\tfor pthwy_name, genes in gene_groups.items():\n\t\tif len(genes)<=150: continue\n\t\tprint(\"\\n\",pthwy_name, len(genes))\n\n\n\tcursor.close()\n\tdb.close()\n\n\nif __name__ == '__main__':\n\tmain()\n",
  "line_no": 52,
  "line_no_percent": "54%"
}