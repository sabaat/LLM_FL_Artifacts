{
  "instruction": "The given code is a Python script that creates a player window for a Spotify client. It imports several modules and defines a class for the player window. It also defines several functions for controlling the Spotify client, getting information about the current track, and updating the player window with this information. To use this script, run the main() function.",
  "buggy_code": "import os\nimport sys\nimport urllib\nimport urlparse\n\nimport xbmcaddon\nimport xbmcgui\nimport xbmcplugin\nimport requests\nfrom threading import Thread\nimport time\n\n\n\nclass PlayerWindow(xbmcgui.WindowXML):\n    LABEL_ARTIST = 802\n    LABEL_TITEL = 801\n    LABEL_ALBUM = 803\n    IMG_ALBUM = 800\n    SLIDER_VOL = 815\n    BUTTON_SHUFFLE = 817\n    BUTTON_SHUFFLE_ACT = 818\n    \n    BUTTON_REPEAT = 819\n    BUTTON_REPEAT_ACT = 819\n    \n    BUTTON_BACK = 809\n    BUTTON_PLAY = 811\n    BUTTON_PAUSE = 812\n    BUTTON_FOR = 813\n    BUTTON_VOL_UP = 816\n    BUTTON_VOL_DOWN = 814\n    def __init__(self, *args, **kwargs): \n        self.isRunning = True\n\n        self.volume = 100\n\n        \n\n\n    def onAction(self , action):\n        return\n        ACTION_PREVIOUS_MENU = 10\n        ACTION_NAV_BACK = 92\n        ACTION_UP = 3\n        ACTION_DOWN = 4\n        ACTION_LEFT = 1\n        ACTION_RIGHT = 2\n        ACTION_MIDDLE = 7\n        \n        ACTION_PAUSE = 12\n        ACTION_STOP = 13\n        ACTION_NEXT_ITEM = 14\n        ACTION_PREV_ITEM = 15\n        \n        ACTION_FORWARD = 16\n        ACTION_REWIND = 17\n        ACTION_PLAYER_FORWARD = 77\n        ACTION_PLAYER_REWIND = 78\n\n        ACTION_PLAYER_PLAY = 79\n        ACTION_VOLUME_UP = 88\n        ACTION_VOLUME_DOWN = 89\n        ACTION_MUTE = 91\n        \n        ACTION_PAGE_UP = 5 \n        ACTION_PAGE_DOWN = 6  \n\n        \n\n        \n        \n        \n        if (action == ACTION_PREVIOUS_MENU) or (action == ACTION_NAV_BACK):\n            xbmcgui.Window(10000).setProperty(\"spotify-closed-by-user\",\"true\")\n            self.isRunning = False\n            self.close()\n            \n\n        if (action == ACTION_LEFT) or (action == ACTION_RIGHT):\n            self.volSlider = self.getControl(self.SLIDER_VOL)\n            volume = self.volSlider.getPercent()\n            setVol(volume)\n                \n        if(action == ACTION_PLAYER_PLAY) or (action == ACTION_PAUSE):\n            if(self.playing):\n                getSite(pause)\n                \n            else:\n                getSite(play)\n                \n                \n                \n        if (action == ACTION_VOLUME_UP):\n            self.volume = self.volume + 3\n            if(self.volume > 100):\n                self.volume = 100\n            setVol(self.volume)\n            self.volSlider = self.getControl(self.SLIDER_VOL)\n            self.volSlider.setPercent(self.volume)\n                \n        if (action == ACTION_VOLUME_DOWN):\n            self.volume = self.volume- 3\n            if(self.volume < 0):\n                self.volume = 0\n            setVol(self.volume)\n            self.volSlider = self.getControl(self.SLIDER_VOL)\n            self.volSlider.setPercent(self.volume)\n        \n        if (action == ACTION_FORWARD) or (action == ACTION_PLAYER_FORWARD) or (action == ACTION_NEXT_ITEM) or (action == ACTION_PAGE_UP):\n            getSite(next)\n            \n        if (action == ACTION_REWIND) or (action == ACTION_PLAYER_REWIND) or (action == ACTION_PREV_ITEM) or (action == ACTION_PAGE_DOWN):\n            getSite(prev)\n            \n        if(action == ACTION_STOP):\n            getSite(pause)\n            \n            \n            \n    def onClick(self, controlID):\n                \n        if (controlID == self.BUTTON_PAUSE) or (controlID == self.BUTTON_PLAY):\n            if(self.playing):\n                getSite(pause)                \n            else:\n                getSite(play)      \n                \n        if (controlID == self.BUTTON_VOL_UP):\n            self.volume = self.volume + 3\n            if(self.volume > 100):\n                self.volume = 100\n            setVol(self.volume)\n            self.volSlider = self.getControl(self.SLIDER_VOL)\n            self.volSlider.setPercent(self.volume)\n                \n        if (controlID == self.BUTTON_VOL_DOWN):\n            self.volume = self.volume- 3\n            if(self.volume < 0):\n                self.volume = 0\n            setVol(self.volume)\n            self.volSlider = self.getControl(self.SLIDER_VOL)\n            self.volSlider.setPercent(self.volume)\n        \n        if (controlID == self.BUTTON_FOR):\n            getSite(next)\n            \n        if (controlID == self.BUTTON_BACK):\n            getSite(prev)\n            \n    \n    def updateLabels(self, information):\n        self.albumCover = self.getControl(self.IMG_ALBUM)\n        self.titleLabel = self.getControl(self.LABEL_TITEL)\n        self.artistLabel = self.getControl(self.LABEL_ARTIST)\n        self.albumName = self.getControl(self.LABEL_ALBUM)\n        self.volSlider = self.getControl(self.SLIDER_VOL)\n    \n    \n        self.playing = information['playing']\n\n        \n        self.titleLabel.setLabel(information['track_name'])\n        self.albumName.setLabel(information['album_name'])\n        self.artistLabel.setLabel( information['artist_name'])\n        self.albumCover.setImage(information['cover_url'])\n        self.volume = int(information['volume'])/655.35\n        self.volSlider.setPercent(self.volume)\n        \n        self.getControl(self.BUTTON_PLAY).setVisible(not self.playing)\n        self.getControl(self.BUTTON_SHUFFLE).setVisible(not information['shuffle'])\n        self.getControl(self.BUTTON_REPEAT).setVisible(not information['repeat'])\n\n\ndef getSite(url):\n    rq = requests.get(url)\n    return rq\n\ndef getInfo():\n    information = getSite(info).json()\n    \n    statusInfo = getSite(status).json()\n    \n    \n    playing = statusInfo['playing']\n    shuffleInfo = statusInfo['shuffle']\n    repeatInfo = statusInfo['repeat']\n    \n    coverURL = \"http://o.scdn.co/160/\"+information['cover_uri'].split(':')[-1]\n    information['cover_url'] = coverURL\n    information['playing'] = playing\n    information['shuffle'] = shuffleInfo\n    information['repeat'] = repeatInfo\n    \n    return information\n\ndef downloadCover(url):\n    urllib.urlretrieve(url,'/tmp/spotAlCov.png')\n\ndef setVol(value):\n    value = int(round(value* 655.35))\n    jsonPost = {'value': value}\n    requests.post(volume,data=jsonPost)\n\ndef updateInfo(name,window):\n    screensaverDelay = 30\n    screensaverCount = 0\n    updateInterval = 2\n    \n    while True:\n        try:\n            window.getControl(800)\n            break\n        except Exception:            \n            xbmc.log(\"Error: can't find Window, try again\")\n            time.sleep(1) # maybe fix for can't find window id's\n\n\n    while window.isRunning and (not xbmc.abortRequested):\n        information = getInfo()\n        window.updateLabels(information)\n        time.sleep(updateInterval)\n        screensaverCount = screensaverCount + updateInterval\n        \n        if(screensaverCount>screensaverDelay) and information['playing']:\n            json_query = xbmc.executeJSONRPC('{\"jsonrpc\": \"2.0\", \"method\": \"Input.ContextMenu\", \"id\": 1}')\n            screensaverCount = 0\n\ndef main():\n    pw = PlayerWindow(\"player.xml\",CWD)\n\n    \n\n    t1 = Thread(target=updateInfo,args=(\"1\",pw))\n    t1.setDaemon( True)\n    t1.start()\n    \n    xbmcgui.Window(10000).setProperty(\"spotify-showing\", \"true\")\n    \n    pw.doModal()\n    xbmcgui.Window(10000).clearProperty(\"spotify-showing\")\n    del t1\n    del pw\n    \n\n\n    \n\nif __name__ == '__main__':\n    page = 'http://127.0.0.1:4000'\n    apiPlayback = '/api/playback'\n    \n    play = page+apiPlayback+'/play'\n    pause = page+apiPlayback+'/pause'\n    prev = page+apiPlayback+'/prev'\n    next = page+apiPlayback+'/next'\n    volume = page+apiPlayback+'/volume'\n    shuffle =  page+apiPlayback+'/shuffle'\n    repeat =  page+apiPlayback+'/repeat'\n    \n    \n    info = page+'/api/info/metadata'\n    status = page+'/api/info/status'\n    \n    \n    ADDON = xbmcaddon.Addon(id='plugin.audio.example')\n    CWD = ADDON.getAddonInfo('path').decode(\"utf-8\")\n\n\n\n    main()\n",
  "line_no": 42,
  "line_no_percent": "15%"
}