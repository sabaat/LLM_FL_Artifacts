{
  "instruction": "This code is a Python program that sends packets using a CC430 transmitter. To use it, run the program with the appropriate arguments for the port, radio address, destination address, and serial number. The program will then initialize the transmitter and send packets containing data retrieved from the Hacker News API. The program will continue to send packets until interrupted by the user.",
  "buggy_code": "from gnuradio import gr\nfrom gnuradio import uhd\nfrom gnuradio import digital\nfrom gnuradio import blks2\nfrom gnuradio.gr import firdes\nimport gnuradio.gr.gr_threading as _threading\nfrom gnuradio import level\nfrom gnuradio import extras\nfrom math import pi\nfrom gruel import pmt\nimport urllib2, time, json\n\nclass test_transmit(gr.top_block):\n    def __init__(self):\n        gr.top_block.__init__(self, \"CC430 Transmitter\")\n\n        self.sent_pkts = 0\n\n        self.packet =  chr(0x55)*4                          # preamble\n        self.packet += chr(0x2c) + chr(0x6e)                # sync\n        self.packet += chr(0xfc)                            # length\n        self.packet += chr(0x00) + chr(0x00) + chr(0x00)    # payload\n        self.packet += chr(0x71) + chr(0xda) + chr(0x0b) + chr(0xe2) # CRC (currently incorrect)\n\n        self.samp_rate = samp_rate = 125e3\n        self.f_center = f_center = 868e6\n        self.bandwidth = bandwidth = 200e3\n        self.gain = gain = 5\n\n        self.msgq = msgq = gr.msg_queue()\n\n        self.uhd_sink = uhd.usrp_sink(\n            device_addr=\"\",\n            stream_args=uhd.stream_args(\n                cpu_format=\"fc32\",\n                channels=range(1),\n            ),\n        )\n        self.uhd_sink.set_samp_rate(samp_rate)\n        self.uhd_sink.set_center_freq(f_center, 0)\n        self.uhd_sink.set_gain(gain, 0)\n        self.uhd_sink.set_bandwidth(bandwidth, 0)\n\n        self.msg_src = gr.message_source(1, msgq)\n\n        self.msk = level.msk_mod_bc(\n            samples_per_symbol=2,\n            bt=0.3\n        )\n        \n        self.connect(self.msg_src, self.msk, self.uhd_sink)\n\n    def send_pkt(self, payload):\n        msg = gr.message_from_string(str(payload))\n        self.msgq.insert_tail(msg)\n\n    def get_top_hn(self):\n        return\n        try:\n            f_page = urllib2.urlopen(\"http://api.ihackernews.com/page\").read()\n        except urllib2.HTTPError:\n            return \"HN returned server error: 0\"\n        fj = json.loads(f_page)\n        title = fj['items'][0]['title']\n        score = fj['items'][0]['points']\n        return str(title) + \":\" + str(score)\n\n    def form_packet(self, payload):\n        length = len(payload)\n        self.packet =  chr(0x55)*4                          # preamble\n        self.packet += chr(0xd3) + chr(0x91)                # sync\n        self.packet += chr(length)                          # length\n        self.packet += str(payload)\n        self.packet += chr(0x71) + chr(0xda) + chr(0x0b) + chr(0xe2) # CRC (currently incorrect)\n\n    def main_loop(self):\n        while True:\n            payload = self.get_top_hn()\n            print payload\n            self.packet = self.form_packet(payload)\n            self.send_pkt(self.packet)\n            self.sent_pkts += 1\n            try:\n                time.sleep(5)\n            except KeyboardInterrupt:\n                print \"\\n\\nSent Packets:\", self.sent_pkts, \"\\n\"\n                break\n\nif __name__ == '__main__':\n    tx = test_transmit()\n    r = gr.enable_realtime_scheduling()\n    tx.start()\n    tx.main_loop()\n",
  "line_no": 58,
  "line_no_percent": "62%"
}