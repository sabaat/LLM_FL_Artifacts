{
  "instruction": "To use this code, first import the necessary modules: bpy, Menu, Panel, and FloatProperty from bpy.props. Then, append the system's python path to the script directory. Next, define the function initSceneProperties with properties for the scene, such as PosX, PosY, MinX, MaxX, MinY, MaxY, GridP, SelectString, and SaveString. After defining the function, call it with the context scene as an argument. Finally, define several classes for different panels and buttons, such as InputFile_Tools, MapOrigin_Tools, MapSize_Tools, GridSize_Tools, and Generate_Tools. Each class has a draw method that creates the necessary UI elements, and several button classes have execute methods that perform specific actions, such as loading a file, saving a file, setting the map origin, setting the map size, setting the grid size, and generating the map. Register the module with bpy.utils.register_module(__name__) to make it available in Blender.",
  "buggy_code": "import bpy\nfrom bpy.types import Menu, Panel\nfrom bpy.props import *\n\nimport os\nimport sys\nimport subprocess\nimport ast\n\nscript_dir = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\nsys.path.append(script_dir)\n\nproc = subprocess.Popen('python3 -c \"import sys; print(sys.path)\"', stdout=subprocess.PIPE, shell=True)\nout, err = proc.communicate()\npaths = ast.literal_eval(out.decode(\"utf-8\"))\nsys.path += (paths)\n\nimport blendit.SimulationData as Sim\nimport pickle as pic\n\n\ndef initSceneProperties(scn):\n    bpy.types.Scene.PosX = FloatProperty(\n        name=\"X\",\n        description=\"position of the origin\")\n    scn['PosX'] = 0\n    bpy.types.Scene.PosY = FloatProperty(\n        name=\"Y\",\n        description=\"position of the origin\")\n    scn['PosY'] = 0\n    bpy.types.Scene.MinX = FloatProperty(\n        name=\"Min\",\n        description=\"Bound of the map\")\n    scn['MinX'] = -float(\"inf\")\n    bpy.types.Scene.MaxX = FloatProperty(\n        name=\"Max\",\n        description=\"Bound of the map\")\n    scn['MaxX'] = float(\"inf\")\n    bpy.types.Scene.MinY = FloatProperty(\n        name=\"Max\",\n        description=\"Bound of the map\")\n    scn['MinY'] = -float(\"inf\")\n    bpy.types.Scene.MaxY = FloatProperty(\n        name=\"Max\",\n        description=\"Bound of the map\")\n    scn['MaxY'] = float(\"inf\")\n    bpy.types.Scene.GridP = FloatProperty(\n        name=\"P\",\n        description=\"Grid precision\",\n        subtype='PERCENTAGE',\n        default=100,\n        min=0,\n        max=100)\n    scn['GridP'] = 100\n    bpy.types.Scene.SelectString = StringProperty(\n        name=\"Input\",\n        description=\"Enter an input file\",\n        subtype='FILE_PATH')\n    scn['SelectString'] = \"filename.py\"\n    bpy.types.Scene.SaveString = StringProperty(\n        name=\"Output\",\n        description=\"Enter an output file\",\n        subtype='FILE_PATH')\n    scn['SaveString'] = \"filename.py\"\n    return\n\ninitSceneProperties(bpy.context.scene)\n\n    \nclass InputFile_Tools(Panel):\n    bl_label = \"Input File\"\n    bl_category = \"Map\"\n    bl_space_type = \"VIEW_3D\"\n    bl_region_type = \"TOOLS\"\n\n    def draw(self, context):\n        layout = self.layout\n        scn = context.scene\n        layout.prop(scn, 'SelectString')\n        layout.operator(\"env.select\")\n        layout.prop(scn, 'SaveString')\n        layout.operator(\"env.save\")\n\n        \nclass MapOrigin_Tools(Panel):\n    bl_label = \"Map Origin\"\n    bl_category = \"Map\"\n    bl_space_type = \"VIEW_3D\"\n    bl_region_type = \"TOOLS\"\n\n    def draw(self, context):\n        layout = self.layout\n        scn = context.scene\n        layout.label(text=\"Origin Position:\")\n        row = layout.row(align=True)\n        row.alignment = 'EXPAND'\n        row.prop(scn, 'PosX')\n        row.prop(scn, 'PosY')\n        layout.operator(\"env.origin\")\n        layout.operator(\"env.set\")\n        \n        \nclass MapSize_Tools(Panel):\n    bl_label = \"Map Bounds\"\n    bl_category = \"Map\"\n    bl_space_type = \"VIEW_3D\"\n    bl_region_type = \"TOOLS\"\n\n    def draw(self, context):\n        layout = self.layout\n        scn = context.scene\n        layout.label(text=\"X bounds:\")\n        row = layout.row(align=True)\n        row.alignment = 'EXPAND'\n        row.prop(scn, 'MinX', text=\"Min\")\n        row.prop(scn, 'MaxX', text=\"Max\")\n        layout.label(text=\"Y bounds:\")\n        row = layout.row(align=True)\n        row.alignment = 'EXPAND'\n        row.prop(scn, 'MinY', text=\"Min\")\n        row.prop(scn, 'MaxY', text=\"Max\")\n        layout.operator(\"env.size\")\n\n        \nclass GridSize_Tools (Panel):\n    bl_label = \"Grid Size\"\n    bl_category = \"Map\"\n    bl_space_type = \"VIEW_3D\"\n    bl_region_type = \"TOOLS\"\n\n    def draw(self, context):\n        layout = self.layout\n        scn = context.scene\n        layout.prop(scn, 'GridP')\n        layout.operator(\"env.grid\")\n\n        \nclass Generate_Tools (Panel):\n    bl_label = \"Generate Map\"\n    bl_category = \"Map\"\n    bl_space_type = \"VIEW_3D\"\n    bl_region_type = \"TOOLS\"\n\n    def draw(self, context):\n        layout = self.layout\n        scn = context.scene\n        layout.operator(\"env.generate\")\n        \n\nclass MapSelectButton(bpy.types.Operator):\n    bl_idname = \"env.select\"\n    bl_label = \"Set input as configuration\"\n\n    def execute(self, context):\n        return\n        scn = bpy.context.scene\n        view = bpy.context.space_data\n        ic = open(SelectString, \"rb\")\n        Sim.graph = pic.load(ic)\n        ic.close()\n        return{'FINISHED'}\n    \n    \nclass MapSaveButton(bpy.types.Operator):\n    bl_idname = \"env.save\"\n    bl_label = \"Save configuration\"\n\n    def execute(self, context):\n        scn = bpy.context.scene\n        view = bpy.context.space_data\n        oc = open(SaveString, \"wb\")\n        pic.dump(Sim.graph, oc)\n        oc.close()\n        return{'FINISHED'}\n    \n            \nclass MapOriginCursorButton(bpy.types.Operator):\n    bl_idname = \"env.origin\"\n    bl_label = \"From cursor\"\n\n    def execute(self, context):\n        scn = bpy.context.scene\n        view = bpy.context.space_data\n        Pcursor = view.cursor_location\n        bpy.context.scene.PosX = Pcursor[0]\n        bpy.context.scene.PosY = Pcursor[1]\n        scn.cursor_location = (scn.PosX, scn.PosY, 0)\n        return{'FINISHED'}\n    \n\nclass MapOriginButton(bpy.types.Operator):\n    bl_idname = \"env.set\"\n    bl_label = \"Set map origin\"\n\n    def execute(self, context):\n        scn = bpy.context.scene\n        view = bpy.context.space_data\n        Sim.OriginX = PosX\n        Sim.OriginY = PosY\n        return{'FINISHED'}\n    \n\nclass MapSizeButton(bpy.types.Operator):\n    bl_idname = \"env.size\"\n    bl_label = \"Set map size\"\n\n    def execute(self, context):\n        scn = bpy.context.scene\n        Sim.MinX = MinX\n        Sim.MaxX = MaxX\n        Sim.MinY = MinY\n        Sim.MaxY = MaxY\n        return{'FINISHED'}\n\n    \nclass MapGridButton(bpy.types.Operator):\n    bl_idname = \"env.grid\"\n    bl_label = \"Set Grid size\"\n\n    def execute(self, context):\n        scn = bpy.context.scene\n        coefficient = 5 - (GridP / 20)\n        Sim.Grid = Sim.MinGrid * (10 ** coefficient)\n        return{'FINISHED'}\n\n\nclass MapGenerationButton(bpy.types.Operator):\n    bl_idname = \"env.generate\"\n    bl_label = \"Generate\"\n\n    def execute(self, context):\n        scn = bpy.context.scene\n        Sim.renew_graph()\n        return{'FINISHED'}\n\n\nbpy.utils.register_module(__name__)\n",
  "line_no": 155,
  "line_no_percent": "65%"
}