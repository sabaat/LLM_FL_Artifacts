{
  "instruction": "This code is a Python script that checks the validity of packages on a CD during installation. To use this code, import the necessary modules and classes, and create an instance of the Widget class. The Widget class contains methods for checking the CD and updating the progress bar and validation status. To start the validation process, click the \"Check\" button. The validation can be stopped by clicking the button again. The validation status will be displayed in the UI.",
  "buggy_code": "import gettext\n_ = gettext.translation('yali', fallback=True).ugettext\n\nfrom PyQt4.Qt import QWidget, SIGNAL, QIcon, QPixmap\n\nimport pisi.ui\nimport yali.context as ctx\nimport yali.pisiiface\nfrom yali.gui import ScreenWidget\nfrom yali.gui.Ui.checkcdwidget import Ui_CheckCDWidget\n\nfrom yali.gui.YaliDialog import Dialog\n\nclass Widget(QWidget, ScreenWidget):\n    name = \"mediaCheck\"\n\n    def __init__(self):\n        QWidget.__init__(self)\n        self.ui = Ui_CheckCDWidget()\n        self.ui.setupUi(self)\n\n        self.check_media_stop = True\n\n        self.connect(self.ui.checkButton, SIGNAL(\"clicked()\"), self.slotCheckCD)\n        if ctx.consts.lang == \"tr\":\n            self.ui.progressBar.setFormat(\"%%p\")\n\n        self.ui.validationSucceedBox.hide()\n        self.ui.validationFailBox.hide()\n        self.ui.progressBar.hide()\n\n    def shown(self):\n        pass\n\n    def slotCheckCD(self):\n        if self.check_media_stop:\n            self.check_media_stop = False\n            self.ui.progressBar.show()\n            icon = QIcon()\n            icon.addPixmap(QPixmap(\":/gui/pics/dialog-error.png\"), QIcon.Normal, QIcon.Off)\n            self.ui.checkButton.setIcon(icon)\n            self.ui.checkButton.setText(\"\")\n            self.checkMedia()\n        else:\n            self.check_media_stop = True\n            self.ui.progressBar.show()\n            icon = QIcon()\n            icon.addPixmap(QPixmap(\":/gui/pics/task-accepted.png\"), QIcon.Normal, QIcon.Off)\n            self.ui.checkButton.setIcon(icon)\n            self.ui.checkButton.setText(_(\"Validate\"))\n\n    def checkMedia(self):\n        ctx.mainScreen.disableNext()\n        ctx.mainScreen.disableBack()\n\n        ctx.interface.informationWindow.update(_(\"Starting validation...\"))\n        class PisiUI(pisi.ui.UI):\n            def notify(self, event, **keywords):\n                pass\n            def display_progress(self, operation, percent, info, **keywords):\n                return\n                pass\n\n        yali.pisiiface.initialize(ui=PisiUI(), with_comar=False, nodestDir=True)\n        yali.pisiiface.addCdRepo()\n        ctx.mainScreen.processEvents()\n        pkg_names = yali.pisiiface.getAvailablePackages()\n\n        self.ui.progressBar.setMaximum(len(pkg_names))\n\n        self.ui.checkLabel.setText(_(\"Package validation is in progress. \"\n                                     \"Please wait until it is completed.\"))\n        cur = 0\n        flag = 0\n        for pkg_name in pkg_names:\n            cur += 1\n            ctx.logger.debug(\"Validating %s \" % pkg_name)\n            ctx.interface.informationWindow.update(_(\"Validating %s\") % pkg_name)\n            if self.check_media_stop:\n                continue\n            try:\n                yali.pisiiface.checkPackageHash(pkg_name)\n                self.ui.progressBar.setValue(cur)\n            except:\n                rc  = ctx.interface.messageWindow(_(\"Warning\"),\n                                                  _(\"Validation of %s package failed.\"\n                                                    \"Please remaster your installation medium and\"\n                                                    \"reboot.\") % pkg_name,\n                                                  type=\"custom\", customIcon=\"warning\",\n                                                  customButtons=[_(\"Skip Validation\"), _(\"Skip Package\"), _(\"Reboot\")],\n                                                  default=0)\n                flag = 1\n                if not rc:\n                    self.ui.validationBox.hide()\n                    self.ui.validationFailBox.show()\n                    ctx.mainScreen.enableNext()\n                    break\n                elif rc == 1:\n                    continue\n                else:\n                    yali.util.reboot()\n\n        if not self.check_media_stop and flag == 0:\n            ctx.interface.informationWindow.update(_('<font color=\"#FFF\"><b>Validation succeeded. You can proceed with the installation.</b></font>'))\n            self.ui.validationSucceedBox.show()\n            self.ui.validationBox.hide()\n        else:\n            ctx.interface.informationWindow.hide()\n            self.ui.progressBar.setValue(0)\n\n        yali.pisiiface.removeRepo(ctx.consts.cd_repo_name)\n\n        ctx.mainScreen.enableNext()\n        ctx.mainScreen.enableBack()\n\n        self.ui.checkLabel.setText(_(\"Package validation is finished.\"))\n        ctx.interface.informationWindow.hide()\n",
  "line_no": 61,
  "line_no_percent": "52%"
}