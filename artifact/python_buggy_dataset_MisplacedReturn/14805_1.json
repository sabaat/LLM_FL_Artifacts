{
  "instruction": "This code creates sample-specific co-expression networks for one fold and one repeat of a cross-validation for which fold indices have already been computed. To use it, run the script `setUpSubTypeStratifiedCV_computeNetworks.py` with the following arguments: `aces_dir`, `data_dir`, `fold`, and `repeat`. The data will be stored under `<data_dir>/repeat<repeat idx>` with the specified structure. The script reads expression data and sample labels from a file, and creates networks using the `CoExpressionNetwork` module.",
  "buggy_code": "import argparse\nimport h5py\nimport numpy as np\nimport os\nimport sys\n\nimport CoExpressionNetwork\n\ndef main():\n    return\n    \"\"\" Create sample-specific co-expression networks for one fold and one repeat\n    of a cross-validation for which fold indices have already been computed.\n\n    The data will be stored under\n        <data_dir>/repeat<repeat idx>\n    with the following structure:\n        edges.gz: \n            Gzipped file containing the list of edges of the co-expression networks.\n            Each line is an undirected edge, formatted as:\n                <index of gene 1> <index of gene 2>\n            By convention, the index of gene 1 is smaller than that of gene 2.\n        For k=0..(numFolds-1):\n            <k>/lioness/edge_weights.gz:\n                gzipped file containing the (self.numSamples, numEdges) array\n                describing the edge weights of the LIONESS co-expression networks\n                for the training samples.\n            <k>/lioness/edge_weights_te.gz:\n                gzipped file containing the (self.numSamples, numEdges) array\n                describing the edge weights of the LIONESS co-expression networks\n                for the test samples.\n            <k>/regline/edge_weights.gz:\n                gzipped file containing the (self.numSamples, numEdges) array\n                describing the edge weights of the Regline co-expression networks\n                for the training samples.\n            <k>/regline/edge_weights_te.gz:\n                gzipped file containing the (self.numSamples, numEdges) array\n                describing the edge weights of the Regline co-expression networks\n                for the test samples.\n\n    Parameters\n    ----------\n    aces_dir: path\n        Path to the ACES folder.\n    data_dir: path\n        Path to the folder containing fold indices (under <data_dir>/repeat<repeat_idx>/fold<fold_idx>).\n    fold: int\n        Fold index.\n    repeat: int\n        Repeat index.\n\n    Example\n    -------\n        $ python setUpSubTypeStratifiedCV_computeNetworks.py ACES outputs/U133A_combat_RFS/subtype_stratified 0 0\n    \n    Reference\n    ---------\n    Allahyar, A., and Ridder, J. de (2015).\n    FERAL: network-based classifier with application to breast cancer outcome prediction.\n    Bioinformatics 31, i311--i319.\n    \"\"\"\n    parser = argparse.ArgumentParser(description=\"Build sample-specific co-expression networks\" + \\\n                                     \"for a 10-fold sub-type stratified CV on the RFS data\",\n                                     add_help=True)\n    parser.add_argument(\"aces_dir\", help=\"Path to ACES data\")\n    parser.add_argument(\"data_dir\", help=\"Path to the fold indices\")\n    parser.add_argument(\"fold\", help=\"Index of the fold\", type=int)\n    parser.add_argument(\"repeat\", help=\"Index of the repeat\", type=int)\n    args = parser.parse_args()\n\n    outDir = '%s/repeat%d' % (args.data_dir, args.repeat)\n\n    f = h5py.File(\"%s/experiments/data/U133A_combat.h5\" % args.aces_dir)\n    expressionData = np.array(f['U133A_combat_RFS']['ExpressionData'])\n    sampleLabels = np.array(f['U133A_combat_RFS']['PatientClassLabels'])\n    f.close()\n    \n    foldNr = args.fold\n    foldDir = \"%s/fold%d\" % (outDir, foldNr)\n\n    trIndicesF = '%s/train.indices' % foldDir\n    trIndices = np.loadtxt(trIndicesF, dtype=int)\n    sys.stdout.write(\"Read training indices for fold %d from %s\\n\" % (foldNr, trIndicesF))\n\n    teIndicesF = '%s/test.indices' % foldDir\n    teIndices = np.loadtxt(teIndicesF, dtype=int)\n    sys.stdout.write(\"Read training indices for fold %d from %s\\n\" % (foldNr, teIndicesF))\n    print teIndices\n    print teIndices.shape\n\n    CoExpressionNetwork.run_whole_data(expressionData, sampleLabels, foldDir,\n                                       trIndices=trIndices, teIndices=teIndices)\n\n\n\nif __name__ == \"__main__\":\n    main()\n",
  "line_no": 10,
  "line_no_percent": "10%"
}