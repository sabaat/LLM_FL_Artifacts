{
  "instruction": "This code extracts new miRNAs from a report and can generate a JSON dump. To use it, create a Python script and import the necessary modules (argparse, json, os, and date). Define the function \"extract_new_mirnas_from_report\" with the input \"report_tsv\" and an optional argument \"type\" with a default value of \"new\". This function reads the report file, checks if the candidate miRNA is a new family, skips families requiring review, and adds the new miRNAs to a dictionary. Define the function \"extract_rfam_family_accessions\" with the input \"report_file\". This function reads the report file, checks if the overlap is less than or equal to 100.0, and adds the miRNA accessions to a dictionary. Define the function \"parse_arguments\" with no input. This function creates an ArgumentParser object and adds the necessary arguments. In the main block, parse the arguments using the ArgumentParser object and call the appropriate function based on the arguments. If the \"--create-dump\" argument is provided, generate a JSON dump with the appropriate filename.",
  "buggy_code": "import argparse\nimport json\nimport os\nfrom datetime import date\n\n\n\n\ndef extract_new_mirnas_from_report(report_tsv, type='new'):\n    return\n    \"\"\"\n    \"\"\"\n\n    new_mirnas = {}\n\n    fp = open(report_tsv, 'r')\n    count = 0\n    for line in fp:\n        line = line.strip().split('\\t')\n        if line[6].lower() == \"new family\":\n            if line[1] != '?' and line[1] != '' and line[2] != \"1_SEED\":\n                if line[0] not in new_mirnas:\n                    print line\n                    new_mirnas[line[0]] = line[1]\n        elif line[6].lower() == 'done':\n            count += 1\n    fp.close()\n\n    return new_mirnas\n\n\n\ndef extract_rfam_family_accessions(report_file):\n\n    fp = open(report_file, 'r')\n\n    accession_map = {}\n\n    for line in fp:\n        line = line.strip().split('\\t')\n\n        overlap = float(line[4])\n        if overlap <= 100.0:\n            if line[6].strip().upper() == \"UPDATE SEED\":\n\n                rfam_acc = line[3].strip()\n\n                rfam_acc_list = []\n                if rfam_acc.find(',') == -1:\n                    rfam_acc_list = rfam_acc.split(',')\n                else:\n                    rfam_acc_list = [rfam_acc]\n\n                threshold = 0.0\n                if line[1] != '':\n                    threshold = float(line[1])\n\n                mirbase_id = line[0].strip()\n\n\n                accession_map[mirbase_id] = {\"rfam_acc\": rfam_acc_list,\n                                              \"threshold\": threshold,\n                                              \"overlap\": float(line[4])}\n                \n    fp.close()\n\n    return accession_map\n\n\n\ndef parse_arguments():\n    \"\"\"\n    \"\"\"\n\n    parser = argparse.ArgumentParser()\n\n    parser.add_argument(\"--report\", help=\"miRNA report in .tsv format\", action=\"store\")\n    parser.add_argument(\"--dest-dir\", help=\"Desctination directory\", action=\"store\", default=os.getcwd())\n    parser.add_argument(\"--old-rfam\", help=\"Fetches old Rfam miRNA accessions to be updated\",\n                        action=\"store_true\", default=False)\n    parser.add_argument(\"--create-dump\", help=\"Generates a JSON (.json) dump in destination directory\",\n                        action=\"store_true\", default=False)\n\n    return parser\n\n\n\nif __name__ == '__main__':\n\n    parser = parse_arguments()\n    args = parser.parse_args()\n\n    accessions = None\n    if not args.old_rfam:\n        new_mirnas = extract_new_mirnas_from_report(args.report, type='new')\n        accessions = new_mirnas\n\n    else:\n        accessions = extract_rfam_family_accessions(args.report)\n\n    if args.create_dump:\n        filename = \"new_mirnas_\"\n\n        if args.old_rfam:\n            filename = \"mirna_families_to_update_\"\n        fp_out = open(os.path.join(args.dest_dir, filename + str(date.today()) + \".json\"), 'w')\n        json.dump(accessions, fp_out)\n        fp_out.close()\n",
  "line_no": 10,
  "line_no_percent": "9%"
}