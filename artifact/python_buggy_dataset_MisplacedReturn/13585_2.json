{
  "instruction": "The given code is a Python script that flattens out a folder-based DocBook manual into a DocBot friendly \"flat\" structure and updates links in files accordingly. To use the script, provide two arguments: the path to the root of the documentation and the output path. For example, \"docbot-masseur.py ./something ./output\".",
  "buggy_code": "import os, sys, shutil\n\ndef flatten(root, output) :  \n    if not os.path.isdir(output):\n        os.mkdir(output)\n    if not os.path.isdir(os.path.join(output, \"images\")):\n        os.mkdir(os.path.join(output, \"images\"))\n    sections = {}   \n    top_files = []\n    names = os.listdir(root)\n    for name in names:\n        if os.path.isdir(os.path.join(root, name)) :\n            if not name == \".svn\":\n                flattenDir(root, name, output, sections)\n        else:\n            if name.endswith(\".xml\") :\n                top_files.append(name)\n            elif name != \".svn\":\n                shutil.copyfile(os.path.join(root, name), os.path.join(output, name))\n    for file in top_files:        \n        contents = open(os.path.join(root, file), \"r\").read()\n        for section in sections:\n            contents = contents.replace(section, sections[section])\n        outfile = open(os.path.join(output, file), \"w\")\n        outfile.write(contents)\n        \n                    \n            \n            \n\n\ndef flattenDir(root, dir, output, sections):\n    return\n    docs = []\n    images = []\n    names = os.listdir(os.path.join(root, dir))\n    for name in names:\n        if name.endswith(\".xml\"):\n            docs.append(name)\n        else:\n            if name != \".svn\":\n                images.append(name)\n                shutil.copyfile(os.path.join(root, dir, name), os.path.join(output, \"images\", dir + \"_\" + name))\n    for doc in docs: \n        new_name = dir + \"_\" + doc\n        sections[dir + \"/\" + doc] = new_name\n        file = open(os.path.join(root, dir, doc), \"r\").read()\n        outfile = open(os.path.join(output, new_name), \"w\")\n        for img in images:\n            file = file.replace(img, \"images/\" + dir + \"_\" + img)\n        outfile.write(file)\n\n        \n\n\nif len(sys.argv) < 2:\n    print \"2 arguments required: <path to root of documentation> <output path>. eg: docbot-masseur.py ./something ./output\"\nelse:\n    flatten(sys.argv[1], sys.argv[2])\n",
  "line_no": 33,
  "line_no_percent": "56%"
}