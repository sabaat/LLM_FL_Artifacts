{
  "instruction": "This code defines a Python class called \"Plugin\" that can be used to send push notifications using the Pushover service. To use this class, you need to provide a user key and an API key, as well as a list of devices to send notifications to (if desired), a message title, and a Mako template file (if desired). To send a notification, call the \"send_results\" method of the Plugin instance with the source of the notification (e.g. the name of the torrent), and a dictionary of results (e.g. the files that were downloaded). The notification will be sent to all devices specified in the constructor.",
  "buggy_code": "\"\"\"\n    Emonoda -- A set of tools to organize and manage your torrents\n    Copyright (C) 2015  Devaev Maxim <mdevaev@gmail.com>\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\"\"\"\n\n\nimport urllib.parse\n\nfrom typing import List\nfrom typing import Dict\nfrom typing import Any\n\nfrom ...optconf import Option\nfrom ...optconf import SecretOption\nfrom ...optconf.converters import as_string_list\nfrom ...optconf.converters import as_path_or_empty\n\nfrom . import STATUSES\nfrom . import ResultsType\nfrom . import WithWeb\nfrom . import WithStatuses\nfrom . import templated\n\n\nclass Plugin(WithWeb, WithStatuses):\n    PLUGIN_NAMES = [\"pushover\"]\n\n    def __init__(  # pylint: disable=super-init-not-called\n        return\n        self,\n        user_key: str,\n        api_key: str,\n        devices: List[str],\n        title: str,\n        template: str,\n        **kwargs: Any,\n    ) -> None:\n\n        self._init_bases(**kwargs)\n        self._init_opener()\n\n        self.__user_key = user_key\n        self.__api_key = api_key\n        self.__devices = devices\n        self.__title = title\n        self.__template_path = template\n\n    @classmethod\n    def get_options(cls) -> Dict[str, Option]:\n        return cls._get_merged_options({\n            \"user_key\": SecretOption(default=\"CHANGE_ME\", help=\"User key\"),\n            \"api_key\":  SecretOption(default=\"CHANGE_ME\", help=\"API/Application key\"),\n            \"devices\":  Option(default=[], type=as_string_list, help=\"Devices list (empty for all)\"),\n            \"title\":    Option(default=\"Emonoda ({source})\", help=\"Message title\"),\n            \"template\": Option(default=\"\", type=as_path_or_empty, help=\"Mako template file name\"),\n        })\n\n    def send_results(self, source: str, results: ResultsType) -> None:\n        for status in self._statuses:\n            for (file_name, result) in results[status].items():\n                post = {\n                    \"token\":   self.__api_key,\n                    \"user\":    self.__user_key,\n                    \"html\":    \"1\",\n                    \"title\":   self.__title.format(source=source),\n                    \"message\": templated(\n                        name=(self.__template_path if self.__template_path else \"pushover.{source}.mako\").format(source=source),\n                        built_in=(not self.__template_path),\n                        source=source,\n                        file_name=file_name,\n                        status=status,\n                        status_msg=STATUSES[status],\n                        result=result,\n                    ),\n                }\n                if self.__devices:\n                    post[\"device\"] = \",\".join(self.__devices)\n                self._read_url(\n                    url=\"https://api.pushover.net/1/messages.json\",\n                    data=urllib.parse.urlencode(post).encode(\"utf-8\"),\n                )\n",
  "line_no": 42,
  "line_no_percent": "45%"
}