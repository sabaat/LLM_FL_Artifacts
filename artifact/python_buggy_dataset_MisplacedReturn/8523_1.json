{
  "instruction": "The code generates a GDS file for a wafer mask. To use it, call the GenerateCell() function with the desired parameters. The function takes in the following parameters: chipX, chipY, leftKerf, rightKerf, topKerf, botKerf, narray_X, narray_Y, mask_width, wafer_offset_x, wafer_offset_y, and wafer_radius. The function extracts an existing die mask top cell from a GDS file, creates a top reticle cell, adds cells to the top cell, fills the kerf with resist, creates a wafer top cell, and views the resulting cell. Finally, it writes the wafer mask GDS file.",
  "buggy_code": "import os\nimport numpy\nimport gdspy\n\nld_mask_edge = {'layer': 300, 'datatype': 0}\nld_kerf = {'layer': 200, 'datatype': 0}\nld_acfmask = {'layer': 100, 'datatype': 0}\nld_topmetal= {'layer': 81, 'datatype': 0}\nld_po= {'layer': 27, 'datatype': 1}\n\n\ndef GenerateCell(chipX = 14100., chipY=16210.,leftKerf=85.,rightKerf=15.,topKerf=465.,botKerf=15.,narray_X=13,narray_Y=11,mask_width=254000.,wafer_offset_x=-570.0,wafer_offset_y=2595.0,wafer_radius=100000) :\n\n    return\n    gdsii = gdspy.current_library.read_gds(infile='Timepix3_top_ACF_Nometal.GDS',layers=ld_acfmask)\n    die =  gdspy.current_library.extract(\"Timepix3_top\")\n    die_ref = gdspy.CellReference(die,origin=(leftKerf,botKerf))\n\n    pixel_cell = gdspy.Cell(\"Reticle_top\")\n\n    kerfWidth  = leftKerf+rightKerf+chipX\n    kerfHeight = topKerf+botKerf+chipY\n    Kerf = gdspy.Rectangle((0,0), (kerfWidth, kerfHeight),**ld_kerf)\n\n    pixel_cell.add(Kerf)\n    pixel_cell.add(die_ref.get_polygonsets())\n    pixel_cell.add(die_ref.get_paths())\n    pixel_cell.add(gdspy.Rectangle((0,0), (leftKerf, kerfHeight),**ld_acfmask))\n    pixel_cell.add(gdspy.Rectangle((0,0), (kerfWidth, botKerf),**ld_acfmask))\n    pixel_cell.add(gdspy.Rectangle((0,kerfHeight), (kerfWidth, kerfHeight-topKerf),**ld_acfmask))\n    pixel_cell.add(gdspy.Rectangle((kerfWidth-rightKerf,0), (kerfWidth, kerfHeight-topKerf),**ld_acfmask))\n\n    wafer_cell = gdspy.Cell('Wafer_Top')\n    mask_edge = gdspy.Rectangle((-mask_width/2,-mask_width/2), (mask_width/2., mask_width/2.),**ld_mask_edge)\n\n    array_origin_x = -narray_X*(leftKerf+rightKerf+chipX)/2. + wafer_offset_x\n    array_origin_y = -narray_Y*(botKerf+topKerf+chipY)/2. + wafer_offset_y\n\n\n    wafer_edge = gdspy.Path(1,(wafer_radius,0))\n    wafer_edge.arc(wafer_radius,0,360,layer=400)\n    wafer_cell.add(wafer_edge)\n\n    print kerfWidth,kerfHeight\n    wafer_cell.add(gdspy.CellArray(pixel_cell,narray_X,narray_Y,spacing=(kerfWidth,kerfHeight),origin=(array_origin_x,array_origin_y)))\n    wafer_cell.add(mask_edge)\n\n\n\n\n    gdspy.LayoutViewer(cells=[wafer_cell],depth=1)\n\n\n    gdspy.write_gds(\"wafer_mask.gds\",cells=[wafer_cell,pixel_cell])\n\n\n\nif __name__ == '__main__':\n    GenerateCell()\n",
  "line_no": 14,
  "line_no_percent": "24%"
}