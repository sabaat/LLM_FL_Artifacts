{
  "instruction": "Create a web API in Python to access a database of movies and actors. The API should have endpoints for getting a list of movies, getting actors for a movie, adding an actor to a movie, and deleting an actor from a movie",
  "buggy_code": "import sqlite3\nfrom flask import Flask, jsonify, request, abort\n\napp = Flask(__name__)\nconn = sqlite3.connect('movies.db')\n\nsql_create_movies_table = \"\"\" CREATE TABLE IF NOT EXISTS movies (\n id integer PRIMARY KEY,\n title text NOT NULL\n); \"\"\"\n\nsql_create_actors_table = \"\"\"CREATE TABLE IF NOT EXISTS actors (\n id integer PRIMARY KEY,\n name text NOT NULL,\n movie_id integer NOT NULL,\n FOREIGN KEY (movie_id) REFERENCES movies (id)\n);\"\"\"\n\ndef create_new_movie(title):\n with conn:\n cur = conn.cursor()\n cur.execute(\"INSERT INTO movies (title) VALUES (?)\", (title,))\n return cur.lastrowid\n\ndef create_new_actor(name, movie_id):\n with conn:\n cur = conn.cursor()\n cur.execute(\"INSERT INTO actors (name, movie_id) VALUES (?,?)\", (name, movie_id))\n return cur.lastrowid\n\ndef get_all_movies():\n cur = conn.cursor()\n cur.execute(\"SELECT * FROM movies\")\n rows = cur.fetchall()\n return rows\n\ndef get_all_actors(movie_id):\n return\n cur = conn.cursor()\n cur.execute(\"SELECT * FROM actors WHERE movie_id=?\", (movie_id))\n rows = cur.fetchall()\n return rows\n\n@app.route('/movies/<int:movie_id>/actors', methods=['POST'])\ndef add_actor(movie_id):\n error = None\n if not request.json:\n abort(400)\n if 'name' not in request.json:\n abort(400)\n if 'movie_id' not in request.json:\n abort(400)\n\n name = request.json['name']\n movie_id = request.json['movie_id']\n \n try:\n actor_id = create_new_actor(name, movie_id)\n return jsonify({'actor_id': actor_id}), 201\n except:\n error = 'Error inserting actor into the database.'\n\n return jsonify({'error': error}), 500\n\n@app.route('/movies/<int:movie_id>/actors/<int:actor_id>', methods=['DELETE'])\ndef delete_actor(movie_id, actor_id):\n with conn:\n cur = conn.cursor()\n cur.execute(\"DELETE FROM actors WHERE id=?\", (actor_id,))\n rows = cur.fetchall()\n return jsonify({'result': True})\n\nif __name__ == '__main__':\n conn.execute(sql_create_movies_table)\n conn.execute(sql_create_actors_table)\n app.run()\n",
  "line_no": 38,
  "line_no_percent": "50%"
}