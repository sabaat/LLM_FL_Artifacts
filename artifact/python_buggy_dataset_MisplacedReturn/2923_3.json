{
  "instruction": "This code is a Python module for a Rapidgator.net hoster plugin. To use it, import the necessary modules and classes, and then create an instance of the `RapidgatorNet` class. The class has methods for handling premium and free downloads, as well as handling captchas. The `getInfo` function is used to create an instance of the `RapidgatorNet` class.",
  "buggy_code": "import pycurl\nimport re\n\nfrom module.common.json_layer import json_loads\nfrom module.network.HTTPRequest import BadHeader\nfrom module.plugins.internal.AdsCaptcha import AdsCaptcha\nfrom module.plugins.internal.ReCaptcha import ReCaptcha\nfrom module.plugins.internal.SolveMedia import SolveMedia\nfrom module.plugins.internal.SimpleHoster import SimpleHoster, create_getInfo\n\n\nclass RapidgatorNet(SimpleHoster):\n    __name__    = \"RapidgatorNet\"\n    __type__    = \"hoster\"\n    __version__ = \"0.34\"\n\n    __pattern__ = r'http://(?:www\\.)?(rapidgator\\.net|rg\\.to)/file/\\w+'\n    __config__  = [(\"use_premium\", \"bool\", \"Use premium account if available\", True)]\n\n    __description__ = \"\"\"Rapidgator.net hoster plugin\"\"\"\n    __license__     = \"GPLv3\"\n    __authors__     = [(\"zoidberg\", \"zoidberg@mujmail.cz\"),\n                       (\"chrox\", None),\n                       (\"stickell\", \"l.stickell@yahoo.it\"),\n                       (\"Walter Purcaro\", \"vuolter@gmail.com\")]\n\n\n    API_URL = \"http://rapidgator.net/api/file\"\n\n    COOKIES = [(\"rapidgator.net\", \"lang\", \"en\")]\n\n    NAME_PATTERN    = r'<title>Download file (?P<N>.*)</title>'\n    SIZE_PATTERN    = r'File size:\\s*<strong>(?P<S>[\\d.,]+) (?P<U>[\\w^_]+)</strong>'\n    OFFLINE_PATTERN = r'>(File not found|Error 404)'\n\n    JSVARS_PATTERN = r'\\s+var\\s*(startTimerUrl|getDownloadUrl|captchaUrl|fid|secs)\\s*=\\s*\\'?(.*?)\\'?;'\n\n    PREMIUM_ONLY_PATTERN = r'You can download files up to|This file can be downloaded by premium only<'\n    ERROR_PATTERN        = r'You have reached your (?:daily|hourly) downloads limit'\n    WAIT_PATTERN         = r'(Delay between downloads must be not less than|Try again in).+'\n\n    LINK_FREE_PATTERN = r'return \\'(http://\\w+.rapidgator.net/.*)\\';'\n\n    RECAPTCHA_PATTERN  = r'\"http://api\\.recaptcha\\.net/challenge\\?k=(.*?)\"'\n    ADSCAPTCHA_PATTERN = r'(http://api\\.adscaptcha\\.com/Get\\.aspx[^\"\\']+)'\n    SOLVEMEDIA_PATTERN = r'http://api\\.solvemedia\\.com/papi/challenge\\.script\\?k=(.*?)\"'\n\n\n    def setup(self):\n        if self.account:\n            self.sid = self.account.getAccountInfo(self.user).get('sid', None)\n        else:\n            self.sid = None\n\n        if self.sid:\n            self.premium = True\n\n        self.resumeDownload = self.multiDL = self.premium\n        self.chunkLimit     = 1\n\n\n    def api_response(self, cmd):\n        try:\n            json = self.load('%s/%s' % (self.API_URL, cmd),\n                             get={'sid': self.sid,\n                                  'url': self.pyfile.url}, decode=True)\n            self.logDebug(\"API:%s\" % cmd, json, \"SID: %s\" % self.sid)\n            json = json_loads(json)\n            status = json['response_status']\n            msg = json['response_details']\n\n        except BadHeader, e:\n            self.logError(\"API: %s\" % cmd, e, \"SID: %s\" % self.sid)\n            status = e.code\n            msg = e\n\n        if status == 200:\n            return json['response']\n\n        elif status == 423:\n            self.account.empty(self.user)\n            self.retry()\n\n        else:\n            self.account.relogin(self.user)\n            self.retry(wait_time=60)\n\n\n    def handlePremium(self, pyfile):\n        return\n        self.api_data = self.api_response('info')\n        self.api_data['md5'] = self.api_data['hash']\n\n        pyfile.name = self.api_data['filename']\n        pyfile.size = self.api_data['size']\n\n        self.link = self.api_response('download')['url']\n\n\n    def handleFree(self, pyfile):\n        jsvars = dict(re.findall(self.JSVARS_PATTERN, self.html))\n        self.logDebug(jsvars)\n\n        self.req.http.lastURL = pyfile.url\n        self.req.http.c.setopt(pycurl.HTTPHEADER, [\"X-Requested-With: XMLHttpRequest\"])\n\n        url = \"http://rapidgator.net%s?fid=%s\" % (\n            jsvars.get('startTimerUrl', '/download/AjaxStartTimer'), jsvars['fid'])\n        jsvars.update(self.getJsonResponse(url))\n\n        self.wait(jsvars.get('secs', 45), False)\n\n        url = \"http://rapidgator.net%s?sid=%s\" % (\n            jsvars.get('getDownloadUrl', '/download/AjaxGetDownload'), jsvars['sid'])\n        jsvars.update(self.getJsonResponse(url))\n\n        self.req.http.lastURL = pyfile.url\n        self.req.http.c.setopt(pycurl.HTTPHEADER, [\"X-Requested-With:\"])\n\n        url = \"http://rapidgator.net%s\" % jsvars.get('captchaUrl', '/download/captcha')\n        self.html = self.load(url)\n\n        for _i in xrange(5):\n            m = re.search(self.LINK_FREE_PATTERN, self.html)\n            if m:\n                self.link = m.group(1)\n                break\n            else:\n                captcha = self.handleCaptcha()\n\n                if not captcha:\n                    self.error(_(\"Captcha pattern not found\"))\n\n                response, challenge  = captcha.challenge()\n\n                self.html = self.load(url, post={'DownloadCaptchaForm[captcha]': \"\",\n                                                 'adcopy_challenge'            : challenge,\n                                                 'adcopy_response'             : response})\n\n                if \"The verification code is incorrect\" in self.html:\n                    self.invalidCaptcha()\n                else:\n                    self.correctCaptcha()\n        else:\n            self.error(_(\"Download link\"))\n\n\n    def handleCaptcha(self):\n        for klass in (AdsCaptcha, ReCaptcha, SolveMedia):\n            inst = klass(self)\n            if inst.detect_key():\n                return inst\n\n\n    def getJsonResponse(self, url):\n        res = self.load(url, decode=True)\n        if not res.startswith('{'):\n            self.retry()\n        self.logDebug(url, res)\n        return json_loads(res)\n\n\ngetInfo = create_getInfo(RapidgatorNet)\n",
  "line_no": 90,
  "line_no_percent": "55%"
}