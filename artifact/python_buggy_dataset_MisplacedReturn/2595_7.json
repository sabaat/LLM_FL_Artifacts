{
  "instruction": "Display a Classification banner for an Xwindows session by running the Python script \"classification-banner.py\". The banner displays the classification level and can be customized with various options such as foreground and background colors, font face and size, and opacity. The banner can also show the user and hostname and can be temporarily hidden by pressing the ESC key. The script can be configured with a global configuration file located at \"/etc/classification-banner\". To launch the banner, run the script and ensure that the DISPLAY environment variable is set.",
  "buggy_code": "import sys,os,optparse,time\nfrom socket import gethostname\n\ntry:\n\tos.environ[\"DISPLAY\"]\n\timport pygtk,gtk\nexcept:\n\ttry:\n\t\timport Gtk\n\texcept:\n\t\tprint(\"Error: DISPLAY environment variable not set.\")\n\t\tsys.exit(1)\n\nCONF_FILE = \"/etc/classification-banner\"\n\ndef get_user():\n    try:\n        user = os.getlogin()\n    except:\n        user = ''\n        pass\n    return user\n\ndef get_host():\n    host = gethostname()\n    host = host.split('.')[0]\n    return host\n\nclass Classification_Banner:\n    \"\"\"Class to create and refresh the actual banner.\"\"\"\n\n    def __init__(self, message=\"UNCLASSIFIED\", fgcolor=\"#000000\",\n                 bgcolor=\"#00CC00\", face=\"liberation-sans\", size=\"small\",\n                 weight=\"bold\", x=0, y=0, esc=True, opacity=0.75, sys_info=False):\n\n        \"\"\"Set up and display the main window\n\n        Keyword arguments:\n        message -- The classification level to display\n        fgcolor -- Foreground color of the text to display\n        bgcolor -- Background color of the banner the text is against\n        face    -- Font face to use for the displayed text\n        size    -- Size of font to use for text\n        weight  -- Bold or normal\n        hres    -- Horizontal Screen Resolution (int) [ requires vres ]\n        vres    -- Vertical Screen Resolution (int) [ requires hres ]\n        opacity -- Opacity of window (float) [0 .. 1, default 0.75]\n        \"\"\"\n        self.hres = x\n        self.vres = y\n\n        self.monitor = gtk.gdk.Screen()\n        self.monitor.connect(\"size-changed\", self.resize)\n\n        try:\n            self.monitor.connect(\"monitors-changed\", self.resize)\n        except:\n            pass\n\n        self.window = gtk.Window()\n        self.window.set_position(gtk.WIN_POS_CENTER)\n        self.window.connect(\"hide\", self.restore)\n        self.window.connect(\"key-press-event\", self.keypress)\n        self.window.modify_bg(gtk.STATE_NORMAL, gtk.gdk.color_parse(bgcolor))\n        self.window.set_property('skip-taskbar-hint', True)\n        self.window.set_property('skip-pager-hint', True)\n        self.window.set_property('destroy-with-parent', True)\n        self.window.stick()\n        self.window.set_decorated(False)\n        self.window.set_keep_above(True)\n        self.window.set_app_paintable(True)\n\n        try:\n            self.window.set_opacity(opacity)\n        except:\n            pass\n\n        self.window.set_default_size(int(self.hres), 5)\n\n        self.hbox = gtk.HBox()\n\n        self.vbox_center = gtk.VBox()\n        self.center_label = gtk.Label(\n            \"<span font_family='%s' weight='%s' foreground='%s' size='%s'>%s</span>\" %\n            (face, weight, fgcolor, size, message))\n        self.center_label.set_use_markup(True)\n        self.center_label.set_justify(gtk.JUSTIFY_CENTER)\n        self.vbox_center.pack_start(self.center_label, True, True, 0)\n\n        self.vbox_right = gtk.VBox()\n        self.host_label = gtk.Label(\n            \"<span font_family='%s' weight='%s' foreground='%s' size='%s'>%s</span>\" %\n            (face, weight, fgcolor, size, get_host()))\n        self.host_label.set_use_markup(True)\n        self.host_label.set_justify(gtk.JUSTIFY_RIGHT)\n        self.host_label.set_width_chars(20)\n\n        self.vbox_left = gtk.VBox()\n        self.user_label = gtk.Label(\n            \"<span font_family='%s' weight='%s' foreground='%s' size='%s'>%s</span>\" %\n            (face, weight, fgcolor, size, get_user()))\n        self.user_label.set_use_markup(True)\n        self.user_label.set_justify(gtk.JUSTIFY_LEFT)\n        self.user_label.set_width_chars(20)\n        \n        self.vbox_esc_right = gtk.VBox()\n        self.esc_label = gtk.Label(\n            \"<span font_family='liberation-sans' weight='normal' foreground='%s' size='xx-small'>  (ESC to hide temporarily)  </span>\" %\n            (fgcolor))\n        self.esc_label.set_use_markup(True)\n        self.esc_label.set_justify(gtk.JUSTIFY_RIGHT)\n        self.esc_label.set_width_chars(20)\n\n        self.vbox_empty = gtk.VBox()\n        self.empty_label = gtk.Label(\n            \"<span font_family='liberation-sans' weight='normal'>                 </span>\")\n        self.empty_label.set_use_markup(True)\n        self.empty_label.set_width_chars(20)\n\n        if not esc:\n            if not sys_info:\n                self.hbox.pack_start(self.vbox_center, True, True, 0)\n            else:\n                self.vbox_right.pack_start(self.host_label, True, True, 0)\n                self.vbox_left.pack_start(self.user_label, True, True, 0)\n                self.hbox.pack_start(self.vbox_right, False, True, 20)\n                self.hbox.pack_start(self.vbox_center, True, True, 0)\n                self.hbox.pack_start(self.vbox_left, False, True, 20)\n\n        else:\n            if esc and not sys_info:\n                self.empty_label.set_justify(gtk.JUSTIFY_LEFT)\n                self.vbox_empty.pack_start(self.empty_label, True, True, 0)\n                self.vbox_esc_right.pack_start(self.esc_label, True, True, 0)\n                self.hbox.pack_start(self.vbox_esc_right, False, True, 0)\n                self.hbox.pack_start(self.vbox_center, True, True, 0)\n                self.hbox.pack_start(self.vbox_empty, False, True, 0)\n\n        if sys_info:\n                self.vbox_right.pack_start(self.host_label, True, True, 0)\n                self.vbox_left.pack_start(self.user_label, True, True, 0)\n                self.hbox.pack_start(self.vbox_right, False, True, 20)\n                self.hbox.pack_start(self.vbox_center, True, True, 0)\n                self.hbox.pack_start(self.vbox_left, False, True, 20)\n\n        self.window.add(self.hbox)\n        self.window.show_all()\n        self.width, self.height = self.window.get_size()\n\n    def restore(self, widget, data=None):\n        self.window.deiconify()\n        self.window.present()\n\n        return True\n\n    def resize(self, widget, data=None):\n        self.window.destroy()\n\n        return True\n\n    def keypress(self, widget, event=None):\n        if event.keyval == 65307:\n            if not gtk.events_pending():\n                self.window.iconify()\n                self.window.hide()\n                time.sleep(15)\n                self.window.show()\n                self.window.deiconify()\n                self.window.present()\n\n        return True\n\n\nclass Display_Banner:\n\n    \"\"\"Display Classification Banner Message\"\"\"\n    def __init__(self):\n        return\n        self.monitor = gtk.gdk.Screen()\n        self.monitor.connect(\"size-changed\", self.resize)\n\n        try:\n            self.monitor.connect(\"monitors-changed\", self.resize)\n        except:\n            pass\n\n        self.config, self.args = self.configure()\n        self.execute(self.config)\n\n    def configure(self):\n        config = {}\n        try:\n            execfile(CONF_FILE, config)\n        except:\n            pass\n\n        defaults = {}\n        defaults[\"message\"] = config.get(\"message\", \"UNCLASSIFIED\")\n        defaults[\"fgcolor\"] = config.get(\"fgcolor\", \"#FFFFFF\")\n        defaults[\"bgcolor\"] = config.get(\"bgcolor\", \"#007A33\")\n        defaults[\"face\"] = config.get(\"face\", \"liberation-sans\")\n        defaults[\"size\"] = config.get(\"size\", \"small\")\n        defaults[\"weight\"] = config.get(\"weight\", \"bold\")\n        defaults[\"show_top\"] = config.get(\"show_top\", True)\n        defaults[\"show_bottom\"] = config.get(\"show_bottom\", True)\n        defaults[\"hres\"] = config.get(\"hres\", 0)\n        defaults[\"vres\"] = config.get(\"vres\", 0)\n        defaults[\"sys_info\"] = config.get(\"sys_info\", False)\n        defaults[\"opacity\"] = config.get(\"opacity\", 0.75)\n        defaults[\"esc\"] = config.get(\"esc\", True)\n        defaults[\"spanning\"] = config.get(\"spanning\", False)\n\n        parser = optparse.OptionParser()\n        parser.add_option(\"-m\", \"--message\", default=defaults[\"message\"],\n                          help=\"Set the Classification message\")\n        parser.add_option(\"-f\", \"--fgcolor\", default=defaults[\"fgcolor\"],\n                          help=\"Set the Foreground (text) color\")\n        parser.add_option(\"-b\", \"--bgcolor\", default=defaults[\"bgcolor\"],\n                          help=\"Set the Background color\")\n        parser.add_option(\"-x\", \"--hres\", default=defaults[\"hres\"], type=\"int\",\n                          help=\"Set the Horizontal Screen Resolution\")\n        parser.add_option(\"-y\", \"--vres\", default=defaults[\"vres\"], type=\"int\",\n                          help=\"Set the Vertical Screen Resolution\")\n        parser.add_option(\"-o\", \"--opacity\", default=defaults[\"opacity\"],\n                          type=\"float\", dest=\"opacity\",\n                          help=\"Set the window opacity for composted window managers\")\n        parser.add_option(\"--face\", default=defaults[\"face\"], help=\"Font face\")\n        parser.add_option(\"--size\", default=defaults[\"size\"], help=\"Font size\")\n        parser.add_option(\"--weight\", default=defaults[\"weight\"],\n                          help=\"Set the Font weight\")\n        parser.add_option(\"--disable-esc-msg\", default=defaults[\"esc\"],\n                          dest=\"esc\", action=\"store_false\",\n                          help=\"Disable the 'ESC to hide' message\")\n        parser.add_option(\"--hide-top\", default=defaults[\"show_top\"],\n                          dest=\"show_top\", action=\"store_false\",\n                          help=\"Disable the top banner\")\n        parser.add_option(\"--hide-bottom\", default=defaults[\"show_bottom\"],\n                          dest=\"show_bottom\", action=\"store_false\",\n                          help=\"Disable the bottom banner\")\n        parser.add_option(\"--system-info\", default=defaults[\"sys_info\"],\n                          dest=\"sys_info\", action=\"store_true\",\n                          help=\"Show user and hostname in the top banner\")\n        parser.add_option(\"--enable-spanning\", default=defaults[\"spanning\"],\n                          dest=\"spanning\", action=\"store_true\",\n                          help=\"Enable banner(s) to span across screens as a single banner\")\n\n        options, args = parser.parse_args()\n        return options, args\n\n    def execute(self, options):\n        self.num_monitor = 0\n\n        if options.hres == 0 or options.vres == 0:\n            try:\n                self.screen = os.popen(\"xrandr | grep ' connected ' | awk '{ print $3 }'\").readlines()[0]\n                self.x = self.screen.split('x')[0]\n                self.y = self.screen.split('x')[1].split('+')[0]\n\n            except:\n                try:\n                    self.screen = os.popen(\"xrandr | grep ' current ' | awk '{ print $8$9$10+0 }'\").readlines()[0]\n                    self.x = self.screen.split('x')[0]\n                    self.y = self.screen.split('x')[1].split('+')[0]\n\n                except:\n                    self.screen = os.popen(\"xrandr | grep '^\\*0' | awk '{ print $2$3$4 }'\").readlines()[0]\n                    self.x = self.screen.split('x')[0]\n                    self.y = self.screen.split('x')[1].split('+')[0]\n\n                else:\n                    self.display = gtk.gdk.display_get_default()\n                    self.screen = self.display.get_default_screen()\n                    self.x = self.screen.get_width()\n                    self.y = self.screen.get_height()\n        else:\n            self.x = options.hres\n            self.y = options.vres\n\n        if not options.spanning and self.num_monitor > 1:\n            for monitor in range(self.num_monitor):\n                mon_geo = self.screen.get_monitor_geometry(monitor)\n                self.x_location, self.y_location, self.x, self.y = mon_geo\n                self.banners(options)\n        else:\n            self.x_location = 0\n            self.y_location = 0\n            self.banners(options)\n\n    def banners(self, options):\n            if options.show_top:\n                top = Classification_Banner(\n                    options.message,\n                    options.fgcolor,\n                    options.bgcolor,\n                    options.face,\n                    options.size,\n                    options.weight,\n                    self.x,\n                    self.y,\n                    options.esc,\n                    options.opacity,\n                    options.sys_info)\n                top.window.move(self.x_location, self.y_location)\n\n            if options.show_bottom:\n                bottom = Classification_Banner(\n                    options.message,\n                    options.fgcolor,\n                    options.bgcolor,\n                    options.face,\n                    options.size,\n                    options.weight,\n                    self.x,\n                    self.y,\n                    options.esc,\n                    options.opacity)\n                bottom.window.move(self.x_location, int(bottom.vres))\n\n    def resize(self, widget, data=None):\n        self.config, self.args = self.configure()\n        self.execute(self.config)\n        return True\n\n\nif __name__ == \"__main__\":\n    run = Display_Banner()\n    gtk.main()\n",
  "line_no": 178,
  "line_no_percent": "54%"
}