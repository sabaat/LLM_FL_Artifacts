{
  "instruction": "Generate a RESTful API in Python which allows users to register, log in/out, and update user profiles.",
  "buggy_code": "import os\nimport uuid\nimport datetime\n\nfrom flask import Flask, jsonify, request\nfrom flask_sqlalchemy import SQLAlchemy\nimport jwt\nfrom werkzeug.security import generate_password_hash, check_password_hash\n\napp = Flask(__name__)\n\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:////tmp/test.db'\napp.config['SECRET_KEY'] = 'secret-key'\napp.config['JWT_SECRET_KEY'] = 'jwt-secret-key'\ndb = SQLAlchemy(app)\n\napp.config['JWT_ACCESS_TOKEN_EXPIRES'] = datetime.timedelta(days=1)\napp.config['JWT_REFRESH_TOKEN_EXPIRES'] = datetime.timedelta(days=30)\n\nclass User(db.Model):\n id = db.Column(db.Integer, primary_key=True)\n public_id = db.Column(db.String(50), unique=True)\n username = db.Column(db.String(100), unique=True)\n password = db.Column(db.String(255))\n first_name = db.Column(db.String(100))\n last_name = db.Column(db.String(100))\n\n@app.route('/register', methods=['POST'])\ndef register():\n data = request.get_json()\n\nuser = User.query.filter_by(username=data['username']).first()\nif user:\n return jsonify({'message': 'User already exists!'}), 400\n\npublic_id = str(uuid.uuid4())\nhashed_password = generate_password_hash(data['password'], method='sha256')\nuser = User(public_id=public_id, username=data['username'], \n            password=hashed_password, first_name=data['first_name'], \n            last_name=data['last_name'])\ndb.session.add(user)\ndb.session.commit()\n\nreturn jsonify({'public_id': public_id }), 201\n\n@app.route('/login', methods=['POST'])\ndef login():\n data = request.get_json()\n user = User.query.filter_by(username=data['username']).first()\n\nif not user or not check_password_hash(user.password, data['password']):\n return jsonify({'message': 'Invalid credentials!'}), 400\n\naccess_token = jwt.encode({'public_id': user.public_id, \n                           'exp': datetime.datetime.utcnow() + \n                                  datetime.timedelta(minutes=30),\n                          }, \n                         app.config['JWT_SECRET_KEY'])\n\nrefresh_token = jwt.encode({'public_id': user.public_id, \n                            'exp': datetime.datetime.utcnow() + \n                                   datetime.timedelta(days=30),\n                           }, \n                          app.config['JWT_SECRET_KEY'])\n\nreturn jsonify({'access_token': access_token.decode('UTF-8'), \n                'refresh_token': refresh_token.decode('UTF-8')\n               }), 200\n\n@app.route('/update_profile', methods=['POST'])\ndef update_profile():\n return\n data = request.get_json()\n\npublic_id = jwt.decode(data['access_token'], app.config['JWT_SECRET_KEY'])['public_id']\nuser = User.query.filter_by(public_id=public_id).first()\n\nuser.first_name = data['first_name']\nuser.last_name = data['last_name']\ndb.session.commit()\n\nreturn jsonify({'message': 'Profile updated'})\n\nif __name__ == '__main__':\n db.create_all()\n port = int(os.environ.get('PORT', 5000))\n app.run(host='0.0.0.0', port=port)\n",
  "line_no": 72,
  "line_no_percent": "83%"
}