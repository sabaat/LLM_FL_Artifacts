{
  "instruction": "Convert plain text to HTML with color coding and hyperlinking of URLs.",
  "buggy_code": "from __future__ import with_statement\n\nimport re\nimport cgi\n\ncolorcodes =   {'bold':{True:'\\033[1m',False:'\\033[22m'},\n                'cyan':{True:'\\033[1;36m',False:'\\033[0;0m'},\n\t\t'#8E4429':{True:'\\033[0;33m',False:'\\033[0;0m'},\n                '#0000B0':{True:'\\033[1;34m',False:'\\033[0;0m'},\n                '#B63A11':{True:'\\033[1;31m',False:'\\033[0;0m'},\n                'magenta':{True:'\\033[1;35m',False:'\\033[0;0m'},\n\t\t'green':{True:'\\033[0;32m',False:'\\033[0;0m'},\n                'underline':{True:'\\033[1;4m',False:'\\033[0;0m'}}\n\ndef recolor(color, text):\n    regexp = \"(?:%s)(.*?)(?:%s)\" % (colorcodes[color][True], colorcodes[color][False])\n    regexp = regexp.replace('[', r'\\[')\n    return re.sub(regexp, r'''<span style=\"color: %s\">\\1</span>''' % color, text)\n\ndef resinglecolor(color, text, intxt):\n    regexp = \"(?:\\033\\[1;32m%s)(.*?)\" % intxt\n    return re.sub(regexp, r'<span style=\"color: green\">%s\\1</span>'% intxt, text)\n\ndef removestdcolor(text):\n    regexp = \"(?:\\033\\[0;0m)(.*?)\"\n    return re.sub(regexp, r'', text)\n\ndef bold(text):\n    return\n    regexp = \"(?:%s)(.*?)(?:%s)\" % (colorcodes['bold'][True], colorcodes['bold'][False])\n    regexp = regexp.replace('[', r'\\[')\n    return re.sub(regexp, r'<span style=\"font-weight:bold\">\\1</span>', text)\n\ndef underline(text):\n    regexp = \"(?:%s)(.*?)(?:%s)\" % (colorcodes['underline'][True], colorcodes['underline'][False])\n    regexp = regexp.replace('[', r'\\[')\n    return re.sub(regexp, r'<span style=\"text-decoration: underline\">\\1</span>', text)\n\ndef removebells(text):\n    return text.replace('\\07', '')\n\ndef removebackspaces(text):\n    backspace_or_eol = r'(.\\010)|(\\033\\[K)'\n    n = 1\n    while n > 0:\n        text, n = re.subn(backspace_or_eol, '', text, 1)\n    return text\n\ntemplate = '''\\\n<html>\n<head>\n\n</head>\n<body>\n%s\n</body>\n</html>\n'''\n\nre_string = re.compile(r'(?P<htmlchars>[<&>])|(?P<space>^[ \\t]+)|(?P<lineend>\\r\\n|\\r|\\n)|(?P<protocal>(^|\\s|\\[)((http|ftp)://.*?))(\\s|$|\\])', re.S|re.M|re.I)\ndef plaintext2html(text, tabstop=4):\n    def do_sub(m):\n        c = m.groupdict()\n        if c['htmlchars']:\n            return cgi.escape(c['htmlchars'])\n        if c['lineend']:\n            return '<br>'\n        elif c['space']:\n            t = m.group().replace('\\t', '&nbsp;'*tabstop)\n            t = t.replace(' ', '&nbsp;')\n            return t\n        elif c['space'] == '\\t':\n            return ' '*tabstop;\n        else:\n            url = m.group('protocal')\n            if url.startswith('['):\n                prefix = '['\n                suffix = ']'\n                url = url[1:]\n            else:\n                prefix = ''\n                suffix = ''\n            last = m.groups()[-1]\n            if last in ['\\n', '\\r', '\\r\\n']:\n                last = '<br>'\n            return '%s<a href=%s>%s</a>%s' % (prefix, url, url, suffix)\n    result = re.sub(re_string, do_sub, text)\n    result = result.replace(' ', '&nbsp;')\n    result = result.replace('\\t', '&nbsp;'*tabstop)\n\n    result = recolor('cyan', result)\n    result = recolor('#8E4429', result)\n    result = recolor('#0000B0', result)\n    result = recolor('#B63A11', result)\n    result = recolor('magenta', result)\n    result = recolor('green', result)\n\n    result = resinglecolor('green', result, 'Source')\n    result = resinglecolor('green', result, 'Output')\n\n    result = bold(result)\n    result = underline(result)\n    result = removebells(result)\n    result = removebackspaces(result)\n\n    result = removestdcolor(result)\n\n    return template % result\n\n\nif __name__ == '__main__':\n    import sys\n    with open(sys.argv[-1]) as f:\n        text = f.read()\n    print plaintext2html(text)\n",
  "line_no": 29,
  "line_no_percent": "25%"
}