{
  "instruction": "This code is a Python script that exports information about members of a crew in the game Grand Theft Auto V. To use it, you need to have Python installed and the Selenium module installed. You also need to provide login information for the Rockstar Social Club website if you want to see more detailed information about each member. To run the script, open a terminal or command prompt, navigate to the directory where the script is saved, and type \"python gtav_crew_exporter.py -c <crew_name>\" where <crew_name> is the name of the crew you want to export information for. You can also provide optional arguments to specify a username and password for the Rockstar Social Club website, an output file to save the information to, and a verbose flag to see more detailed output.",
  "buggy_code": "from selenium import selenium\nfrom selenium import webdriver\nimport sys, time, re, string, getopt\n\ndefault_crew = 'elotrolado'\nlogin_url = 'https://socialclub.rockstargames.com/profile/signin'\nbase_crew_url = 'http://socialclub.rockstargames.com/crew'\npath_gtav_base_url = '/games/gtav'\npath_gtav_overview_url = '/career/overview/gtaonline'\n\nusername = ''\npassword = ''\ncrew_name = ''\noutput_file = ''\nverbose_flag = ''\n\nclass crew_member:\n    def __init__(self):\n        return\n        self.id = ''\n        self.psn = ''\n        self.url = ''\n        self.level = ''\n        self.playtime = ''\n        self.country = ''\n        self.rank = ''\n        self.crew = ''\n        self.platform = ''\n        self.error = 'All ok.'\n\n\ndef print_help():\n    print 'gtav_crew_exporter.py -c <crew_name> [-u <username> -p <password>] [-o <output_file>] [-v]'\n\ndef arg_parser(argv):\n    global crew_name\n    global username\n    global password\n    global output_file\n    global verbose_flag\n    try:\n        opts, args = getopt.getopt(argv,\"hvu:p:c:o:\",[\"verbose\",\"username\",\"password\",\"crew=\",\"ofile=\"])\n    except getopt.GetoptError:\n        print_help()\n        debug(2)\n    for opt, arg in opts:\n        if opt == '-h':\n            print_help()\n            debug()\n        elif opt in (\"-c\", \"--crew\"):\n            crew_name = arg\n        elif opt in (\"-o\", \"--ofile\"):\n            output_file = arg\n            if not output_file: print_help()\n        elif opt in (\"-v\", \"--verbose\"):\n            verbose_flag = 1\n        elif opt in (\"-u\", \"--username\"):\n            username = arg\n            if not username: print_help()\n        elif opt in (\"-p\", \"--password\"):\n            password = arg\n            if not password: print_help()\n\n    if not crew_name:\n        crew_name = default_crew\n\n    return 0\n\ndef debug(msg):\n    global verbose_flag\n    if verbose_flag: print 'DBG : ' + msg\n\ndef WaitForElement(webdriver, path):\n    limit = 10   # waiting limit in seconds\n    inc = 1   # in seconds; sleep for 500ms\n    c = 0\n    while (c < limit):\n        try:\n            webdriver.find_element_by_xpath(path)\n            return 1        # Success\n        except:\n            time.sleep(inc)\n            c = c + inc \n \n    return 0   \n\ndef LoginSocialClub(driver):\n\n    if not username or not password:\n        print '!! Without login and password, only username and rank are available:'\n        return 1\n    \n    driver.get(login_url)\n        \n    path = '//*[@id=\"submitBtn\"]'\n    result = WaitForElement(driver, path)\n\n    if not result:              # interprets returned value\n        debug(\"\\nThe page is not loaded yet.\")\n    else:\n        debug('web - page fully loaded!')\n\n    path='//input[@id=\"login-field\"]'\n    driver.find_element_by_xpath(path).clear()\n    driver.find_element_by_xpath(path).send_keys(username)\n\n    path='//input[@id=\"password-field\"]'\n    driver.find_element_by_xpath(path).clear()\n    driver.find_element_by_xpath(path).send_keys(password)\n\n    path = '//*[@id=\"submitBtn\"]'\n    driver.find_element_by_xpath(path).click()\n\n    driver.get(login_url)\n        \n    path = '//*[@id=\"panelaccounts\"]'\n    result = WaitForElement(driver, path)\n\n    if not result:              # interprets returned value\n        debug(\"\\nThe page is not loaded yet.\")\n    else:\n        debug('web - page fully loaded!')\n\n    return 0\n\n\ndef GetMembersList(driver):\n\n    crew_url = base_crew_url + '/' + crew_name + '/hierarchy'\n    driver.get(crew_url)\n        \n    path = '//*[@id=\"muscleList\"]'\n    result = WaitForElement(driver, path)\n\n    if not result:              # interprets returned value\n        debug(\"\\nThe page is not loaded yet.\")\n    else:\n        debug('web - page fully loaded!')\n        \n\n    path = '//a[@data-ga=\"footer_selectlanguage_en\"]'\n    viewall = driver.find_element_by_xpath(path)\n\n    if not viewall:\n        debug(\"meh.\")\n    else:\n        debug(\"web - set page in english.\")\n\n    path = '//a[@class=\"viewAll\"]'\n    \n    try:\n        viewall = driver.find_element_by_xpath(path)\n        debug(\"web - unfold users.\")\n        viewall.click()\n    except:\n        debug(\"web - all users visible.\")\n\n    path = '//div[contains(@id, \"crewRank_\")]'\n    hierarchy = driver.find_elements_by_xpath(path)\n\n    crew_members = list()\n\n    for rank in hierarchy:\n\n        path = '//div[@id=\"' + rank.get_attribute('id') + '\"]//i[@class=\"icon-info\"]'\n        rank_name = rank.find_element_by_xpath(path).get_attribute('data-name')\n        \n\n        path = '//div[@id=\"' + rank.get_attribute('id') + '\"]//ul[@id=\"' + rank_name + 'List\"]//div[@class=\"member\"]//img'\n        members = rank.find_elements_by_xpath(path)\n\n        for member in members:\n            \n            cm = crew_member()\n            cm.id = member.get_attribute('data-original-title')\n            cm.url = member.find_element_by_xpath('..').get_attribute('href')\n            cm.rank = rank_name\n\n            crew_members.append(cm)\n\n    return crew_members\n\ndef GetMemberInfo(driver, member):\n\n    debug('[' + member.id + ']')\n    \n\n    retry = 0\n    max_retry = 5\n\n    for rety in range(max_retry): \n\n        driver.get(member.url)\n        \n        path = '//*[@id=\"cardInfoVitals\"]'\n        result = WaitForElement(driver, path)\n\n        if not result:              # interprets returned value\n            debug(\"web - The page is not loaded yet. [\" + str(retry) + \"]\")\n            retry += 1\n        else:\n            debug('web - page fully loaded! [' + str(retry) + ']')\n            break\n\n\n    try:\n        path = '//div[@id=\"no-profile\"]'\n        profail = driver.find_element_by_xpath(path) \n        debug('[' + member.id + '] Profile is private!')\n        member.error = 'Private profile.'\n        return 1        # Success\n\n    except: \n        path = '//div[@class=\"crew-info\"]/a'\n        member.crew = driver.find_element_by_xpath(path).get_attribute(\"href\").rsplit('/',1)[1]\n\n        debug('[' + member.id + '] main crew: ' + member.crew)\n\n        try:\n            path = '//div[@class=\"PSN\"]/h5'\n            member.psn = driver.find_element_by_xpath(path).text\n        except:\n            member.psn = ''\n\n        debug('[' + member.id + '] PSN ID: ' + member.psn)\n        \n        try:\n            path = '//div[@id=\"cardInfoFooter\"]//span[contains(@class,\"Country\")]'\n            member.country = driver.find_element_by_xpath(path).get_attribute(\"data-original-title\")\n        except:\n            member.country = ''\n\n        debug('[' + member.id + '] country: ' + member.country)\n    \n        driver.get(member.url + '/'+ path_gtav_base_url + '/ps3' + path_gtav_overview_url)\n    \n        path = '//div[@id=\"freemodeRank\"]'\n        result = WaitForElement(driver, path)\n        \n        if not result:              # interprets returned value\n            debug(\"\\nThe page is not loaded yet.\")\n        else:\n            debug('web - page fully loaded!')\n\n        try:\n            path = '//div[@id=\"freemodeRank\"]//h3'\n            member.level = driver.find_element_by_xpath(path).text\n        except:\n            member.level = ''\n\n        if member.level == 0:\n            member.platform = 'XBOX360'\n\n            driver.get(member.url + '/'+ path_gtav_base_url + '/xbox' + path_gtav_overview_url)\n    \n            path = '//div[@id=\"freemodeRank\"]'\n            result = WaitForElement(driver, path)\n        \n            if not result:              # interprets returned value\n                debug(\"\\nThe page is not loaded yet.\")\n            else:\n                debug('web - page fully loaded!')\n\n            try:\n                path = '//div[@id=\"freemodeRank\"]//h3'\n                member.level = driver.find_element_by_xpath(path).text\n            except:\n                member.level = ''\n\n        else:\n            member.platform = 'PS3'\n\n        debug('[' + member.id + '] rank: ' + member.rank)\n            \n        try:\n            path = '//div[@id=\"freemodeRank\"]//div[@class=\"rankBar\"]/h4'\n            member.playtime = driver.find_element_by_xpath(path).text.rsplit(':',1)[1]\n        except:\n            member.playtime = ''\n\n        debug('[' + member.id + '] playtime: ' + member.playtime)\n    \n        \n\n    return member \n\n\nif __name__ == \"__main__\":\n    arg_parser(sys.argv[1:])\n\n    debug('web - starting browser')\n    driver = webdriver.Firefox()\n\n    print 'Crew: ' + crew_name\n    \n    crew_members = GetMembersList(driver)\n    print 'Crew Size: ' + str(len(crew_members)) + ' members'\n\n    error = LoginSocialClub(driver)\n\n    if error:\n        print 'Crew Members :'\n        for cm in crew_members:\n            print cm.rank + \", \" + cm.id + \", \" + cm.url\n\n        debug('You need to provide login information to view each member info.')\n\n    for cm in crew_members:\n        cm = GetMemberInfo(driver, cm)\n\n    if output_file:\n        f = open(output_file,'w')\n        \n    for cm in crew_members:\n        member_csv = str(cm.id) + ', ' \\\n                    + str(cm.country) + ', ' \\\n                    + str(cm.psn) + ', ' \\\n                    + str(cm.platform) + ', ' \\\n                    + str(cm.crew) + ', ' \\\n                    + str(cm.rank) + ', ' \\\n                    + str(cm.level)  + ', ' \\\n                    + str(cm.playtime) + ', ' \\\n                    + str(cm.error)\n        if output_file:\n            f.write(member_csv + '\\n')\n        else:\n            print member_csv\n\n    if output_file:\n        print 'Output saved as ' + output_file + '.'\n        f.close() # you can omit in most cases as the destructor will call if\n      \n    driver.close()\n\n    sys.exit()\n",
  "line_no": 19,
  "line_no_percent": "6%"
}