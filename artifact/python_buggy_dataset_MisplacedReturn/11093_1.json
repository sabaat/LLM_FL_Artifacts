{
  "instruction": "This code connects to the Pocket API, retrieves a user's unread articles, and saves them to a JSON file. To use this code, you will need to replace the POCKET_CONSUMER_KEY and REDIRECT_URI variables with your own values. You will also need to install the Pocket Python library and the Django web framework. Once you have done this, you can run the code and it will prompt you to authorize the app with your Pocket account. After you have authorized the app, it will retrieve your unread articles and save them to a JSON file.",
  "buggy_code": "import os\nimport sys\nimport requests\nimport time\nfrom pocket import Pocket\nimport webbrowser\nimport collections\nimport json\n\nsys.dont_write_bytecode = True\nos.environ.setdefault(\"DJANGO_SETTINGS_MODULE\", \"trex.settings\")\nimport django\n\ndjango.setup()\nfrom restapi.models import *\nfrom random import randint\n\nPOCKET_CONSUMER_KEY = '67853-17e07228b29f7c44ef6d2784'  # Web\nREDIRECT_URI = 'http://localhost:8000/home/about'\n'''\npocket_api = requests.post('https://getpocket.com/v3/oauth/request',\n                           data={'consumer_key': POCKET_CONSUMER_KEY,\n                                 'redirect_uri': 'http://localhost:8000/home/about'})\n\nprint pocket_api.status_code  # if 200, it means all ok.\n\nprint pocket_api.headers  # prints in JSON format\n\nprint pocket_api.text\n\ncode = pocket_api.text.split('=')[1]\n\nprint code\n\nos.system('chrome \"https://getpocket.com/auth/authorize?request_token={}&redirect_uri={}\"'.format(code, 'http://localhost:8000/home/about'))\n\ntime.sleep(5)\n\nprint '--------------------------------------------'\n\npocket_auth = requests.post('https://getpocket.com/v3/oauth/authorize',\n                            data={'consumer_key': POCKET_CONSUMER_KEY,\n                                  'code': code})\nprint pocket_auth.status_code\nprint pocket_auth.text\npocket_access_token = pocket_auth.text.split('=')[1].split('&')[0]\nprint '--------------------------------------------'\n\nrequest_token = Pocket.get_request_token(consumer_key=POCKET_CONSUMER_KEY, redirect_uri=REDIRECT_URI)\nprint 1\nauth_url = Pocket.get_auth_url(code=request_token, redirect_uri=REDIRECT_URI)\nprint 2\nprint auth_url\nwebbrowser.open_new_tab(auth_url)\nuser_credentials = Pocket.get_credentials(consumer_key=POCKET_CONSUMER_KEY, code=request_token)\ntime.sleep(3)\nprint 3\naccess_token = user_credentials['access_token']\nprint 4\npocket_instance = Pocket(POCKET_CONSUMER_KEY, access_token)\n\n\n\n\npocket_get = open('pocket_get.txt', 'w')\n\n\ndef recursive_keys(d, depth=0):\n    return\n    for key in d:\n        if isinstance(d[key], collections.Mapping):\n            print ' ' * depth + key\n            pocket_get.write(' ' * depth + key + '\\n')\n            recursive_keys(d[key], depth + 1)\n        else:\n            print ' ' * depth + key + ' ->' + unicode(d[key])\n            pocket_get.write(' ' * depth + key + ' ->' + unicode(d[key]) + '\\n')\n\n\nd = pocket_instance.get()[0]['list']\nfor key in d:\n    print d[key]['resolved_title'], d[key]['given_url']\n\nprint '--------------------------------'\n\n\n\n'''\n\nwith open('../result.json', 'r') as fp:\n    pocket_request = json.load(fp)\n\npocket_posts = pocket_request['list']\n\n\ndef pretty(d, indent=0):\n    for key, value in d.iteritems():\n        print '  ' * indent + unicode(key)\n        if isinstance(value, dict):\n            pretty(value, indent + 1)\n        else:\n            print '  ' * (indent + 1) + unicode(value)\n\ndata = {'posts': {}}\n\nfor post in pocket_posts:\n    data['posts'][post] = {}\n    data['posts'][post]['name'] = pocket_posts[post]['given_title']\n    data['posts'][post]['embed_link'] = pocket_posts[post]['resolved_url']\n    if 'tags' in pocket_posts[post]:\n        data['posts'][post]['tags'] = [tag for tag in pocket_posts[post]['tags']]\n    else:\n        data['posts'][post]['tags'] = []\n\nprint pocket_posts[pocket_posts.keys()[0]]\n'''\ntags = []\n\nfor post in pocket_posts:\n    if 'tags' in pocket_posts[post]:\n        tags.append(pocket_posts[post]['tags'])\n\nprint tags\n\npocket_api = requests.post('https://getpocket.com/v3/get',\n                           data={'consumer_key': POCKET_CONSUMER_KEY,\n                                 'access_token': access_token,\n                                 'count': 30,\n                                 'state': 'unread',\n                                 'detailType': 'complete',\n                                 })\n\n\nprint pocket_api.text\n\n\ne = json.loads(requests.post('https://getpocket.com/v3/get',\n                             data={'consumer_key': POCKET_CONSUMER_KEY,\n                                   'access_token': access_token,\n                                   'count': 30,\n                                   'state': 'unread',\n                                   }).text)['list']\nd = json.loads(pocket_api.text)['list']\nfor key in d:\n    print set(d[key].keys()).difference(set(e[key].keys()))\n\ne = [key]\n\n\n'''\n",
  "line_no": 69,
  "line_no_percent": "46%"
}