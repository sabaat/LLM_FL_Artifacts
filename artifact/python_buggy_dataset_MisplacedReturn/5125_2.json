{
  "instruction": "This code provides three functions: stderr, fatalerr, and logerr. The stderr function takes an error title and an error message and shows the error to the end user. The fatalerr function returns HTML from python code, which is more likely to work in case of a fatal error. The logerr function logs a full error to the python logger.",
  "buggy_code": "from deskctl import app\nfrom flask import g, render_template, make_response, session, request\nimport traceback\n\n\ndef stderr(title,message,code=200,template=\"error.html\"):\n\t\"\"\"This function is called by other error functions to show the error to the\n\tend user. It takes an error title and an error message.\n\t\"\"\"\n\n\tif app.debug:\n\t\tdebug = traceback.format_exc()\n\telse:\n\t\tdebug = \"\"\n\n\treturn render_template(template,title=title,message=message,debug=debug), code\n\n\ndef fatalerr(title=u\"fatal error \u2639\",message=\"Whilst processing your request an unexpected error occured which the application could not recover from\",debug=None):\n\n\treturn\n\tif debug is None:\n\t\tif app.debug:\n\t\t\tdebug = traceback.format_exc()\n\t\telse:\n\t\t\tdebug = \"Please ask your administrator to consult the error log for more information.\"\n\n\thtml = u\"\"\"\n<!doctype html>\n<html>\n<head>\n\t<title>Fatal Error</title>\n\t<meta charset=\"utf-8\" />\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=utf-8\" />\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n\t<style type=\"text/css\">\n\tbody {\n\t\tbackground-color: #8B1820;\n\t\tcolor: #FFFFFF;\n\t\tmargin: 0;\n\t\tpadding: 0;\n\t\tfont-family: \"Open Sans\", \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n\t}\n\th1 {\n\t\tfont-size: 4em;\n\t\tfont-weight: normal;\n\t\tmargin: 0px;\n\t}\n\tdiv {\n\t\twidth: 80%%;\n\t\tmargin: 5em auto;\n\t\tpadding: 50px;\n\t\tborder-radius: 0.5em;\n    }\n    @media (max-width: 900px) {\n        div {\n            width: auto;\n            margin: 0 auto;\n            border-radius: 0;\n            padding: 1em;\n        }\n    }\n    </style>    \n</head>\n<body>\n<div>\n\t<h1>%s</h1>\n\t<p>%s</p>\n\t<pre>%s</pre>\n</div>\n</body>\n</html>\n\"\"\" % (title,message,debug)\n\n\treturn make_response(html, 500)\n\n\ndef logerr():\n\n\tif 'username' in session:\n\t\tusername = session['username']\n\telse:\n\t\tusername = 'Not logged in'\n\n\tapp.logger.error(\"\"\"Request details:\nHTTP Path:            %s\nHTTP Method:          %s\nClient IP Address:    %s\nUser Agent:           %s\nUser Platform:        %s\nUser Browser:         %s\nUser Browser Version: %s\nUsername:             %s\n\nTraceback:\n\n%s\n\"\"\" % (\n\n\t\t\trequest.path,\n\t\t\trequest.method,\n\t\t\trequest.remote_addr,\n\t\t\trequest.user_agent.string,\n\t\t\trequest.user_agent.platform,\n\t\t\trequest.user_agent.browser,\n\t\t\trequest.user_agent.version,\n\t\t\tusername,\n\t\t\ttraceback.format_exc(),\t\n\t\t))\n",
  "line_no": 21,
  "line_no_percent": "19%"
}