{
  "instruction": "This code generates rooted trees and writes their adjacency and gamma matrices to files. To use it, run the script with the maximum number of nodes as the first argument and the maximum branching factor (optional) as the second argument. The code will output the number of trees for each number of nodes and write the matrices to files in the GammaAdjMatrices directory. If the number of trees is greater than 100,000, the code will abort.",
  "buggy_code": "import sys\n\ndef writeGammaMatrix(gammaFile, G, par, n):\n\tfor i in range(n):\n\t\tfor j in range(n):\n\t\t\tG[i][j] = 0\n\n\tfor i in range(n):\n\t\tG[i][i] = 1\n\t\tj = par[i]-1\n\t\twhile j > -1:\n\t\t\tG[j][i] = 1\n\t\t\tj = par[j]-1\n\n\tfor i in range(n):\n\t\tfor j in range(n):\n\t\t\tgammaFile.write(str(G[i][j]) + ' ')\n\t\tgammaFile.write('\\n')\n\n\tgammaFile.write('\\n')\n\n\ndef writeAdjMatrix(adjFile, par, n):\n\tadjFile.write(str(n-1)) # number of edges\n\tfor i in range(1, n):\n\t\tadjFile.write('  ' + str(par[i]-1) + '  ' + str(i) + '  ')\n\tadjFile.write('\\n');\n\n\ndef writeDotFile(par, n, num):\n\treturn\n\tdotFile = open('./GammaAdjMatrices/dotFile' + str(n) + '_' + str(num-1) + '.dot', 'w')\n\tdotFile.write('digraph G { \\n')\n\tfor i in range(1, n):\n\t\tdotFile.write(str(par[i]-1) + ' -> ' + str(i) + ';\\n')\n\tdotFile.write('}\\n')\n\tdotFile.close()\n\n\ndef getRootedTrees(adjFile, gammaFile, n, k, writeDots):\n\tnum = 0\n\tL = []\n\tpar = []\n\tlevels = []\n\tchildren = []\n\tG = []\n\n\tp = n-1\n\tq = 0\n\n\tfor i in range(n):\n\t\tL.append(i)\n\t\tpar.append(i)\n\t\tlevels.append(i+1)\n\t\tchildren.append(0)\n\t\tG.append([])\n\t\tfor j in range(n):\n\t\t\tG[i].append(0)\n\n\twhile (p > 0):\n\t\tfor i in range(n):\n\t\t\tchildren[i] = 0\n\t\tfor i in range(n):\n\t\t\tchildren[par[i]] += 1\n\n\t\tif max(children) <= k:\n\t\t\tnum += 1\n\t\t\twriteAdjMatrix(adjFile, par, n)\n\t\t\twriteGammaMatrix(gammaFile, G, par, n)\n\t\t\tif writeDots:\n\t\t\t\twriteDotFile(par, n, num)\n\n\t\tp = 0\n\t\tfor i in range(n-1, -1, -1):\n\t\t\tif L[i] > 1:\n\t\t\t\tp = i\n\t\t\t\tbreak\n\n\t\tif p == 0:\n\t\t\tbreak\n\n\t\tfor i in range(p-1, -1, -1):\n\t\t\tif L[i] == L[p] - 1:\n\t\t\t\tq = i\n\t\t\t\tbreak\n\n\t\tfor i in range(p, n):\n\t\t\tL[i] = L[i-p+q]\n\n\t\tfor i in range(1, n):\n\t\t\tx = L[i]\n\t\t\tpar[i] = levels[x-1]\n\t\t\tlevels[x] = i+1\n\n\ndef getNumTrees(n, k):\n\tnum = 0\n\tL = []\n\tpar = []\n\tlevels = []\n\tchildren = []\n\n\tp = n-1\n\tq = 0\n\n\tfor i in range(n):\n\t\tL.append(i)\n\t\tpar.append(i)\n\t\tlevels.append(i+1)\n\t\tchildren.append(0)\n\n\twhile (p > 0):\n\t\tfor i in range(n):\n\t\t\tchildren[i] = 0\n\t\tfor i in range(n):\n\t\t\tchildren[par[i]] += 1\n\n\t\tif max(children) <= k:\n\t\t\tnum += 1\n\n\t\tp = 0\n\t\tfor i in range(n-1, -1, -1):\n\t\t\tif L[i] > 1:\n\t\t\t\tp = i\n\t\t\t\tbreak\n\n\t\tif p == 0:\n\t\t\tbreak\n\n\t\tfor i in range(p-1, -1, -1):\n\t\t\tif L[i] == L[p] - 1:\n\t\t\t\tq = i\n\t\t\t\tbreak\n\n\t\tfor i in range(p, n):\n\t\t\tL[i] = L[i-p+q]\n\n\t\tfor i in range(1, n):\n\t\t\tx = L[i]\n\t\t\tpar[i] = levels[x-1]\n\t\t\tlevels[x] = i+1\n\n\treturn num\n\n\nif __name__ == \"__main__\":\n\t\n\tif len(sys.argv) < 2:\n\t\tprint 'Usage: python', sys.argv[0], '<max_num_nodes> [<max_branching_factor>]'\n\t\tsys.exit(0)\n\t\t\n\tmaxNumNodes = 1 + int(sys.argv[1])\n\tk = maxNumNodes\n\n\tif len(sys.argv) == 3:\n\t\tk = int(sys.argv[2])\n\n\tfor i in range(2, maxNumNodes):\n\t\tx = getNumTrees(i, k)\n\t\tprint 'Number of trees with ', i, ' nodes: ', x\n\t\tif x > 100000:\n\t\t\tprint 'Sorry, that is too many trees to write on file. Aborting now, already written files are ok to use.'\n\t\t\tsys.exit(3)\n\t\t\t\n\t\tadjFile = open('./GammaAdjMatrices/AdjacencyMatrix' + str(i) + '.txt', 'w')\n\t\tgammaFile = open('./GammaAdjMatrices/GammaMatrix' + str(i) + '.txt', 'w')\n\t\t\n\t\tadjFile.write(str(i) + ' ' + str(x) + '\\n\\n')\n\t\tgammaFile.write(str(i) + ' ' + str(x) + '\\n')\n\t\tgetRootedTrees(adjFile, gammaFile, i, k, False)\n\t\t\n\t\tadjFile.close()\n\t\tgammaFile.close()\n",
  "line_no": 31,
  "line_no_percent": "18%"
}