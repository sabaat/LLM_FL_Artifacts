{
  "instruction": "To load npy xy, plot and save, run the main() function in the given code. The code will generate a plot of domain averaged rainfall for land, sea, and total, with data from different experiments and TRMM. The plot will be saved in the directory '/nfs/a90/eepdw/Figures/EMBRACE/Diurnal/'.",
  "buggy_code": "\"\"\"\n\nLoad npy xy, plot and save\n\n\n\"\"\"\n\nimport os, sys\n\nimport matplotlib\n\nmatplotlib.use('Agg') # Must be before importing matplotlib.pyplot or pylab!\n\nimport matplotlib.pyplot as plt\nimport matplotlib.cm as mpl_cm\n\nfrom matplotlib import rc\nfrom matplotlib.font_manager import FontProperties\nfrom matplotlib import rcParams\nfrom matplotlib import cm\n\nrc('text', usetex=True)\n\nrcParams['text.usetex']=True\nrcParams['text.latex.unicode']=True\n\nrc('font', family = 'serif', serif = 'cmr10')\n\nimport numpy as np\n\nfrom datetime import timedelta\nimport datetime\n\nimport imp\n\nimport re\nfrom textwrap import wrap\n\nmodel_name_convert_legend = imp.load_source('util', '/nfs/see-fs-01_users/eepdw/python_scripts/modules/model_name_convert_legend.py')\n\n\ntop_dir='/nfs/a90/eepdw/Data/Rain_Land_Sea_Diurnal'\n\npp_file = 'avg.5216'\n\nlon_max = 71\nlon_min = 67\nlat_max= 28\nlat_min=20\n\ntrmm_dir = '/nfs/a90/eepdw/Data/Observations/Satellite/TRMM/Diurnal/'\ntrmm_file = \"trmm_diurnal_average_lat_%s_%s_lon_%s_%s_bit_above_western_ghats.npz\" % (lat_min,lat_max, lon_min, lon_max)\n\n\n\nd = matplotlib.dates.drange(datetime.datetime(2011, 8, 21, 6,30), datetime.datetime(2011, 8, 22, 6, 30), timedelta(hours=1))\n\nformatter = matplotlib.dates.DateFormatter('%H:%M')\n\ndef main():\n return\n experiment_ids_p = ['djznw', 'djzny', 'djznq', 'dklzq', 'dkmbq', 'dkjxq' ] # Most of Params\n experiment_ids_e = ['dklwu', 'dklyu', 'djzns', 'dkbhu', 'djznu', 'dkhgu'] # Most of Explicit\n\n\n NUM_COLOURS = 15\n cmap=cm.get_cmap(cm.Set1, NUM_COLOURS)\n\n for ls in ['land','sea', 'total']:\n  fig = plt.figure(figsize=(12,6))\n  ax = fig.add_subplot(111)\n  legendEntries=[]\n  legendtext=[]\n\n  plot_trmm = np.load('%s%s_%s' % (trmm_dir, ls, trmm_file))\n \n  dates_trmm=[]\n  p=[]\n  for dp in plot_trmm['hour']:\n      print dp\n      if ((int(dp)<23) & (int(dp)>=6)):\n          dates_trmm.append(datetime.datetime(2011, 8, 21, int(dp), 0))\n          p.append(plot_trmm['mean'][plot_trmm['hour']==dp])\n      if ((int(dp)>=0) & (int(dp)<=6)):\n          dates_trmm.append(datetime.datetime(2011, 8, 22, int(dp), 0))\n          p.append(plot_trmm['mean'][plot_trmm['hour']==dp])\n              \n  a = np.argsort(dates_trmm,axis=0)\n\n  d_trmm = np.array(dates_trmm)[a]\n  pl = (np.array(p)[a])\n  \n  l, = plt.plot_date(d_trmm, pl, label='TRMM', linewidth=2, linestyle='-', marker='', markersize=2, fmt='', color='#262626')\n\n  legendEntries.append(l)\n  legendtext.append('TRMM')\n\n  \n  l0=plt.legend(legendEntries, legendtext,title='', frameon=False, prop={'size':8}, loc=9, bbox_to_anchor=(0.21, 0,1, 1))\n \n  texts = l0.texts\n  for t in texts:\n    t.set_color('#262626')\n\n  legendEntries=[]\n  legendtext=[] \n\n       \n\n  for c, experiment_id in enumerate(experiment_ids_p):\n\n   expmin1 = experiment_id[:-1]\n  \n\n   if (experiment_id=='djznw'):\n          print experiment_id\n          colour = cmap(1.*1/NUM_COLOURS)\n          linewidth=0.2\n          linestylez='--'\n   if (experiment_id=='djzny'):\n          print experiment_id\n          colour = cmap(1.*3/NUM_COLOURS)\n          linewidth=0.5\n          linestylez='--'\n   if ((experiment_id=='djznq') or (experiment_id=='dkjxq')):\n          print experiment_id\n          colour = cmap(1.*5/NUM_COLOURS)\n          linewidth=0.8\n          if (experiment_id=='djznq'):\n              linestylez='--'\n          if (experiment_id=='dkjxq'):\n              linestylez=':'\n              \n   if ((experiment_id=='dklzq') or (experiment_id=='dklwu')):\n          print experiment_id\n          colour = cmap(1.*7/NUM_COLOURS)\n          linewidth=1\n          if (experiment_id=='dklzq'):\n              linestylez='--'\n          if (experiment_id=='dklwu'):\n              linestylez='-'\n   if ((experiment_id=='dklyu') or (experiment_id=='dkmbq')):\n          print experiment_id\n          colour = cmap(1.*9/NUM_COLOURS)\n          linewidth=1.3\n          if (experiment_id=='dkmbq'):\n              linestylez='--'\n          if (experiment_id=='dklyu'):\n              linestylez='-'\n   if (experiment_id=='djzns'):\n          print experiment_id\n          colour = cmap(1.*11/NUM_COLOURS)\n          linewidth=1.6\n          linestylez='-'\n   if ((experiment_id=='dkbhu')or (experiment_id=='dkhgu')):\n          print experiment_id\n          colour = cmap(1.*13/NUM_COLOURS)\n          linewidth=1.9\n          if (experiment_id=='dkbhu'):\n              linestylez='-'\n          if (experiment_id=='dkhgu'):\n              linestylez=':'\n   if (experiment_id=='djznu'):\n          print experiment_id\n          colour = cmap(1.*15/NUM_COLOURS)\n          linewidth=2.\n          linestylez='-'\n   try:\n      plotnp = np.load('%s/%s/%s/%s_%s_rainfall_diurnal_np_domain_constrain_lat_%s-%s_lon-%s-%s.npy' % (top_dir, expmin1, experiment_id, pp_file, ls, lat_min, lat_max, lon_min, lon_max))\n   \n      l, = plt.plot_date(d, plotnp[0]*3600, label='%s' % (model_name_convert_legend.main(experiment_id)), linewidth=linewidth, linestyle=linestylez, marker='', markersize=2, fmt='', color=colour)\n      legendEntries.append(l)\n      legendtext.append('%s' % (model_name_convert_legend.main(experiment_id)))\n  \n\n   except Exception, e:\n      print e\n      pass\n\n  l1=plt.legend(legendEntries, legendtext, title='Parametrised', loc=9, frameon=False, prop={'size':8}, bbox_to_anchor=(0, 0,1, 1))\n\n  texts = l1.texts\n  for t in texts:\n    t.set_color('#262626')\n\n  legendEntries=[]\n  legendtext=[]\n \n  c1=0\n  for c, experiment_id in enumerate(experiment_ids_e):\n\n\n   if (experiment_id=='djznw'):\n          print experiment_id\n          colour = cmap(1.*1/NUM_COLOURS)\n          linewidth=0.2\n          linestylez='--'\n   if (experiment_id=='djzny'):\n          print experiment_id\n          colour = cmap(1.*3/NUM_COLOURS)\n          linewidth=0.5\n          linestylez='--'\n   if ((experiment_id=='djznq') or (experiment_id=='dkjxq')):\n          print experiment_id\n          colour = cmap(1.*5/NUM_COLOURS)\n          linewidth=0.8\n          if (experiment_id=='djznq'):\n              linestylez='--'\n          if (experiment_id=='dkjxq'):\n              linestylez=':'\n              \n   if ((experiment_id=='dklzq') or (experiment_id=='dklwu')):\n          print experiment_id\n          colour = cmap(1.*7/NUM_COLOURS)\n          linewidth=1\n          if (experiment_id=='dklzq'):\n              linestylez='--'\n          if (experiment_id=='dklwu'):\n              linestylez='-'\n   if ((experiment_id=='dklyu') or (experiment_id=='dkmbq')):\n          print experiment_id\n          colour = cmap(1.*9/NUM_COLOURS)\n          linewidth=1.3\n          if (experiment_id=='dkmbq'):\n              linestylez='--'\n          if (experiment_id=='dklyu'):\n              linestylez='-'\n   if (experiment_id=='djzns'):\n          print experiment_id\n          colour = cmap(1.*11/NUM_COLOURS)\n          linewidth=1.6\n          linestylez='-'\n   if ((experiment_id=='dkbhu')or (experiment_id=='dkhgu')):\n          print experiment_id\n          colour = cmap(1.*13/NUM_COLOURS)\n          linewidth=1.9\n          if (experiment_id=='dkbhu'):\n              linestylez='-'\n          if (experiment_id=='dkhgu'):\n              linestylez=':'\n   if (experiment_id=='djznu'):\n          print experiment_id\n          colour = cmap(1.*15/NUM_COLOURS)\n          linewidth=2.\n          linestylez='-'\n\n\n   expmin1 = experiment_id[:-1]\n\n   try:\n      plotnp = np.load('%s/%s/%s/%s_%s_rainfall_diurnal_np_domain_constrain_lat_%s-%s_lon-%s-%s.npy' % (top_dir, expmin1, experiment_id, pp_file, ls, lat_min, lat_max, lon_min, lon_max))\n   \n      l, = plt.plot_date(d, plotnp[0]*3600, label='%s' % (model_name_convert_legend.main(experiment_id)), linewidth=linewidth, linestyle=linestylez, marker='', markersize=2, fmt='', color=colour)\n\n      legendEntries.append(l)\n      legendtext.append('%s' % (model_name_convert_legend.main(experiment_id)))\n\n   except Exception, e:\n      print e\n      pass\n\n  l2=plt.legend(legendEntries, legendtext, title='Explicit', loc=9, frameon=False, bbox_to_anchor=(0.11, 0,1, 1), prop={'size':8})\n  plt.gca().add_artist(l1)\n  plt.gca().add_artist(l0)\n  plt.gca().xaxis.set_major_formatter(formatter)\n\n  texts = l2.texts\n  for t in texts:\n    t.set_color('#262626')\n\n  plt.xlabel('Time (UTC)')\n  plt.ylabel('mm/h')\n\n  title=\"Domain Averaged Rainfall - %s\" % ls\n\n  t=re.sub('(.{68} )', '\\\\1\\n', str(title), 0, re.DOTALL)\n  t = re.sub(r'[(\\']', ' ', t)\n  t = re.sub(r'[\\',)]', ' ', t)\n  \n  pp_filenodot= pp_file.replace(\".\", \"\")\n\n  spines_to_keep = ['bottom', 'left']\n  for spine in spines_to_keep:\n    ax.spines[spine].set_linewidth(0.5)\n    ax.spines[spine].set_color('#262626')\n  spines_to_remove = ['top', 'right']\n  for spine in spines_to_remove:\n      ax.spines[spine].set_visible(False)\n  ax.xaxis.set_ticks_position('none')\n  ax.yaxis.set_ticks_position('none')\n\n  ax.xaxis.label.set_color('#262626')\n  ax.yaxis.label.set_color('#262626')\n\n\n  if not os.path.exists('/nfs/a90/eepdw/Figures/EMBRACE/Diurnal/'): os.makedirs('/nfs/a90/eepdw/Figures/EMBRACE/Diurnal/')\n  plt.savefig('/nfs/a90/eepdw/Figures/EMBRACE/Diurnal/%s_%s_latlon_bit_above_western_ghats_notitle.png' % (pp_filenodot, ls), format='png', bbox_inches='tight')\n\n  plt.title('\\n'.join(wrap('%s' % (t.title()), 1000,replace_whitespace=False)), fontsize=16, color='#262626')\n  \n  plt.savefig('/nfs/a90/eepdw/Figures/EMBRACE/Diurnal/%s_%s_latlon_bit_above_western_ghats.png' % (pp_filenodot, ls), format='png', bbox_inches='tight')\n  plt.close()\n\n\nif __name__ == '__main__':\n   main()\n",
  "line_no": 61,
  "line_no_percent": "20%"
}