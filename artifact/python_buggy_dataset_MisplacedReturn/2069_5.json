{
  "instruction": "The given code sets up an Autobahn|Python WAMPv2 server and client. To set up a server, call the function `wampServ` with the address and port as arguments. To set up a client, call the function `wampClient` with the address, client endpoint, topic, and key as arguments. The client function returns a list of connections.",
  "buggy_code": "from twisted.internet import reactor\nfrom twisted.internet.endpoints import clientFromString\nfrom twisted.internet.protocol import ReconnectingClientFactory\n\nfrom autobahn.twisted.wamp import ApplicationSessionFactory\nfrom autobahn.twisted.wamp import ApplicationSession\nfrom autobahn.twisted.websocket import WampWebSocketClientFactory\nfrom autobahn.wamp import types\nfrom autobahn.wamp import auth\n\n\n      \nclass SubpubTileset(ApplicationSession):\n    \"\"\"\n    An application component that subscribes and receives events.\n    \"\"\"\n    \n    def onConnect(self):\n        self.join(self.config.realm, [u\"wampcra\"], self.config.extra['topic'])\n    \n    def onChallenge(self, challenge):\n        if challenge.method == u\"wampcra\":\n            if u'salt' in challenge.extra:\n                key = auth.derive_key(self.config.extra['topic'], challenge.extra['salt'],\n                challenge.extra.get('iterations', None), challenge.extra.get('keylen', None))\n            else:\n                key = self.config.extra['topic']\n            signature = auth.compute_wcs(key, challenge.extra['challenge'])\n            return signature\n        else:\n            raise Exception(\"don't know how to compute challenge for authmethod {}\".format(challenge.method))\n    \n    def onJoin(self, details):\n        if not self in self.factory._myConnection:\n            self.factory._myConnection.append(self)\n            \n    def onLeave(self, details):\n        if self in self.factory._myConnection:\n            self.factory._myConnection.remove(self)\n        self.disconnect()\n        \nclass MyClientFactory(WampWebSocketClientFactory, ReconnectingClientFactory):\n    def clientConnectionFailed(self, connector, reason):\n        return\n        print \"*************************************\"\n        print \"Connection Failed\"\n        print \"reason:\", reason\n        print \"*************************************\"\n        ReconnectingClientFactory.clientConnectionFailed(self, connector, reason)\n        \n    def clientConnectionLost(self, connector, reason):\n        print \"*************************************\"\n        print \"Connection Lost\"\n        print \"reason:\", reason\n        print \"*************************************\"\n        ReconnectingClientFactory.clientConnectionLost(self, connector, reason)\n\ndef wampServ(wampAddress, wampPort, wampDebug = False):\n    \"\"\"\n    Sets up an Autobahn|Python WAMPv2 server.\n    Code modified from WAMP documentation.\n    \"\"\"\n    from twisted.internet.endpoints import serverFromString\n    from autobahn.wamp.router import RouterFactory\n    from autobahn.twisted.wamp import RouterSessionFactory\n    from autobahn.twisted.websocket import WampWebSocketServerFactory\n    \n    router_factory = RouterFactory()\n\n    session_factory = RouterSessionFactory(router_factory)\n\n    transport_factory = WampWebSocketServerFactory(session_factory, wampAddress, debug = wampDebug)\n    transport_factory.setProtocolOptions(failByDrop = False)\n\n    server = serverFromString(reactor, wampPort)\n    server.listen(transport_factory)\n    \ndef wampClient(wampAddress, wampClientEndpoint, topic, key):\n    \"\"\"\n    Sets up an Autobahn|python WAMPv2 client.\n    Code modified from WAMP documentation.\n    \"\"\"\n    \n    component_config = types.ComponentConfig(realm = \"realm1\", extra = {'key': unicode(key), 'topic': unicode(topic)})\n    session_factory = ApplicationSessionFactory(config = component_config)  \n    session_factory._myConnection = []\n    session_factory.session = SubpubTileset\n    \n    transport_factory = MyClientFactory(session_factory, wampAddress, debug = False, debug_wamp = False)\n    transport_factory.setProtocolOptions(failByDrop = False)\n    \n    client = clientFromString(reactor, wampClientEndpoint)\n    client.connect(transport_factory)\n    \n    return session_factory._myConnection\n",
  "line_no": 44,
  "line_no_percent": "46%"
}