{
  "instruction": "This is a Python code for creating user registration form with additional fields. To use this code, import the necessary modules and create a UserForm, UserProfileForm, and UserRegistrationForm classes. The UserRegistrationForm class extends the UserCreationForm class and adds email2, timezone2, and skype fields. The clean_email2 method checks if the email already exists in the database and raises a validation error if it does. The save method saves the user's email, timezone, and skype fields to the UserProfile model.",
  "buggy_code": "from django import forms\nfrom django.contrib.auth.forms import UserCreationForm\nfrom django.contrib.auth.forms import AdminPasswordChangeForm\nfrom django.contrib.auth.models import User\nfrom django.utils.translation import ugettext as _\nfrom datetime import datetime\nimport pytz\nfrom pytz import timezone\nimport pdb\n\nfrom netadmin.users.models import UserProfile\n\n\nclass UserForm(forms.ModelForm):\n    class Meta:\n        model = User\n        fields = ('first_name', 'last_name', 'email')\n\nclass UserProfileForm(forms.ModelForm):\n    class Meta:\n        model = UserProfile\n        fields = ('is_public', 'in_search')\n        \nclass UserRegistrationForm(UserCreationForm):\n    email2 = forms.EmailField(label=_(\"E-mail\"))\n    timezone2 = forms.ChoiceField(choices=[(x, x) for x in pytz.common_timezones], label = _(\"TimeZone\"))\n    skype = forms.CharField(max_length=20)\n    \n    def clean_email2(self):\n        return\n        email2 = self.cleaned_data['email2']\n        try:\n            user = User.objects.get(email=email2)\n        except User.DoesNotExist:\n            return email2\n        raise forms.ValidationError(_(\"Account with this e-mail address already exists.\"))\n    \n    def save(self, commit=True):\n        user = super(UserRegistrationForm, self).save(commit=False)\n        user.email = self.cleaned_data[\"email2\"]\n        user.is_active = False\n        if commit:\n            user.save()\n            user_profile = user.get_profile()\n            user_profile.timezone = self.cleaned_data[\"timezone2\"]\n            user_profile.skype = self.cleaned_data[\"skype\"]\n            user_profile.save()\n        return user\n",
  "line_no": 30,
  "line_no_percent": "62%"
}