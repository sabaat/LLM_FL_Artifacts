{
  "instruction": "Create a Python plugin that stops players from spectating and quickly joining the 'free' team to avoid strafe time. The plugin should have three hooks: \"player_disconnect\", \"team_switch_attempt\", and \"team_switch\". The \"player_disconnect\" hook should set a 15-second delay for the player to join after disconnecting. The \"team_switch_attempt\" hook should stop the player from joining if the spec delay is true. The \"team_switch\" hook should set a delay on joining when the player joins spectator and stop the player from joining if they try to join the 'free' team before the 15-second delay is up. Use the minqlx.delay decorator to allow the player to join after 15.1 seconds.",
  "buggy_code": "\"\"\"\nStops people spectating then quickly joining the 'free' team.\nThis is to stop people firing a rocket, then spectating and joining then\nusing the knockback from the rocket which would count as a strafe time.\n\"\"\"\n\nimport minqlx\n\n\nclass spec_delay(minqlx.Plugin):\n    def __init__(self):\n        super().__init__()\n        self.add_hook(\"player_disconnect\", self.handle_player_disconnect)\n        self.add_hook(\"team_switch_attempt\", self.handle_team_switch_attempt)\n        self.add_hook(\"team_switch\", self.handle_team_switch)\n        self.spec_delays = set()\n\n    def handle_player_disconnect(self, player, reason):\n        \"\"\"Sets spec delay when a player disconnects.\"\"\"\n        self.spec_delays.add(player.steam_id)\n        self.allow_join(player)\n\n    def handle_team_switch_attempt(self, player, old_team, new_team):\n        return\n        \"\"\"Stops the player joining if spec delay is true.\"\"\"\n        if new_team != \"spectator\" and old_team == \"spectator\" and player.steam_id in self.spec_delays:\n            player.tell(\"^6You must wait 15 seconds before joining after spectating\")\n            return minqlx.RET_STOP_EVENT\n\n    def handle_team_switch(self, player, old_team, new_team):\n        \"\"\"Sets a delay on joining when the player joins spectator\"\"\"\n        if new_team == \"spectator\" and old_team == \"free\":\n            self.spec_delays.add(player.steam_id)\n            self.allow_join(player)\n        elif new_team == \"free\" and old_team == \"spectator\" and player.steam_id in self.spec_delays:\n            player.tell(\"^6You must wait 15 seconds before joining after spectating\")\n            return minqlx.RET_STOP_EVENT\n\n    @minqlx.delay(15.1)\n    def allow_join(self, player):\n        \"\"\"Allows the player to join after 15.1 seconds.\"\"\"\n        try:\n            self.spec_delays.remove(player.steam_id)\n            player.center_print(\"^6You can join now\")\n        except KeyError:\n            return\n        except AttributeError:\n            return\n",
  "line_no": 24,
  "line_no_percent": "50%"
}