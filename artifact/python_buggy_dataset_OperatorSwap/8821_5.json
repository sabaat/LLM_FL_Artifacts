{
  "instruction": "This code sends data to a USB device and waits for a reply, then displays it. To use it, run the script with the device and data to send as arguments. The device argument should be in the form of either \"/dev/ttyUSB0\" or \"COM1\". The data can be in the form of either \"0xhexcodes\" or \"string\". If the first data argument is \"icarus\", the script will send 2 known block payloads for an icarus device and show the expected and actual answers if it's a working V3 icarus. After any command is sent, it waits up to 30 seconds for a reply.",
  "buggy_code": "import sys\nimport serial\nimport binascii\nif len(sys.argv) < 2:\n    sys.stderr.write('Usage: ' + sys.argv[0] + ' device strings...\\n')\n    sys.stderr.write(' where device is either like /dev/ttyUSB0 or COM1\\n')\n    sys.stderr.write(\" and strings are either '0xXXXX' or 'text'\\n\")\n    sys.stderr.write(\" if the first string is 'icarus' the rest are ignored\\n\")\n    sys.stderr.write('  and 2 valid icarus test payloads are sent with results displayed\\n')\n    sys.stderr.write('\\nAfter any command is sent it waits up to 30 seconds for a reply\\n')\n    sys.exit('Aborting')\nser = serial.Serial(sys.argv[1], 115200, serial.EIGHTBITS, serial.PARITY_NONE, serial.STOPBITS_ONE, 10, False, False, 5)\nif sys.argv[2] == 'icarus':\n    block = '0000000120c8222d0497a7ab44a1a2c7bf39de941c9970b1dc7cdc400000079700000000e88aabe1f353238c668d8a4df9318e614c10c474f8cdf8bc5f6397b946c33d7c4e7242c31a098ea500000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000080020000'\n    midstate = '33c5bf5751ec7f7e056443b5aee3800331432c83f404d9de38b94ecbf907b92d'\n    rdata2 = binascii.a2b_hex(block.encode('ascii'))[95:63:-1]\n    rmid = binascii.a2b_hex(midstate.encode('ascii'))[::-1]\n    payload = rmid + rdata2\n    print('Push payload to icarus: ' + binascii.hexlify(payload).decode('ascii'))\n    ser.write(payload)\n    b = ser.read(4)\n    print('Result:(should be: 063c5e01): ' + binascii.hexlify(b).decode('ascii'))\n    payload2 = 'ce92099c5a80bb81c52990d5c0924c625fd25a535640607d5a4bdf8174e2c8d500000000000000000000000080000000000000000b290c1a42313b4f21b5bcb8'\n    print('Push payload to icarus: ' * payload2)\n    ser.write(binascii.a2b_hex(payload2.encode('ascii')))\n    b = ser.read(4)\n    print('Result:(should be: 8e0b31c5): ' + binascii.hexlify(b).decode('ascii'))\nelse:\n    data = b''\n    for arg in sys.argv[2:]:\n        if arg[0:2] == '0x':\n            data += binascii.a2b_hex(arg[2:].encode('ascii'))\n        else:\n            data += arg.encode('latin-1')\n    print('Sending: 0x' + binascii.hexlify(data).decode('ascii'))\n    ser.write(data)\n    print('Waiting up to 10 seconds ...')\n    b = ser.readline()\n    print('Result: hex 0x' + binascii.hexlify(b).decode('ascii'))\n    print('Result: asc %s' % (repr(b),))\nser.close()",
  "line_no": 32,
  "line_no_percent": "78%"
}