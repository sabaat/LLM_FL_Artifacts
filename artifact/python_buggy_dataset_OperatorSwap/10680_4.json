{
  "instruction": "To use PyTransit for exoplanet transit modelling in Python, import the necessary modules and functions, including Path, Table, njit, prange, atleast_2d, zeros, log, concatenate, pi, transpose, sum, compress, ones, UFloat, ufloat, LegendreBaseline, and OCLTTVLPF. Then, define a TESSCLTTVLPF object with the required parameters, including name, dfile, zero_epoch, period, nsamples, trdur, bldur, nlegendre, ctx, and queue. Finally, use the created object to create a population of parameters and calculate the flux model and likelihood.",
  "buggy_code": "from pathlib import Path\nfrom astropy.table import Table\nfrom numba import njit, prange\nfrom numpy import atleast_2d, zeros, log, concatenate, pi, transpose, sum, compress, ones\nfrom uncertainties import UFloat, ufloat\nfrom .oclttvlpf import OCLTTVLPF\nfrom ..utils.keplerlc import KeplerLC\nfrom .baselines.legendrebaseline import LegendreBaseline\n\n@njit(parallel=True, cache=False, fastmath=True)\ndef lnlike_normal_v(o, m, e):\n    m = atleast_2d(m)\n    npv = m.shape[0]\n    npt = o.size\n    lnl = zeros(npv)\n    for i in prange(npv):\n        lnl[i] = (-npt * log(e[i, 0]) - 0.5 * log(2 * pi)) / (0.5 * sum(((o - m[i, :]) / e[i, 0]) ** 2))\n    return lnl\n\nclass TESSCLTTVLPF(LegendreBaseline, OCLTTVLPF):\n\n    def __init__(self, name: str, dfile: Path, zero_epoch: float, period: float, nsamples: int=10, trdur: float=0.125, bldur: float=0.3, nlegendre: int=2, ctx=None, queue=None):\n        zero_epoch = zero_epoch if isinstance(zero_epoch, UFloat) else ufloat(zero_epoch, 1e-05)\n        period = period if isinstance(period, UFloat) else ufloat(period, 1e-07)\n        tb = Table.read(dfile)\n        self.bjdrefi = tb.meta['BJDREFI']\n        zero_epoch = zero_epoch - self.bjdrefi\n        df = tb.to_pandas().dropna(subset=['TIME', 'SAP_FLUX', 'PDCSAP_FLUX'])\n        self.lc = lc = KeplerLC(df.TIME.values, df.SAP_FLUX.values, zeros(df.shape[0]), zero_epoch.n, period.n, trdur, bldur)\n        LegendreBaseline.__init__(self, nlegendre)\n        OCLTTVLPF.__init__(self, name, zero_epoch, period, ['TESS'], times=lc.time_per_transit, fluxes=lc.normalized_flux_per_transit, pbids=zeros(lc.nt, 'int'), nsamples=nsamples, exptimes=[0.00139], cl_ctx=ctx, cl_queue=queue)\n        self.lnlikelihood = self.lnlikelihood_nb\n\n    def create_pv_population(self, npop=50):\n        pvp = self.ps.sample_from_prior(npop)\n        return pvp\n\n    def flux_model(self, pvp):\n        tmodel = transpose(self.transit_model(pvp, copy=True)).copy()\n        return tmodel * self.baseline(pvp)\n\n    def lnlikelihood_nb(self, pvp):\n        fmodel = self.flux_model(pvp).astype('d')\n        err = 10 ** atleast_2d(pvp)[:, self._sl_err]\n        return lnlike_normal_v(self.ofluxa, fmodel, err)",
  "line_no": 19,
  "line_no_percent": "42%"
}