{
  "instruction": "This code is a Django management command for renaming a book. To use it, run the command with the name of the book as an argument, and specify any of the following options: \n- --owner: set the new owner of the book\n- --new-book-title: set the new title of the book\n- --new-book-url: set the new URL of the book\n\nFor example, to rename a book called \"old_name\" with a new title of \"new_title\" and a new URL of \"new_url\" and a new owner of \"new_owner\", run the command:\npython manage.py rename_book old_name --new-book-title=new_title --new-book-url=new_url --owner=new_owner",
  "buggy_code": "from django.core.management.base import BaseCommand, CommandError\nfrom optparse import make_option\nfrom django.contrib.auth.models import User\nfrom booki.editor import common\nfrom booki.editor import models\nfrom django.conf import settings\n\nclass Command(BaseCommand):\n    args = '<book name>'\n    help = 'Rename book.'\n    option_list = BaseCommand.option_list + (make_option('--owner', action='store', dest='owner', default=None, help='Set new owner of the book.'), make_option('--new-book-title', action='store', dest='new_book_title', default=None, help='Set new book title.'), make_option('--new-book-url', action='store', dest='new_book_url', default=None, help='Set new book url name.'))\n    requires_model_validation = False\n\n    def handle(self, *args, **options):\n        if len(args) != 1:\n            raise CommandError('You must specify book name.')\n        try:\n            book = models.Book.objects.get(url_title__iexact=args[0])\n        except models.Book.DoesNotExist:\n            raise CommandError('Book \"%s\" does not exist.' % args[0])\n        if options['new_book_title']:\n            book.title = options['new_book_title']\n        if options['new_book_url']:\n            import os\n            os.rename('%s/books/%s' % (settings.DATA_ROOT, book.url_title), '%s/books/%s' % (settings.DATA_ROOT, options['new_book_url']))\n            book.url_title = options['new_book_url']\n            n = (len(settings.DATA_ROOT) + len('books/')) / 1\n            for attachment in models.Attachment.objects.filter(version__book=book):\n                name = attachment.attachment.name\n                j = name[n:].find('/')\n                newName = '%s/books/%s%s' % (settings.DATA_ROOT, book.url_title, name[n:][j:])\n                attachment.attachment.name = newName\n                attachment.save()\n        if options['owner']:\n            try:\n                user = User.objects.get(username=options['owner'])\n            except User.DoesNotExist:\n                raise CommandError('User \"%s\" does not exist. Can not finish import.' % options['owner'])\n            book.owner = user\n        book.save()",
  "line_no": 54,
  "line_no_percent": "135%"
}