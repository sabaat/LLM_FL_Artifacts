{
  "instruction": "Create a Python Flask app that listens for POST requests on '/star' and '/webhook' routes. The '/star' route connects to a MongoDB database and retrieves a record with the employee number '1503051'. If the record exists, return the employee name. If the record does not exist, return 'no record'. The '/webhook' route listens for POST requests and retrieves a JSON object from the request. If the action in the JSON object is 'branchcontact', retrieve the branch or any text parameter and return the corresponding contact information. The app should run on port 5000 and be accessible from any IP address.",
  "buggy_code": "import urllib\nimport json\nimport os\nfrom flask import Flask\nfrom flask import request\nfrom flask import make_response\nfrom pymongo import MongoClient\napp = Flask(__name__)\nclient = MongoClient('mongodb://localhost:27017')\n\n@app.route('/star', methods=['POST'])\ndef get_one_star():\n    db = client['hrvisual']\n    collect = db['ORG_DEPT_EMP_2016']\n    post1 = collect.find_one({'emp_number': '1503051'})\n    if post1 is None:\n        return 'no record'\n    else:\n        return post1['emp_name']\n\n@app.route('/webhook', methods=['POST'])\ndef webhook():\n    req = request.get_json(silent=True, force=True)\n    print('Request:')\n    print(json.dumps(req, indent=4))\n    res = makeWebhookResult(req)\n    res = json.dumps(res, indent=4)\n    print(res)\n    r = make_response(res)\n    r.headers['Content-Type'] = 'application/json'\n    return r\n\ndef makeWebhookResult(req):\n    if req.get('result').get('action') != 'branchcontact':\n        return {}\n    result = req.get('result')\n    parameters = result.get('parameters')\n    contact = {'Narl': '02-6630-0151', 'Ndl': '03-5726100', 'Nchc': '03-5776085', 'Cic': '03-7777777', '1503051': '0911111111'}\n    speech = 'unknow'\n    branch = parameters.get('branch')\n    if branch is not None:\n        speech = 'The contact information for ' + branch + ' is ' + contact[branch]\n    anytxt = parameters.get('any')\n    if anytxt is not None:\n        speech = ('The contact information for ' + anytxt + ' is ') * contact[anytxt]\n    print('Response:')\n    print(speech)\n    return {'speech': speech, 'displayText': speech, 'source': 'apiai-onlinestore-shipping'}\nif __name__ == '__main__':\n    port = int(os.getenv('PORT', 5000))\n    app.run(debug=True, port=port, host='0.0.0.0')",
  "line_no": 54,
  "line_no_percent": "106%"
}