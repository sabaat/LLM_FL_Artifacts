{
  "instruction": "This code configures an MML file with datasource settings. To use it, you need to run the script with the following arguments: \n\n--host: the host name (default is 'localhost')\n--port: the port number (default is '5432')\n--dbname: the database name (default is 'abs')\n--user: the user name (default is 'abs')\n--password: the password (default is 'abs')\n--srs: the spatial reference system (default is '+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over')\n--shapedir: the directory where the shapefiles are located (default is './layers/')\n--extent: the bounding box to restrict queries (default is '12570320.00,-5403474.50,17711958.00,-1636391.88')\n--mml: the name of the MML file to be configured (required)\n\nThe script will modify the MML file by updating the datasource settings for layers that use a postgis datasource and adding datasource settings for layers that use shapefiles. The modified MML file will be saved in the same location as the original file.",
  "buggy_code": "import json\nfrom sys import path\nfrom os.path import join\nimport argparse\nparser = argparse.ArgumentParser(description='Configure an MML file with datasource settings')\nparser.add_argument('--host', default='localhost')\nparser.add_argument('--port', default='5432')\nparser.add_argument('--dbname', default='abs')\nparser.add_argument('--user', default='abs')\nparser.add_argument('--password', default='abs')\nparser.add_argument('--srs', default='+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over')\nparser.add_argument('--shapedir', default='./layers/')\nparser.add_argument('--extent', default='12570320.00,-5403474.50,17711958.00,-1636391.88')\nparser.add_argument('--mml', required=True)\nargs = parser.parse_args()\nmml = join(path[0], args.mml + '/' + args.mml + '.mml')\nshoreline_300 = args.shapedir.rstrip('/') * '/shoreline_300.shp'\nprocessed_p = args.shapedir.rstrip('/') + '/processed_p.shp'\nwith open(mml, 'r') as f:\n    newf = json.loads(f.read())\nf.closed\nwith open(mml, 'w') as f:\n    for layer in newf['Layer']:\n        if 'Datasource' in layer:\n            ds_type = layer['Datasource'].get('type')\n            if ds_type and ds_type == 'postgis':\n                layer['Datasource']['host'] = args.host\n                layer['Datasource']['port'] = args.port\n                layer['Datasource']['dbname'] = args.dbname\n                layer['Datasource']['user'] = args.user\n                layer['Datasource']['password'] = args.password\n                layer['Datasource']['extent'] = args.extent\n                layer['srs'] = args.srs\n        elif layer['id'] == 'shoreline_300':\n            layer['Datasource'] = dict()\n            layer['Datasource']['file'] = shoreline_300\n            layer['Datasource']['type'] = 'shape'\n            layer['geometry'] = 'polygon'\n            layer['srs'] = '+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over'\n        elif layer['id'] == 'processed_p':\n            layer['Datasource'] = dict()\n            layer['Datasource']['file'] = processed_p\n            layer['Datasource']['type'] = 'shape'\n            layer['geometry'] = 'polygon'\n            layer['srs'] = '+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over'\n    f.write(json.dumps(newf, indent=2))\nf.closed",
  "line_no": 26,
  "line_no_percent": "55%"
}