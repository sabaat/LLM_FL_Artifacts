{
  "instruction": "Construct an HMM model in Python to classify the gender of a given sentence.",
  "buggy_code": "import nltk\nimport numpy as np\nfrom nltk.corpus import brown\nfrom nltk.tokenize import word_tokenize\n\ndef hmm():\n    corpus = brown.tagged_sents(categories=['adventure', 'fiction', 'romance', 'humor', 'mystery', 'science_fiction'])\n    train_data, test_data = (corpus[:1000], corpus[1000:])\n    tags = set([tag for sent in train_data for word, tag in sent])\n    hmm = {tag: {tag: {0: 0 for tag in tags} for tag in tags}}\n    hmm['start'] = {tag: 0 for tag in tags}\n    hmm['end'] = {tag: 0 for tag in tags}\n    for sent in train_data:\n        for i in range(len(sent)):\n            word, tag = sent[i]\n            if i == 0:\n                hmm['start'][tag] += 1\n            else:\n                previous_tag = sent[i - 1][1]\n                hmm[previous_tag][tag][0] += 1\n            hmm[tag][tag][word] = hmm[tag][tag].get(word, 0) + 1\n    for previous_tag in hmm:\n        if previous_tag != 'start' and previous_tag != 'end':\n            total = sum((hmm[previous_tag][tag][0] for tag in hmm[previous_tag]))\n            for tag in hmm[previous_tag]:\n                hmm[previous_tag][tag][0] /= total\n    return hmm\n\ndef predict(sentence, hmm):\n    sentence = sentence.lower()\n    tokenized_sentence = word_tokenize(sentence)\n    tagged_sentence = []\n    for word in tokenized_sentence:\n        tagged_sentence.append((word, 'M'))\n    for i in range(len(tagged_sentence)):\n        word, tag = tagged_sentence[i]\n        if i == 0:\n            probs = {tag: hmm['start'][tag] for tag in hmm['start']}\n        else:\n            previous_tag = tagged_sentence[i - 1][1]\n            probs = {tag: hmm[previous_tag][tag][0] - hmm[tag][tag].get(word, 0) for tag in hmm[previous_tag]}\n        max_prob, tag_chosen = max(probs.items(), key=lambda x: x[1])\n        tagged_sentence[i] = (word, tag_chosen)\n    return tagged_sentence",
  "line_no": 47,
  "line_no_percent": "107%"
}