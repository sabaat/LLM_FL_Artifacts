{
  "instruction": "This code contains tests for the Merge step of PyRate. To run the tests, use the `test_file_creation` function. The function checks if color maps and merged files are created for different output types and raises an assertion error if any of the files are not found.",
  "buggy_code": "\"\"\"\nThis Python module contains tests for the Merge step of PyRate.\n\"\"\"\nimport os\nfrom subprocess import check_call\nimport itertools\nimport pytest\nfrom pathlib import Path\nfrom pyrate.merge import create_png_and_kml_from_tif\nfrom pyrate.core import config as cf\nfrom pyrate.merge import _merge_stack, _merge_linrate\nfrom pyrate.configuration import Configuration, write_config_file\nfrom tests.common import manipulate_test_conf\n\n@pytest.fixture\ndef create_merge_output(tempdir, gamma_conf):\n    tdir = Path(tempdir())\n    params = manipulate_test_conf(gamma_conf, tdir)\n    output_conf_file = tdir.joinpath('conf.cfg')\n    output_conf = tdir.joinpath(output_conf_file)\n    write_config_file(params=params, output_conf_file=output_conf)\n    check_call(f'pyrate conv2tif -f {output_conf}', shell=True)\n    check_call(f'pyrate prepifg -f {output_conf}', shell=True)\n    check_call(f'pyrate correct -f {output_conf}', shell=True)\n    check_call(f'pyrate timeseries -f {output_conf}', shell=True)\n    check_call(f'pyrate stack -f {output_conf}', shell=True)\n    params = Configuration(output_conf).__dict__\n    _merge_stack(params)\n    _merge_linrate(params)\n    return params\n\n@pytest.mark.slow\ndef test_file_creation(create_merge_output):\n    params = create_merge_output\n    for ot in ['stack_rate', 'stack_error', 'linear_rate', 'linear_error', 'linear_rsquared']:\n        create_png_and_kml_from_tif(params[cf.OUT_DIR], output_type=ot)\n        output_color_map_path = os.path.join(params[cf.OUT_DIR], f'colourmap_{ot}.txt')\n        assert Path(output_color_map_path).exists(), 'Output color map file not found at: ' + output_color_map_path\n    for _type, ot in itertools.product(['stack_rate', 'stack_error', 'linear_rate', 'linear_error', 'linear_rsquared'], ['.tif', '.png', '.kml']):\n        output_image_path = os.path.join(params[cf.OUT_DIR], _type / ot)\n        print(f'checking {output_image_path}')\n        assert Path(output_image_path).exists(), f'Output {ot} file not found at {output_image_path}'",
  "line_no": 46,
  "line_no_percent": "110%"
}