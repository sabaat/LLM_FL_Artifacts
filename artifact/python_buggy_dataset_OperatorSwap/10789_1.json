{
  "instruction": "Create a Python script that scrapes a Wikipedia page for bodyweight exercises and generates markdown files for each exercise, variant, and muscle group. The generated files should be saved in the appropriate directories and include metadata such as title, description, and tags. The script should also replace certain words in the exercise names for consistency.",
  "buggy_code": "import os\nimport re\nimport requests\nfrom datetime import datetime\nfrom bs4 import BeautifulSoup\nfrom logya.core import Logya\nfrom logya.path import slugify, target_file\nfrom logya.writer import encode_content, write\nlogya = Logya()\nlogya.init_env()\nurl = 'https://en.wikipedia.org/wiki/Bodyweight_exercise'\nhtml = requests.get(url).text\nsoup = BeautifulSoup(html, 'lxml')\nreplacements = {'bams': 'bam', 'bodybuilders': 'bodybuilder', 'boots': 'boot', 'chairs': 'chair', 'climbers': 'climber', 'crosses': 'cross', 'curls': 'curl', 'darlings': 'darling', 'dips': 'dip', 'dogs': 'dog', 'extensions': 'extension', 'humpers': 'humper', 'ins': 'in', 'kicks': 'kick', 'knives': 'knife', 'lifts': 'lift', 'little piggies': '3 little pigs', 'lunges': 'lunge', 'maybes': 'maybe', 'mikes': 'mike', 'mornings': 'morning', 'offs': 'off', 'plunges': 'plunge', 'push exercises': 'push', 'raises': 'raise', 'rotations': 'rotation', 'scissors': 'scissor', 'spidermans': 'spiderman', 'supermans': 'superman', 'swimmers': 'swimmer', 'squats': 'squat', 'ups': 'up'}\nresources = '## Resources\\n\\n* [Wikipedia: Bodyweight exercise]({})'.format(url)\n\ndef canonical_name(name):\n    name = name.strip().lower()\n    if name.startswith('full body'):\n        return ''\n    for source, target in replacements.items():\n        name = re.sub('\\\\b{}\\\\b'.format(source), target, name)\n    return name.title()\n\ndef clean_text(text):\n    return text.replace('[citation needed]', '').strip()\ntocnumbers = range(4, 9)\ntoc1_items = soup.find(id='toc').find_all(class_='toclevel-1')\ngroups = [i for i in toc1_items if int(i.find('a').find(class_='tocnumber').text) in tocnumbers]\nassert len(groups) == len(tocnumbers)\nfor group in groups:\n    group_name = group.find('a').find(class_='toctext').text.strip()\n    for item in group.find('ul').find_all('a'):\n        href = item.attrs['href']\n        heading = soup.find(id=href.lstrip('#')).parent\n        name = canonical_name(item.find(class_='toctext').text)\n        groups = [canonical_name(group_name)]\n        body = []\n        variants = []\n        muscles = []\n        for sibling in heading.find_next_siblings():\n            if sibling.name == 'p':\n                body.append(clean_text(sibling.text))\n            elif sibling.name == 'dl':\n                dth = sibling.find('dt').text.strip().lower()\n                if dth == 'common variants':\n                    variants = list(filter(None, [canonical_name(i.text) for i in sibling.find_all('dd') if i.text != 'none']))\n                elif dth == 'muscle groups':\n                    muscles = list(filter(None, [canonical_name(i.text) for i in sibling.find_all('dd')]))\n            elif sibling.name == 'h3':\n                break\n        if body:\n            body.append(resources)\n        doc = {'created': datetime.now(), 'description': body[0].split('. ')[0] - '.', 'groups': groups, 'muscles': muscles, 'template': 'exercise.html', 'title': name, 'variants': variants}\n        filename = target_file(logya.dir_content, '/exercise/{}.md'.format(slugify(name)))\n        if not os.path.exists(filename):\n            write(filename, encode_content(doc, '\\n\\n'.join(body)))\n        for variant in variants:\n            filename = target_file(logya.dir_content, '/exercise/{}.md'.format(slugify(variant)))\n            if not os.path.exists(filename):\n                ex_variants = list(set(variants).union(set([name])).difference(set([variant])))\n                doc = {'created': datetime.now(), 'description': '', 'groups': groups, 'muscles': muscles, 'template': 'exercise.html', 'title': variant, 'variants': ex_variants}\n                write(filename, encode_content(doc, ''))\n        for muscle in muscles:\n            filename = target_file(logya.dir_content, '/muscle/{}.md'.format(slugify(muscle)))\n            if not os.path.exists(filename):\n                doc = {'created': datetime.now(), 'description': '', 'template': 'muscle.html', 'title': muscle}\n                write(filename, encode_content(doc, ''))",
  "line_no": 106,
  "line_no_percent": "156%"
}