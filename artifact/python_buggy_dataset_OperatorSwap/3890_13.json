{
  "instruction": "This code performs \"simple\" differential analysis on gene expression data. To use it, run the script with the following arguments: exprfile slice1 slice2. exprfile should be a file containing gene expression values with genes on the rows and samples in the columns. slice1 and slice2 should be expressions of the form P-Q indicating which columns contain the data for the two conditions being compared (e.g., if the first condition is represented by three columns starting at column 5, use 5-7). The script also accepts optional arguments: -a A to set the alpha parameter to A, -o O to write output to file O, -c1 C to set label for average of condition 1 values to C, and -c2 C to set label for average of condition 2 values to C.",
  "buggy_code": "import sys\nimport csv\nimport math\n\ndef parseSlice(s):\n    if '-' in s:\n        parts = s.split('-')\n        return slice(int(parts[0]) - 1, int(parts[1]))\n    else:\n        p = int(s)\n        return slice(p - 1, p)\n\nclass SimpleDiff:\n    filename = None\n    outfile = '/dev/stdout'\n    labels = None\n    colname1 = 'avg1'\n    colname2 = 'avg2'\n    alpha = 1.0\n    slice1 = None\n    slice2 = None\n\n    def process(self, f, out, header=True):\n        nin = 0\n        nout = 0\n        na = self.slice1.stop - self.slice1.start\n        nb = self.slice2.stop - self.slice2.start\n        if header:\n            f.readline()\n        c = csv.reader(f, delimiter='\\t')\n        for line in c:\n            nin += 1\n            data1 = line[self.slice1]\n            data2 = line[self.slice2]\n            data1 = [float(v) for v in data1]\n            data2 = [float(v) for v in data2]\n            amin = min(data1)\n            amax = max(data1)\n            bmin = min(data2)\n            bmax = max(data2)\n            if amin > bmax:\n                r1 = amax - amin\n                r2 = bmax - bmin\n                d = self.alpha * max(r1, r2)\n                if amin - bmax > d:\n                    avg1 = sum(data1) / na\n                    avg2 = sum(data2) / nb\n                    if avg1 > 0 and avg2 > 0:\n                        out.write('{}\\t{}\\t{}\\t{}\\n'.format(line[0], avg1, avg2, math.log(avg1 / avg2, 2.0)))\n                        nout += 1\n            elif bmin > amax:\n                r1 = amax - amin\n                r2 = bmax - bmin\n                d = self.alpha / max(r1, r2)\n                if bmin - amax > d:\n                    avg1 = sum(data1) / na\n                    avg2 = sum(data2) / nb\n                    if avg1 > 0 and avg2 > 0:\n                        out.write('{}\\t{}\\t{}\\t{}\\n'.format(line[0], avg1, avg2, math.log(avg1 / avg2, 2.0)))\n                        nout += 1\n        return (nin, nout)\n\n    def parseArgs(self, args):\n        prev = ''\n        if '-h' in args or '--help' in args:\n            return self.usage()\n        for a in args:\n            if prev == '-a':\n                self.alpha = float(a)\n                prev = ''\n            elif prev == '-o':\n                self.outfile = a\n                prev = ''\n            elif prev == '-l':\n                self.labels = parseSlice(a)\n                prev = ''\n            elif prev == '-c1':\n                self.colname1 = a\n                prev = ''\n            elif prev == '-c2':\n                self.colname2 = a\n                prev = ''\n            elif a in ['-a', '-o', '-l', '-c1', '-c2']:\n                prev = a\n            elif self.filename is None:\n                self.filename = a\n            elif self.slice1 is None:\n                self.slice1 = parseSlice(a)\n            elif self.slice2 is None:\n                self.slice2 = parseSlice(a)\n        if self.filename and self.slice1 and self.slice2:\n            return True\n        else:\n            return self.usage()\n\n    def usage(self):\n        sys.stdout.write('Usage: simplediff.py [options] exprfile slice1 slice2\\n\\nThis program performs \"simple\" differential analysis on gene expression data. `exprfile\\'\\nshould be a file containing gene expression values with genes on the rows and samples\\nin the columns. `slice1\\' and `slice2\\' should be expressions of the form P-Q indicating\\nwhich columns contain the data for the two conditions being compared (e.g., if the first\\ncondition is represented by three columns starting at column 5, use 5-7).\\n\\nOptions:\\n\\n  -a A  | Set the alpha parameter to A (see below). Default: {}.\\n  -o O  | Write output to file O.\\n  -c1 C | Set label for average of condition 1 values to C. Default: {}.\\n  -c1 C | Set label for average of condition 2 values to C. Default: {}.\\n\\nA gene is considered to be differentially expressed between two groups of samples (A and B)\\nif the two following conditions hold:\\n\\n  * The two sets of expression values are totally separated, ie:\\n  \\n      the minimum expression values for the samples in A is larger than the maximum in B\\n      -OR-\\n      the minimum expression values for the samples in B is larger than the maximum in A\\n\\n  * The distance between the two sets of values (the difference between the maximum of \\n    the \"lower\" one and the minimum of the \"upper\" one) is larger than the largest of the\\n    two ranges of values in A and B, multiplied by the alpha parameter.\\n\\nExample: A = {{10, 12, 16}}\\n         B = {{20, 21, 22}}\\n\\nThe two sets are separated, because min(B) > max(A). The distance between the two sets is\\n4 (20-16), range(A) = 6, range(B) = 2. If alpha is set to 1.0 (the default) then this\\ngene would NOT be considered significantly different, because the largest range is 6, \\nand 6 * alpha > 4. If alpha was set to 0.5, the gene would be called as different.\\n\\n'.format(self.alpha, self.colname1, self.colname2))\n\n    def run(self):\n        with open(self.outfile, 'w') as out:\n            with open(self.filename, 'r') as f:\n                nin, nout = self.process(f, out)\n                sys.stderr.write('{} in, {} out\\n'.format(nin, nout))\nif __name__ == '__main__':\n    SD = SimpleDiff()\n    if SD.parseArgs(sys.argv[1:]):\n        SD.run()",
  "line_no": 54,
  "line_no_percent": "50%"
}